<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8">
  <title></title>
  <base href="/">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">


  <meta name="theme-color" content="#fafafa">

</head>

<body class="mediumBackgroundColor">

  <!-- Add your site or application content here -->

  <div style="height: 100vh;">
    <div class="py-2 px-3 mediumBorderColor border-b backgroundColor flex items-center space-x-3">
      <div class="flex space-x-2 items-center">
        <div class="primaryColor inverseTextColor text-sm px-1 rounded">M</div>
        <div class="textColor">album_collection</div>
      </div>
      <input type="text" class="inputBackgroundColor w-full p-2 text-sm textColor" placeholder="Search or jump toâ€¦">
      <button class="textColor py-1 px-2 border mediumBorderColor swap-theme"><i class="ri-sun-fill"></i></button>
    </div>
    <div class="grid grid-cols-6 justify-items-stretch h-full">
      <div class="col-span-1">
        <div class="backgroundColor h-full mediumBorderColor border-r sidebar-wrapper">
          <div class="flex items-center">
            <input type="text" class="inputBackgroundColor w-full p-2 text-sm textColor" placeholder="Type to search">
            <button class="px-2"><i class="ri-menu-line textColor align-bottom"></i></button>
          </div>
          <div class="sidebar-navigation"></div>
      
      
        </div>

      </div>
      <div class="col-span-5">
        <!--
        <div class="mediumBackgroundColor flex">
          <div class="textColor text-sm py-2 px-3"><i class="ri-table-fill align-bottom mr-1"></i> release <i
              class="ri-close-line align-bottom ml-3"></i> </div>
          <div class="textColor accentBackgroundColor text-sm py-2 px-3"><i class="ri-grid-fill align-bottom mr-1"></i>
            Total
            Tracks by Artist <i class="ri-close-line align-bottom ml-3"></i> </div>
          <div class="textColor text-sm py-2 px-3"><i class="ri-table-fill align-bottom mr-1"></i> artist <i
              class="ri-close-line align-bottom ml-3"></i> </div>

          <button class="primaryColor inverseTextColor px-3 text-sm"><i class="ri-add-line align-bottom"></i></button>
        </div>
     
        <div class="accentBackgroundColor border-b mediumBorderColor py-2 px-3 flex space-x-6 items-center">
          <h3 class="textColor text-lg">Total Releases by Artist <i class="ri-arrow-down-s-line align-bottom"></i></h3>
          <button class="textColor border lightBorderColor px-2 py-1"><i class="ri-add-line align-bottom"></i>
            Record</button>
          <div class="space-x-4 flex items-center">
            <button class="space-x-1 mediumBackgroundColor primaryBorderColor border py-1 px-2"><i
                class="ri-filter-line align-bottom textColor"></i><span class="font-semibold textColor">Filter</span>
              <div class="primaryColor inverseTextColor align-text-bottom inline-block rounded px-1 text-xs">3</div>
            </button>
            <div class="textColor">Sort</div>
            <div class="textColor">Group</div>
          </div>
          <button class="textColor border lightBorderColor px-2 py-1"><i class="ri-save-fill align-bottom"></i>
            Save</button>
          <div class="mutedTextColor">Saving Changes</div>
        </div>
        -->
        <div class="mediumBackgroundColor h-full flex items-start table-wrapper">

          <button class="primaryColor inverseTextColor py-2 px-3" id="add-column"><i
              class="ri-add-line align-bottom"></i></button>

        </div>
      </div>
    </div>

  </div>


  <script type="text/javascript">

    var darkTheme = {
      backgroundColor: 'bg-gray-900',
      mediumBackgroundColor: 'bg-gray-800',
      accentBackgroundColor: 'bg-gray-700',
      lightBackgroundColor: 'bg-gray-200',
      darkBorderColor: 'border-gray-500',
      mediumBorderColor: 'border-gray-600',
      lightBorderColor: 'border-gray-500',
      textColor: 'text-gray-100',
      inverseTextColor: 'text-dark',
      mutedTextColor: 'text-gray-400',
      mediumTextColor: 'text-gray-200',
      tableBorderColor: 'border-gray-600',
      tableBackgroundColor: 'bg-gray-800',
      tableHeaderBackgroundColor: 'bg-gray-800',
      primaryColor: 'bg-indigo-300',
      primaryBorderColor: 'border-indigo-300',
      inputBackgroundColor: 'bg-gray-700',
      darkPrimaryColor: 'bg-indigo-800'
    };

    var lightTheme = {
      backgroundColor: 'bg-white',
      mediumBackgroundColor: 'bg-gray-200',
      accentBackgroundColor: 'bg-white',
      lightBackgroundColor: 'bg-gray-100',
      darkBorderColor: 'border-gray-600',
      mediumBorderColor: 'border-gray-400',
      lightBorderColor: 'border-gray-100',
      textColor: 'text-gray-600',
      inverseTextColor: 'text-white',
      mutedTextColor: 'text-gray-800',
      mediumTextColor: 'text-gray-900',
      tableBorderColor: 'border-gray-300',
      tableBackgroundColor: 'bg-white',
      tableHeaderBackgroundColor: 'bg-white',
      primaryColor: 'bg-indigo-400',
      primaryBorderColor: 'border-indigo-300',
      inputBackgroundColor: 'bg-gray-100',
      darkPrimaryColor: 'bg-indigo-800'
    }

    

    document.querySelector('.swap-theme').addEventListener('click', changeTheme);
    document.querySelector('.swap-theme').selectTheme = lightTheme;

    const urlParams = new URLSearchParams(window.location.search);
    var activeTheme = urlParams.get('theme');

    function changeTheme(evt) {
      //for (const property in evt.currentTarget.selectTheme) {applyTheme(property, evt.currentTarget.selectTheme[property]);}
    }

    var defaultTheme = darkTheme;

    if (activeTheme == 'darkTheme') {
      var theme = darkTheme;
    } else if (activeTheme == 'lightTheme') {
      var theme = lightTheme;
    } else {
      var theme = defaultTheme;
    }

    for (const property in theme) { applyTheme(property, theme[property]); }

    function applyTheme(property, color) {
      document.querySelectorAll(`.${property}`).forEach(el => {
        el.classList.add(`${color}`);
      });
    }

    var schemaTables =
      {tables:[{
      name: 'artist',
      id: 0,
      columns: [
        {name: 'id', type: 'number', readOnly:true},
        {name: 'artistName', type: 'text' },
        {name: 'releaseId', type: 'fk', lookup:'releaseName' }
      ],
      records: [
        [449, 'Aqua','Aquarius'],
        [450, 'Patti Smith','Horses'],
        [451, 'Elvis Costello','Spike'],
        [451, 'Kylie Minogue','Golden'],
        [451, 'Artic Monkeys','AM'],
        [453, 'Scorpions','Animal Magnetism']
      ],
      color: 'purple'
    }, {
      name: 'release',
      id: 1,
      columns: [
        {name: 'id', type: 'number', readOnly:true},
        {name: 'releaseName', type: 'text' },
        {name: 'releaseGenre', type: 'text' }
      ],
      records: [
        [20, 'Aquarius', 'Pop'],
        [21, 'Aquarium', 'Pop'],
        [22, 'Spike', 'Rock'],
        [23, 'Golden', 'Pop'],
        [24, 'AM', 'Pop'],
        [25, 'Animal Magnetism', 'Rock']
      ],
      color: 'green'
    }, {
      name: 'track',
      id: 2,
      columns: [
        {name: 'id', type: 'number', readOnly:true},
        {name: 'trackName', type: 'text' },
        {name: 'trackLength', type: 'duration' }
      ],
      records: [
        [460, 'Turn Back Time', 180000],
        [461, 'Roses are Red', 180000]
      ],
      color: 'pink'
    }, {
      name: 'track_artist',
      id: 3,
      columns: [
        {name: 'id', type: 'number', readOnly:true},
        {name: 'artistId', type: 'fk', lookup:'artistName' },
        {name: 'trackId', type: 'fk', lookup:'trackName' }
      ],
      records: [
        [500, 'Aqua', 'Around the World'],
        [501, 'Aqua', 'Barbie Girl'],
        [502, 'Aqua', 'Turn Back Time'],
        [503, 'Aqua', 'Roses are Red']
      ],
      color: 'pink'
    }, {
      name: 'release_track',
      id: 8,
      columns: [
        {name: 'id', type: 'number', readOnly:true},
        {name: 'releaseId', type: 'fk', lookup:'releaseName' },
        {name: 'trackId', type: 'fk', lookup:'trackName' }
      ],
      records: [
        ['60','Aquarius','Roses are Red'],
        ['61','Aquarius','Around the World'],
        ['62','Aquarius','Barbie Girl'],
        ['63','Aquarius','Good Morning Sunshine']
      ],
      color: 'pink'
    }],
      views:[{
        name: 'Releases by Artist',
        id: 4,
        columns: [
          {name: 'artistName', type: 'text', referencedTable: 'artist' },
          {name: 'releaseName', type: 'text', referencedTable: 'release' }
        ],
        records: [
          ['Aqua','Aquarius'],
          ['Elvis Costello','Spike'],
          ['Kylie Minogue','Golden'],
          ['Artic Monkeys','AM'],
          ['Scorpions','Animal Magnetism']
        ],
        color: 'purple'
      },{
        name: 'Release with Track',
        id: 10,
        columns: [       
          {name: 'releaseName', type: 'text', referencedTable: 'release' },
          {name: 'trackName', type: 'text', referencedTable: 'release_track', summaryOf: 'releaseName' }
        ],
        records: [
          ['Aquarius','Roses are Red,Around the World,Barbie Girl,Good Morning Sunshine'],
          ['Aquarium','']
        ],
        color: 'purple'
      }
    ]};

    var activeTable = urlParams.get('activeTable');
    createSidebarNavigation(schemaTables);
    document.querySelector('.table-wrapper').parentNode.prepend(createTableToolbar(selectTableById(activeTable)));
    document.querySelector('.table-wrapper').parentNode.prepend(createTabs(schemaTables));
    document.querySelector('.table-wrapper').prepend(createTable(selectTableById(activeTable)));
    
    // CREATE SIDEBAR
    function createSidebarNavigation(schema) {
      let viewsNavigation = document.createElement('div')
      viewsNavigation.classList.add('views-navigation');
      document.querySelector('.sidebar-navigation').append(viewsNavigation);

      let tablesNavigation = document.createElement('div')
      tablesNavigation.classList.add('tables-navigation');
      document.querySelector('.sidebar-navigation').append(tablesNavigation);

      let objectHeader = function(key){
        let listHeader = document.createElement('div');
        listHeader.classList.add('p-2','border-t','border-b',theme.mediumBorderColor)
        listHeader.innerHTML = `<div class="flex items-center space-x-2"><div class="uppercase text-xs font-bold ${theme.textColor}">${key}</div> <div class="${theme.lightBackgroundColor} ${theme.inverseTextColor} rounded px-1 text-xs">${schema[key].length}</div><div>`;
        return listHeader;
      };
      
      let objectList = function(key){
        let obj = schema[key];
        let listItem = document.createElement('div');
        listItem.innerHTML = obj.map(item => `<div class="${theme.textColor}"><a class="p-2 block" href="${window.location.pathname}?activeTable=${item.id}"><i class="ri-table-fill align-bottom mr-2"></i>${item.name}</a></div>`).join('');
        return listItem;
      };

      Object.keys(schema).forEach(function(key){
        document.querySelector(`.${key}-navigation`).append(objectHeader(key));
        document.querySelector(`.${key}-navigation`).append(objectList(key));
      });   
    } 

    // SELECT TABLE BY ID
    function selectTableById(id){
      return Object.values(schemaTables).flat().find(table => table.id == id);
    }

    // SELECT TABLE BY NAME
    function selectTableByName(name){
      return Object.values(schemaTables).flat().find(table => table.name == name);
    }

    // STATUS FOR TABS
    setTableStatus(selectTableById(activeTable),'active');
    setTableStatus(selectTableById(4),'open');
    setTableStatus(selectTableById(2),'open');

    function setTableStatus(table,status){ 
      if (table.id == activeTable) {
        table.status = 'active';
      } else {
        table.status = status;
      }
    }

    // TABS
    function createTabs(tables) {
      let openTables = Object.values(tables).flat().filter(table => table.status);
      console.log(openTables)

      let createTab = table => `<div class="py-2 px-3 ${theme.textColor} ${table.status == 'active'?theme.accentBackgroundColor:theme.backgroundColor}">${table.name}</div>`;

      let tab = openTables.map(table => createTab(table)).join('');

      let tabs = document.createElement('div');
      tabs.innerHTML = `<div class="flex items-center">${tab}</div>`

      return tabs;
    }

    function createTableToolbar(obj) {
      let toolbar = document.createElement('div');
      toolbar.innerHTML = `
      <div class="${theme.accentBackgroundColor} py-2 px-3 flex items-center space-x-4">
        <h2 class="${theme.textColor} text-lg">${obj.name}</h2>
        <button class="${theme.textColor} border ${theme.lightBorderColor} px-2 py-1"><i class="ri-add-line align-bottom mr-1"></i>Record</button>
        <div class="${theme.mutedTextColor}">Saving Changes</div>
      </div>`
      return toolbar;
    }

    // SET ICONS
    function typeIcon(type) {
        if (type == 'text') {
          return 'text';
        } else if (type == 'number') {
          return 'hashtag';
        } else if (type == 'duration') {
          return 'time-line';
        } else if (type == 'fk') {
          return 'key-fill';
        } else {
          return 'question-mark';
        } 
    }

    function createTable(obj) {

      let recordType = obj.columns.reduce(function(a,b){
        a.push(b.type)
        return a;
      },[]);

      let recordTable = obj.columns.reduce(function(a,b){
        a.push(b.referencedTable)
        return a;
      },[]);

      let summaryOf = obj.columns.reduce(function(a,b){
        a.push(b.summaryOf)
        return a;
      },[]);


      let createHeader = function (col) {
        let header = document.createElement('div');
        header.classList.add('t-cell', 'p-2', theme.textColor);
        header.innerHTML = `<i class="ri-${typeIcon(col.type)} align-bottom border border-gray-500 rounded mr-2"></i>${col.name}`;
        return header;
      };


      let createCell = function (cell,i) {  
        let cellElement = document.createElement('div');
        cellElement.classList.add('t-cell', 'border-r', theme.tableBorderColor, 'editable-cell');
        let cellInput = document.createElement('input');
        cellInput.setAttribute('type','text');
        cellInput.setAttribute('value', cell);
        cellInput.setAttribute('data-type',recordType[i]);
        cellInput.setAttribute('data-dropdown',recordTable[i]||'');
        cellInput.classList.add(theme.inputBackgroundColor,theme.textColor,'p-2','w-full');
        cellElement.appendChild(cellInput);
        //cellElement.innerHTML = `<div data-position:"${i}" class="" data-type="${recordType[i]}" data-summary-of="${summaryOf[i] || ''}" data-reference-table="${recordTable[i]}"><input class="${theme.inputBackgroundColor} ${theme.textColor} p-2 w-full" value="${cell}" type="text"></div>`;        
        //cellElement.addEventListener('click',selectCell);
        //cellElement.addEventListener('dblclick',editCell);
        let renderedCell = renderCell(cellElement);
        return renderedCell;
      }  

      let createRow = function (record, i) {
        let rowCount = i + 1;
        let row = document.createElement('div');  
        row.classList.add('t-row','border-b',theme.tableBorderColor);
        let rowNumber = document.createElement('div');
        rowNumber.classList.add('t-row-header','p-3', theme.mutedTextColor, 'border-r',theme.tableBorderColor,'text-xs');
        rowNumber.innerHTML = `${rowCount}`;
        record.forEach((cell,i) => row.appendChild(rowNumber));
        record.forEach((cell,i) => row.appendChild(createCell(cell,i)));
        //row.innerHTML = `<div class="t-row border-b ${theme.tableBorderColor}"><div class="t-row-header p-2 ${theme.mutedTextColor} border-r ${theme.tableBorderColor} text-xs">${rowCount}</div>${cells}</div>`;
        return row;
      }

      let setPlaceholder = function(col) {
        if (col.referencedTable) {
          return `Add Record to '${col.referencedTable}'`
        } else {
          if(col.type == 'fk') {
            return `Search '${col.lookup}'`
          } else {
            return ``;
          }
        }
      }

      let createNewRow = function (columns) {
        let inputControl = function(col) {
          if (col.readOnly) {
            return `<input class="${theme.inputBackgroundColor} ${theme.textColor} p-2 w-full" readOnly="true" type="text" placeholder='New Record'>`
          } else {
            return `<input class="${theme.inputBackgroundColor} ${theme.textColor} p-2 w-full" value="" type="text" placeholder="${setPlaceholder(col)}">`
          }
        }
        let cells = columns.map(col => `<div class="t-cell border-r ${theme.tableBorderColor}">${inputControl(col)}</div>`).join('');
        let row = `<div class="t-row border-b ${theme.tableBorderColor} add-new-record"><div class="t-row-header p-2 ${theme.mutedTextColor} border-r ${theme.tableBorderColor} text-xs">*</div>${cells}</div>`
        return row;
      }

    
      
      let newRecord = createNewRow(obj.columns);

      let table = document.createElement('div');
      let tableClasses = ['t-table', theme.backgroundColor];
      table.classList.add(...tableClasses);
      let rowWrapper = document.createElement('div');
      rowWrapper.classList.add('t-body','row-wrapper');
      let headerWrapper = document.createElement('div');
      let headerRow = document.createElement('div');
      let headerRowSelect = document.createElement('div');
      headerRowSelect.classList.add('t-row-header','p-2');
      headerRow.classList.add('t-row','border-b',theme.tableBorderColor);
      headerRow.appendChild(headerRowSelect);
      headerWrapper.appendChild(headerRow);
      headerWrapper.classList.add('t-head','row-wrapper');
      
      obj.columns.forEach(col => headerRow.appendChild(createHeader(col)));
      obj.records.forEach((record, index) => rowWrapper.appendChild(createRow(record, index)));
      table.appendChild(headerWrapper);
      table.appendChild(rowWrapper);
      

      
      //table.innerHTML = `
      //<div>
      //  <div class="t-row border-b ${theme.tableBorderColor}">
      //    <div class="t-row-header p-2"></div>${headers}
      //  </div>
      //  <div class="t-body row-wrapper">${records}</div>
      //  <div class="t-body row-wrapper row-wrapper--add">${newRecord}</div>
      //</div>
      //<div>
      //  ${tableEdit}
      //</div>`;
      return resizeColumns(table);
    }

    function createEditMenu(table,el) {
      console.log(el)
      let value = el.getAttribute('value');
      let menu = document.createElement('div');
      menu.classList.add('edit-dropdown','shadow-md',theme.backgroundColor,'p-3','space-y-3');
      menu.style.position = 'absolute';
      menu.style.minWidth = '280px';

      let createFormGroup = function(field,i) {
        let formGroup = document.createElement('div');
        let input = document.createElement('input');
        input.classList.add(theme.inputBackgroundColor,theme.textColor,'p-2','w-full')
        let label = document.createElement('label');
        label.classList.add(theme.textColor,'block')
        label.innerHTML = `${field.name}`;
        input.setAttribute('value',records[i]);
        formGroup.appendChild(label);
        formGroup.appendChild(input);
        return formGroup;
      }

      let records = selectTableByName(table).records.find(record => record.includes(value));
      let columns = selectTableByName(table).columns.forEach((field,i) => menu.appendChild(createFormGroup(field,i)));


      document.addEventListener('click', function(event) {
      var isClickInsideElement = menu.contains(event.target);
      if (!isClickInsideElement) {
        console.log('outside')
          renderCell(el.parentNode);
          menu.remove();          
        }
      }, {once: true});
      
      return menu;
    }

    function dropdownVisible(){
      return false;
    }


    function resizeColumns(table) {
      cells = table.querySelectorAll('.t-cell');
      cells.forEach(cell => cell.style.width = '240px');
      rowHeaders = table.querySelectorAll('.t-row-header');
      rowHeaders.forEach(rowHeader => rowHeader.style.width = '48px')
      return table;
    }


    function renderCell(el) {
      let input = el.querySelector('input');

      input.classList.add('hidden');
      let value = input.getAttribute('value');
      let contentWrapper = document.createElement('div');
      contentWrapper.classList.add('content-wrapper','p-2',theme.textColor);
      let type = input.getAttribute('data-type');

      let cellContent = function(type) {
        if (type == 'fk') {  
          return `<div class="bg-indigo-500 bg-opacity-60 px-2 rounded inline-block ${theme.textColor}">${value}</div>`
        } else {
          return `${value}`
        }
      }

      contentWrapper.innerHTML = cellContent(type);
      el.appendChild(contentWrapper);
      contentWrapper.addEventListener('dblclick', editCell);
      contentWrapper.addEventListener('click', selectCell);
      
      return el;   
    }

    var doubleClickEvent = document.createEvent('MouseEvents');
    doubleClickEvent.initEvent('dblclick', true, true);
    document.querySelectorAll('.content-wrapper')[1].dispatchEvent(doubleClickEvent);

    function createEditDropDown(el){
      let type = el.parentNode.getAttribute('data-type');
      let referenceTable = el.parentNode.getAttribute('data-reference-table');
      let summaryOf = el.parentNode.getAttribute('data-summary-of');
      let tableObj = selectTableByName(referenceTable);
      let value = el.getAttribute('value');
      let record = tableObj.records.find(record => record.includes(value));
      var content = '';

      let summaryValues = value.split(',');
      let summaryRecords = summaryValues.map(value => tableObj.records.find(record => record.includes(value))).map(function(record){

        let item = record.map(value => `<div>${value}</div>`).join('');

        return `<div class="flex space-x-2 px-2 py-1 ${theme.textColor} ${theme.primaryColor} bg-opacity-40 rounded">${item}</div>`;
      }).join('');

      if (!summaryOf) {
        let fields = tableObj.columns.map((col,i) => `<div><label class="block ${theme.textColor}">${col.name}</label><input class="text-sm w-full ${theme.inputBackgroundColor} ${theme.textColor} p-2" type="text" value="${record[i]}"></div>`).join('');

        content = fields;
      } else {
        content = `<div class="space-y-2">${summaryRecords}</div> <button class="${theme.textColor} border ${theme.lightBorderColor} px-2 py-1"><i class="ri-add-line align-bottom mr-1"></i>New Record</button>`;
      }

      return `
        <div class="p-2 w-full ${theme.backgroundColor} ${theme.mediumBorderColor} space-y-2">
          <h4 class="${theme.textColor}">Edit Record in '${referenceTable}'</h4>
          ${content}  
        </div>`;
    }

   // <div class="space-x-1 flex">
     //       <button class="${theme.inputBackgroundColor} flex-grow ${theme.textColor} p-2 text-sm">Cancel</button>  
       //     <button class="${theme.primaryColor} flex-grow p-2 text-sm">Save</button>
         // </div>


    function editCell(e) {
      let cellInput = this.parentNode.querySelector('input');
      cellInput.classList.remove('hidden');
      cellInput.focus();

      let dropdown = cellInput.getAttribute('data-dropdown');

      if (!dropdown) {
        cellInput.addEventListener('blur', saveCell);
      } else {
        this.parentNode.appendChild(createEditMenu(dropdown,cellInput));
      }
      //
      //if (referenceTable !== 'undefined'){ 
      //  let editDropdown = document.createElement('div');
      //  editDropdown.classList.add('edit-dropdown','shadow-md');
      //  editDropdown.style.position = 'absolute';
      //  editDropdown.style.minWidth = '280px';
      //  editDropdown.innerHTML = createEditDropDown(cellInput);
      //  cellInput.parentNode.append(editDropdown);
      //  //cellInput.addEventListener('blur', saveCell);    
      //} else {
      //  cellInput.addEventListener('blur', saveCell);
      //}

      
      this.remove();
      

      //return false;
    }

    function selectCell(e) {
      console.log('select')
      //let row = this.parentNode.parentNode;
      //let cell = this;
      //let selectedRowClasses = [];
      //let selectedCellClasses = [theme.primaryColor,'bg-opacity-20'];
      //let selectedRowNumberClasses = ['font-bold',theme.primaryColor,'bg-opacity-50'];
      //document.querySelectorAll('.selected-cell').forEach(cell => cell.classList.remove('selected-cell',...selectedCellClasses));
      //document.querySelectorAll('.selected-row').forEach(row => row.childNodes[0].classList.remove(...selectedRowNumberClasses));
      //document.querySelectorAll('.selected-row').forEach(row => row.classList.remove('selected-row',...selectedRowClasses));
      //cell.classList.add('selected-cell');
      //row.classList.add('selected-row');
      //document.querySelectorAll('.selected-cell').forEach(cell => cell.classList.add(...selectedCellClasses));
      //document.querySelectorAll('.selected-row').forEach(row => row.classList.add(...selectedRowClasses));
      //document.querySelectorAll('.selected-row').forEach(row => row.childNodes[0].classList.add(...selectedRowNumberClasses));
      //return false;
    }

    function saveCell(e) {
      this.classList.add('hidden');
      renderCell(this.parentNode);
      return false;
    }

    //initNewRecord();
    function initNewRecord() {
      let newRecord = document.querySelector('.add-new-record');
      newRecord.querySelectorAll('input').forEach(function (element) {
        element.addEventListener('keydown', addRow);
      });
    }

    function addRow(e) {

      let row = this.parentNode.parentNode
      let newRow = row.cloneNode(true);
      row.classList.remove('add-new-record');
      let newRowClasses = ['border-t', 'border-b', 'border-green-400'];
      row.classList.add(...newRowClasses);

      row.querySelectorAll('input').forEach(function (element) {
        element.removeEventListener('keydown', addRow);
      });

      let idMax = selectTableById(activeTable).records.map(record => record[0]).reduce((a, b) => (a.id > b.id) ? a : b);
      selectTableById(activeTable).records.push([idMax+ 1,'']);
      row.querySelectorAll('input')[0].setAttribute('value', idMax + 1);
      let rowNumber = document.querySelectorAll('.t-body .t-row').length;
      let rowNumberCell = row.querySelector('.t-row-header');
      rowNumberCell.innerHTML = `${rowNumber}*`;
      rowNumberCell.classList.add('text-green-400', 'font-bold')

      let newRowCount = document.querySelector('.row-wrapper--add').querySelectorAll('.t-row').length;

      if (newRowCount == 1) {
        let repositionWarning = document.createElement('div');
        repositionWarning.innerHTML = `<div class="text-white text-xs bg-green-600 p-1">New records will be repositioned on refresh</div>`
        document.querySelector('.row-wrapper--add').prepend(repositionWarning);
      }
      document.querySelector('.row-wrapper--add').append(newRow);

      //row.querySelectorAll('input').forEach(cell => renderCell(cell));

      //initNewRecord();
    }

    let addColumnBtn = document.querySelector('#add-column');

    addColumnBtn.addEventListener('click', addColumn);

    //addColumn();

    function addColumn() {
      let wrapper = document.querySelector('.table-wrapper');
      wrapper.appendChild(createAddColumnMenu(schemaTables))
    }

    

    function createAddColumnMenu(schemaTables) {

      let typeIcon = function (column) {
        console.log(column.type)
        if (column.type == 'text') {
          return 'text';
        } else if (column.type == 'number') {
          return 'hashtag';
        } else if (column.type == 'duration') {
          return 'time-line';
        } else {
          return 'question-mark';
        }
      }

      let listColumns = table => table.columns.map(col => `<a href="#" class="block px-2 py-1"><i class="ri-${typeIcon(col)} text-xs text-${table.color}-400 align-text-bottom border border-${table.color}-400 rounded mr-2"></i><span class="${theme.textColor}">${col.name}</span></a>`).join('');
      let tables = schemaTables.tables.map(table => `<div class="px-2 py-1 border-b ${theme.mediumBorderColor}"><span class="${theme.mediumTextColor} text-sm"><i class="ri-table-fill align-bottom mr-1"></i>From ${table.name}</span></div><div>${listColumns(table)}</div>`).join('');
      let html =
        `<div class="${theme.backgroundColor} border ${theme.mediumBorderColor}">
        <h4 class="text-xs ${theme.mutedTextColor} py-1 px-2">Add Column</h4>
        <input type="text" class="${theme.inputBackgroundColor} w-full p-2 text-sm ${theme.textColor} border-b ${theme.mediumBorderColor}" placeholder="Type to search">
        <div>${tables}</div>
      </div>`;
      let menuHtml = document.createElement('div');
      menuHtml.innerHTML = html;
      return menuHtml;
    }

  </script>

  <script src="js/vendor/modernizr-3.11.2.min.js"></script>
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>
</body>

</html>
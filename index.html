<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8">
  <title></title>
  <base href="/">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">


  <meta name="theme-color" content="#fafafa">

</head>

<body class="mediumBackgroundColor">

  <!-- Add your site or application content here -->

  <div style="height: 100vh;">
    <div class="py-2 px-3 mediumBorderColor border-b backgroundColor flex items-center space-x-3">
      <div class="flex space-x-2 items-center">
        <div class="primaryColor inverseTextColor text-sm px-1 rounded">M</div>
        <div class="textColor">album_collection</div>
      </div>
      <input type="text" class="inputBackgroundColor w-full p-2 text-sm textColor" placeholder="Search or jump toâ€¦">
      <button class="textColor py-1 px-2 border mediumBorderColor swap-theme"><i class="ri-sun-fill"></i></button>
    </div>
    <div class="grid grid-cols-6 justify-items-stretch h-full">
      <div class="col-span-1">
        <div class="backgroundColor h-full mediumBorderColor border-r sidebar-wrapper">
          <div class="flex items-center">
            <input type="text" class="inputBackgroundColor w-full p-2 text-sm textColor" placeholder="Type to search">
            <button class="px-2"><i class="ri-menu-line textColor align-bottom"></i></button>

          </div>
          <div class="mediumBorderColor border-b border-t px-3 py-2 flex space-x-3 items-center">
            <h4 class="textColor uppercase text-xs font-semibold">Views</h4>
            <div class="lightBackgroundColor rounded px-1 text-xs">3</div>
          </div>
          <ul class="my-2">
            <li class="textColor"><a href="#" class="block py-1 px-3 accentBackgroundColor"><i
                  class="ri-grid-fill align-bottom mr-1"></i>
                Total Tracks by Artist</a></li>
            <li class="textColor"><a href="#" class="block py-1 px-3"><i class="ri-grid-fill align-bottom mr-1"></i>
                Summer Playlist</a></li>
            <li class="textColor"><a href="#" class="block py-1 px-3"><i class="ri-grid-fill align-bottom mr-1"></i>
                Award-Winning Releases</a></li>
          </ul>
          <div class="mediumBorderColor border-b border-t px-3 py-2 flex space-x-3 items-center">
            <h4 class="textColor uppercase text-xs font-semibold">Tables</h4>
            <div class="lightBackgroundColor rounded px-1 text-xs">3</div>
          </div>
          <ul class="my-2">
            <li class="textColor"><a href="#" class="block py-1 px-3"><i class="ri-table-fill align-bottom mr-1"></i>
                artist</a></li>
            <li class="textColor"><a href="#" class="block py-1 px-3"><i class="ri-table-fill align-bottom mr-1"></i>
                release</a></li>
            <li class="textColor"><a href="#" class="block py-1 px-3"><i class="ri-table-fill align-bottom mr-1"></i>
                track</a></li>
          </ul>
        </div>

      </div>
      <div class="col-span-5">
        <div class="mediumBackgroundColor flex">
          <div class="textColor text-sm py-2 px-3"><i class="ri-table-fill align-bottom mr-1"></i> release <i
              class="ri-close-line align-bottom ml-3"></i> </div>
          <div class="textColor accentBackgroundColor text-sm py-2 px-3"><i class="ri-grid-fill align-bottom mr-1"></i>
            Total
            Tracks by Artist <i class="ri-close-line align-bottom ml-3"></i> </div>
          <div class="textColor text-sm py-2 px-3"><i class="ri-table-fill align-bottom mr-1"></i> artist <i
              class="ri-close-line align-bottom ml-3"></i> </div>

          <button class="primaryColor inverseTextColor px-3 text-sm"><i class="ri-add-line align-bottom"></i></button>
        </div>
        <div class="accentBackgroundColor border-b mediumBorderColor py-2 px-3 flex space-x-6 items-center">
          <h3 class="textColor text-lg">Total Releases by Artist <i class="ri-arrow-down-s-line align-bottom"></i></h3>
          <button class="textColor border lightBorderColor px-2 py-1"><i class="ri-add-line align-bottom"></i>
            Record</button>
          <div class="space-x-4 flex items-center">
            <button class="space-x-1 mediumBackgroundColor primaryBorderColor border py-1 px-2"><i
                class="ri-filter-line align-bottom textColor"></i><span class="font-semibold textColor">Filter</span>
              <div class="primaryColor inverseTextColor align-text-bottom inline-block rounded px-1 text-xs">3</div>
            </button>
            <div class="textColor">Sort</div>
            <div class="textColor">Group</div>
          </div>
          <button class="textColor border lightBorderColor px-2 py-1"><i class="ri-save-fill align-bottom"></i>
            Save</button>
          <div class="mutedTextColor">Saving Changes</div>
        </div>
        <div class="mediumBackgroundColor h-full flex items-start table-wrapper">

          <button class="primaryColor inverseTextColor py-2 px-3" id="add-column"><i
              class="ri-add-line align-bottom"></i></button>

        </div>
      </div>
    </div>

  </div>


  <script type="text/javascript">

    var darkTheme = {
      backgroundColor: 'bg-gray-900',
      mediumBackgroundColor: 'bg-gray-800',
      accentBackgroundColor: 'bg-gray-700',
      lightBackgroundColor: 'bg-gray-200',
      darkBorderColor: 'border-gray-500',
      mediumBorderColor: 'border-gray-600',
      lightBorderColor: 'border-gray-500',
      textColor: 'text-gray-100',
      inverseTextColor: 'text-dark',
      mutedTextColor: 'text-gray-400',
      mediumTextColor: 'text-gray-200',
      tableBorderColor: 'border-gray-600',
      tableBackgroundColor: 'bg-gray-800',
      tableHeaderBackgroundColor: 'bg-gray-800',
      primaryColor: 'bg-indigo-300',
      primaryBorderColor: 'border-indigo-300',
      inputBackgroundColor: 'bg-gray-700'
    };

    var lightTheme = {
      backgroundColor: 'bg-white',
      mediumBackgroundColor: 'bg-gray-200',
      accentBackgroundColor: 'bg-white',
      lightBackgroundColor: 'bg-gray-100',
      darkBorderColor: 'border-gray-600',
      mediumBorderColor: 'border-gray-400',
      lightBorderColor: 'border-gray-100',
      textColor: 'text-gray-600',
      inverseTextColor: 'text-white',
      mutedTextColor: 'text-gray-800',
      mediumTextColor: 'text-gray-900',
      tableBorderColor: 'border-gray-300',
      tableBackgroundColor: 'bg-white',
      tableHeaderBackgroundColor: 'bg-white',
      primaryColor: 'bg-indigo-400',
      primaryBorderColor: 'border-indigo-300',
      inputBackgroundColor: 'bg-gray-100'
    }

    document.querySelector('.swap-theme').addEventListener('click', changeTheme);
    document.querySelector('.swap-theme').selectTheme = lightTheme;

    const urlParams = new URLSearchParams(window.location.search);
    var activeTheme = urlParams.get('theme');
    console.log(activeTheme)

    function changeTheme(evt) {
      console.log(evt)
      //for (const property in evt.currentTarget.selectTheme) {applyTheme(property, evt.currentTarget.selectTheme[property]);}
    }

    var defaultTheme = darkTheme;

    if (activeTheme == 'darkTheme') {
      var theme = darkTheme;
    } else if (activeTheme == 'lightTheme') {
      var theme = lightTheme;
    } else {
      var theme = defaultTheme;
    }

    for (const property in theme) { applyTheme(property, theme[property]); }

    function applyTheme(property, color) {
      document.querySelectorAll(`.${property}`).forEach(el => {
        el.classList.add(`${color}`);
      });
    }


    var tableColumns = [{
      name: 'artist',
      columns: [
        { id: 0, name: 'id', type: 'number', readOnly:true},
        { id: 1, name: 'artistName', type: 'text' }
      ],
      records: [
        [450, 'Patti Smith'],
        [451, 'Elvis Costello'],
        [451, 'Kylie Minogue'],
        [451, 'Artic Monkeys'],
        [453, 'Scorpions']
      ],
      color: 'purple'
    }, {
      name: 'release',
      columns: [
        { id: 2, name: 'id', type: 'number', readOnly:true},
        { id: 3, name: 'releaseName', type: 'text' },
        { id: 4, name: 'releaseGenre', type: 'text' }
      ],
      records: [
        [450, 'Aqua'],
        [451, 'Elvis Costello']
      ],
      color: 'green'
    }, {
      name: 'track',
      columns: [
        { id: 5, name: 'id', type: 'number', readOnly:true},
        { id: 6, name: 'trackName', type: 'text' },
        { id: 7, name: 'trackLength', type: 'duration' }
      ],
      records: [
        [450, 'Aqua'],
        [451, 'Elvis Costello']
      ],
      color: 'pink'
    }];

    var viewColumns = [
      {
        name: 'Total Releases by Artist',
        columns: [1, 6]
      }
    ];

    var activeTable = tableColumns[0];

    activeTable.records.push([450, 'Gorillaz'])

    document.querySelector('.table-wrapper').prepend(createTable(activeTable));


    function createTable(obj) {

      let typeIcon = function (type) {
        if (type == 'text') {
          return 'text';
        } else if (type == 'number') {
          return 'hashtag';
        } else if (type == 'duration') {
          return 'time-line';
        }
      }

      let createHeader = function (col) {
        let header = `<div class="t-cell p-2 ${theme.textColor}"><i class="ri-${typeIcon(col.type)} align-bottom border border-gray-500 rounded mr-2"></i>${col.name}</div>`;
        return header;
      };

      let createRow = function (record, index) {
        let rowCount = index + 1;
        let cells = record.map(cell => `<div class="t-cell border-r ${theme.tableBorderColor} editable-cell"><input class="${theme.inputBackgroundColor} ${theme.textColor} p-2 w-full" value="${cell}" type="text"></div>`).join('')
        let row = `<div class="t-row border-b ${theme.tableBorderColor}"><div class="t-cell py-2 px-3 ${theme.mutedTextColor} border-r ${theme.tableBorderColor} text-xs">${rowCount}</div>${cells}</div>`;
        return row;
      }

      let createNewRow = function (columns) {
        
        let inputControl = function(col) {
          if (col.readOnly) {
            return `<input class="${theme.inputBackgroundColor} ${theme.textColor} p-2 w-full" readOnly="true" type="text" placeholder='New Record'>`
          } else {
          return `<input class="${theme.inputBackgroundColor} ${theme.textColor} p-2 w-full" value="" type="text">`
          }
        }
        let cells = columns.map(col => `<div class="t-cell border-r ${theme.tableBorderColor}">${inputControl(col)}</div>`).join('');
        let row = `<div class="t-row border-b ${theme.tableBorderColor} add-new-record"><div class="t-cell py-2 px-3 ${theme.mutedTextColor} border-r ${theme.tableBorderColor} text-xs">*</div>${cells}</div>`
        return row;
      }

      let headers = obj.columns.map(col => createHeader(col)).join('');

      let records = obj.records.map((record, index) => createRow(record, index)).join('');

      let newRecord = createNewRow(obj.columns);

      let table = document.createElement('div');
      let tableClasses = ['t-table', theme.darkBackgroundColor];
      table.classList.add(...tableClasses);
      table.innerHTML = `
      <div class="t-row border-b ${theme.tableBorderColor}">
        <div class="t-cell"></div>${headers}
      </div>
      <div class="t-body row-wrapper">${records}</div>
      <div class="t-body row-wrapper row-wrapper--add">${newRecord}</div>`;

      renderAllCells(table);
      return table; 
    }

    function renderAllCells(obj) {
      let cellInputs = obj.querySelectorAll('.editable-cell');
      cellInputs.forEach(function (el) {
        let cellInput = el.querySelector('input');
        cellInput.classList.add('hidden');
        renderCell(cellInput);
      });
    }

    function renderCell(el) {
      let cellValue = el.value;
      let contentWrapper = document.createElement('div');
      let cellContent = val => val !== '' ? `<div class="p-2 ${theme.backgroundColor} ${theme.textColor}">${val}</div>` : `<div class="p-2 ${theme.backgroundColor} ${theme.mutedTextColor}">null</div>`;
      let cellParent = el.parentNode;
      contentWrapper.innerHTML = cellContent(cellValue);
      cellParent.appendChild(contentWrapper);
      contentWrapper.addEventListener('click', editCell);
      el.addEventListener('blur', saveCell);
    }

    function editCell() {
      let cellInput = this.parentNode.querySelector('input');
      cellInput.classList.remove('hidden');
      cellInput.focus();
      this.remove();
    }

    function saveCell() {
      this.classList.add('hidden');
      renderCell(this);
    }

    initNewRecord();
    function initNewRecord() {
      let newRecord = document.querySelector('.add-new-record');
      newRecord.querySelectorAll('input').forEach(function (element) {
        element.addEventListener('keydown', addRow);
      });
    }

    function addRow(e) {

      let row = this.parentNode.parentNode
      let newRow = row.cloneNode(true);
      row.classList.remove('add-new-record');
      let newRowClasses = ['border-t', 'border-b', 'border-green-400'];
      row.classList.add(...newRowClasses);

      row.querySelectorAll('input').forEach(function (element) {
        element.removeEventListener('keydown', addRow);
      });

      let idMax = activeTable.records.map(record => record[0]).reduce((a, b) => (a.id > b.id) ? a : b);
      console.log(idMax);
      activeTable.records.push([idMax+ 1,'']);
      row.querySelectorAll('input')[0].setAttribute('value', idMax + 1);
      let rowNumber = document.querySelectorAll('.t-body .t-row').length;
      let rowNumberCell = row.querySelectorAll('.t-cell')[0];
      rowNumberCell.innerHTML = `${rowNumber}*`;
      rowNumberCell.classList.add('text-green-400', 'font-bold')

      let newRowCount = document.querySelector('.row-wrapper--add').querySelectorAll('.t-row').length;

      if (newRowCount == 1) {
        let repositionWarning = document.createElement('div');
        repositionWarning.innerHTML = `<div class="text-white text-xs bg-green-600 p-1">New records will be repositioned on refresh</div>`
        document.querySelector('.row-wrapper--add').prepend(repositionWarning);
      }
      document.querySelector('.row-wrapper--add').append(newRow);

      //row.querySelectorAll('input').forEach(cell => renderCell(cell));

      initNewRecord();
    }

    let addColumnBtn = document.querySelector('#add-column');

    addColumnBtn.addEventListener('click', addColumn);

    //addColumn();

    function addColumn() {
      let wrapper = document.querySelector('.table-wrapper');
      wrapper.appendChild(createAddColumnMenu())
    }

    function createAddColumnMenu() {

      let typeIcon = function (column) {
        console.log(column.type)
        if (column.type == 'text') {
          return 'text';
        } else if (column.type == 'number') {
          return 'hashtag';
        } else if (column.type == 'duration') {
          return 'time-line';
        }
      }


      let listColumns = table => table.columns.map(col => `<a href="#" class="block px-2 py-1"><i class="ri-${typeIcon(col)} text-xs text-${table.color}-400 align-text-bottom border border-${table.color}-400 rounded mr-2"></i><span class="${theme.textColor}">${col.name}</span></a>`).join('');
      let tables = tableColumns.map(table => `<div class="px-2 py-1 border-b ${theme.mediumBorderColor}"><span class="${theme.mediumTextColor} text-sm"><i class="ri-table-fill align-bottom mr-1"></i>From ${table.name}</span></div><div>${listColumns(table)}</div>`).join('');
      let html =
        `<div class="${theme.backgroundColor} border ${theme.mediumBorderColor}">
        <h4 class="text-xs ${theme.mutedTextColor} py-1 px-2">Add Column</h4>
        <input type="text" class="${theme.inputBackgroundColor} w-full p-2 text-sm ${theme.textColor} border-b ${theme.mediumBorderColor}" placeholder="Type to search">
        <div>${tables}</div>
      </div>`;
      let menuHtml = document.createElement('div');
      menuHtml.innerHTML = html;
      return menuHtml;
    }

  </script>

  <script src="js/vendor/modernizr-3.11.2.min.js"></script>
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>
</body>

</html>
import{c as gt,a as vt}from"./lodash-8a03b776.js";var St={exports:{}};(function(rt,yt){(function(ue){rt.exports=ue()})(function(){return function(){function ue(ve,Te,ke){function A(fe,ge){if(!Te[fe]){if(!ve[fe]){var U=typeof vt=="function"&&vt;if(!ge&&U)return U(fe,!0);if(J)return J(fe,!0);var m=new Error("Cannot find module '"+fe+"'");throw m.code="MODULE_NOT_FOUND",m}var w=Te[fe]={exports:{}};ve[fe][0].call(w.exports,function(N){var te=ve[fe][1][N];return A(te||N)},w,w.exports,ue,ve,Te,ke)}return Te[fe].exports}for(var J=typeof vt=="function"&&vt,ye=0;ye<ke.length;ye++)A(ke[ye]);return A}return ue}()({1:[function(ue,ve,Te){const ke=ue("./utils"),A=function(){const J=ke.stringToArray,ye=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],fe=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],ge=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],U=["Thousand","Million","Billion","Trillion"];function m(c,g){var d=function(P,S,b){var M="";if(P<=19)M=(S?" and ":"")+(b?fe[P]:ye[P]);else if(P<100){const ne=Math.floor(P/10),re=P%10;M=(S?" and ":"")+ge[ne-2],re>0?M+="-"+d(re,!1,b):b&&(M=M.substring(0,M.length-1)+"ieth")}else if(P<1e3){const ne=Math.floor(P/100),re=P%100;M=(S?", ":"")+ye[ne]+" Hundred",re>0?M+=d(re,!0,b):b&&(M+="th")}else{var $=Math.floor(Math.log10(P)/3);$>U.length&&($=U.length);const ne=Math.pow(10,$*3),re=Math.floor(P/ne),Y=P-re*ne;M=(S?", ":"")+d(re,!1,!1)+" "+U[$-1],Y>0?M+=d(Y,!0,b):b&&(M+="th")}return M},D=d(c,!1,g);return D}const w={};ye.forEach(function(c,g){w[c.toLowerCase()]=g}),fe.forEach(function(c,g){w[c.toLowerCase()]=g}),ge.forEach(function(c,g){const d=c.toLowerCase();w[d]=(g+2)*10,w[d.substring(0,c.length-1)+"ieth"]=w[d]}),w.hundredth=100,U.forEach(function(c,g){const d=c.toLowerCase(),D=Math.pow(10,(g+1)*3);w[d]=D,w[d+"th"]=D});function N(c){const d=c.split(/,\s|\sand\s|[\s\\-]/).map(S=>w[S]);let D=[0];return d.forEach(S=>{if(S<100){let b=D.pop();b>=1e3&&(D.push(b),b=0),D.push(b+S)}else D.push(D.pop()*S)}),D.reduce((S,b)=>S+b,0)}const te=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],ie={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function ce(c){for(var g=0;g<te.length;g++){const d=te[g];if(c>=d[0])return d[1]+ce(c-d[0])}return""}function j(c){for(var g=0,d=1,D=c.length-1;D>=0;D--){const P=c[D],S=ie[P];S<d?g-=S:(d=S,g+=S)}return g}function O(c,g){for(var d=[],D=g.charCodeAt(0);c>0;)d.unshift(String.fromCharCode((c-1)%26+D)),c=Math.floor((c-1)/26);return d.join("")}function q(c,g){for(var d=g.charCodeAt(0),D=0,P=0;P<c.length;P++)D+=(c.charCodeAt(c.length-P-1)-d+1)*Math.pow(26,P);return D}function h(c,g){if(typeof c=="undefined")return;c=Math.floor(c);const d=T(g);return v(c,d)}const E={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},p={UPPER:"upper",LOWER:"lower",TITLE:"title"};function v(c,g){let d;const D=c<0;switch(c=Math.abs(c),g.primary){case E.LETTERS:d=O(c,g.case===p.UPPER?"A":"a");break;case E.ROMAN:d=ce(c),g.case===p.UPPER&&(d=d.toUpperCase());break;case E.WORDS:d=m(c,g.ordinal),g.case===p.UPPER?d=d.toUpperCase():g.case===p.LOWER&&(d=d.toLowerCase());break;case E.DECIMAL:d=""+c;var P=g.mandatoryDigits-d.length;if(P>0){var S=new Array(P+1).join("0");d=S+d}if(g.zeroCode!==48&&(d=J(d).map(ne=>String.fromCodePoint(ne.codePointAt(0)+g.zeroCode-48)).join("")),g.regular){const ne=Math.floor((d.length-1)/g.groupingSeparators.position);for(let re=ne;re>0;re--){const Y=d.length-re*g.groupingSeparators.position;d=d.substr(0,Y)+g.groupingSeparators.character+d.substr(Y)}}else g.groupingSeparators.reverse().forEach(ne=>{const re=d.length-ne.position;d=d.substr(0,re)+ne.character+d.substr(re)});if(g.ordinal){var b={"1":"st","2":"nd","3":"rd"},M=d[d.length-1],$=b[M];(!$||d.length>1&&d[d.length-2]==="1")&&($="th"),d=d+$}break;case E.SEQUENCE:throw{code:"D3130",value:g.token}}return D&&(d="-"+d),d}const k=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function T(c){const g={type:"integer",primary:E.DECIMAL,case:p.LOWER,ordinal:!1};let d,D;const P=c.lastIndexOf(";");switch(P===-1?d=c:(d=c.substring(0,P),D=c.substring(P+1),D[0]==="o"&&(g.ordinal=!0)),d){case"A":g.case=p.UPPER;case"a":g.primary=E.LETTERS;break;case"I":g.case=p.UPPER;case"i":g.primary=E.ROMAN;break;case"W":g.case=p.UPPER,g.primary=E.WORDS;break;case"Ww":g.case=p.TITLE,g.primary=E.WORDS;break;case"w":g.primary=E.WORDS;break;default:{let S=null,b=0,M=0,$=[],ne=0;if(J(d).map(Y=>Y.codePointAt(0)).reverse().forEach(Y=>{let W=!1;for(let ee=0;ee<k.length;ee++){const _=k[ee];if(Y>=_&&Y<=_+9){if(W=!0,b++,ne++,S===null)S=_;else if(_!==S)throw{code:"D3131"};break}}W||(Y===35?(ne++,M++):$.push({position:ne,character:String.fromCodePoint(Y)}))}),b>0){g.primary=E.DECIMAL,g.zeroCode=S,g.mandatoryDigits=b,g.optionalDigits=M;const W=function(ee){if(ee.length===0)return 0;const _=ee[0].character;for(let Se=1;Se<ee.length;Se++)if(ee[Se].character!==_)return 0;const xe=ee.map(Se=>Se.position),_e=function(Se,Pe){return Pe===0?Se:_e(Pe,Se%Pe)},Ce=xe.reduce(_e);for(let Se=1;Se<=xe.length;Se++)if(xe.indexOf(Se*Ce)===-1)return 0;return Ce}($);W>0?(g.regular=!0,g.groupingSeparators={position:W,character:$[0].character}):(g.regular=!1,g.groupingSeparators=$)}else g.primary=E.SEQUENCE,g.token=d}}return g}const F={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function I(c){var g=[];const d={type:"datetime",parts:g},D=function(W,ee){if(ee>W){let _=c.substring(W,ee);_=_.split("]]").join("]"),g.push({type:"literal",value:_})}};for(var P=0,S=0;S<c.length;){if(c.charAt(S)==="["){if(c.charAt(S+1)==="["){D(P,S),g.push({type:"literal",value:"["}),S+=2,P=S;continue}if(D(P,S),P=S,S=c.indexOf("]",P),S===-1)throw{code:"D3135"};let W=c.substring(P+1,S);W=W.split(/\s+/).join("");var b={type:"marker",component:W.charAt(0)},M=W.lastIndexOf(","),$;if(M!==-1){const ee=W.substring(M+1),_=ee.indexOf("-");let xe,_e;const Ce=function(Pe){if(!(typeof Pe=="undefined"||Pe==="*"))return parseInt(Pe)};_===-1?xe=ee:(xe=ee.substring(0,_),_e=ee.substring(_+1));const Se={min:Ce(xe),max:Ce(_e)};b.width=Se,$=W.substring(1,M)}else $=W.substring(1);if($.length===1)b.presentation1=$;else if($.length>1){var ne=$.charAt($.length-1);"atco".indexOf(ne)!==-1?(b.presentation2=ne,ne==="o"&&(b.ordinal=!0),b.presentation1=$.substring(0,$.length-1)):b.presentation1=$}else b.presentation1=F[b.component];if(typeof b.presentation1=="undefined")throw{code:"D3132",value:b.component};if(b.presentation1[0]==="n")b.names=p.LOWER;else if(b.presentation1[0]==="N")b.presentation1[1]==="n"?b.names=p.TITLE:b.names=p.UPPER;else if("YMDdFWwXxHhmsf".indexOf(b.component)!==-1){var re=b.presentation1;if(b.presentation2&&(re+=";"+b.presentation2),b.integerFormat=T(re),b.width&&b.width.min!==void 0&&b.integerFormat.mandatoryDigits<b.width.min&&(b.integerFormat.mandatoryDigits=b.width.min),"YMD".indexOf(b.component)!==-1)if(b.n=-1,b.width&&b.width.max!==void 0)b.n=b.width.max,b.integerFormat.mandatoryDigits=b.n;else{var Y=b.integerFormat.mandatoryDigits+b.integerFormat.optionalDigits;Y>=2&&(b.n=Y)}}(b.component==="Z"||b.component==="z")&&(b.integerFormat=T(b.presentation1)),g.push(b),P=S+1}S++}return D(P,S),d}const L=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ae=["January","February","March","April","May","June","July","August","September","October","November","December"],De=1e3*60*60*24,Z=function(c){const g=Date.UTC(c.year,c.month);var d=new Date(g).getUTCDay();return d===0&&(d=7),d>4?g+(8-d)*De:g-(d-1)*De},H=function(c,g){return{year:c,month:g,nextMonth:function(){return g===11?H(c+1,0):H(c,g+1)},previousMonth:function(){return g===0?H(c-1,11):H(c,g-1)},nextYear:function(){return H(c+1,g)},previousYear:function(){return H(c-1,g)}}},Ae=function(c,g){return(g-c)/(De*7)+1},G=(c,g)=>{let d;switch(g){case"Y":d=c.getUTCFullYear();break;case"M":d=c.getUTCMonth()+1;break;case"D":d=c.getUTCDate();break;case"d":{const D=Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),P=Date.UTC(c.getUTCFullYear(),0);d=(D-P)/De+1;break}case"F":d=c.getUTCDay(),d===0&&(d=7);break;case"W":{const D=H(c.getUTCFullYear(),0),P=Z(D),S=Date.UTC(D.year,c.getUTCMonth(),c.getUTCDate());let b=Ae(P,S);if(b>52){const M=Z(D.nextYear());S>=M&&(b=1)}else if(b<1){const M=Z(D.previousYear());b=Ae(M,S)}d=Math.floor(b);break}case"w":{const D=H(c.getUTCFullYear(),c.getUTCMonth()),P=Z(D),S=Date.UTC(D.year,D.month,c.getUTCDate());let b=Ae(P,S);if(b>4){const M=Z(D.nextMonth());S>=M&&(b=1)}else if(b<1){const M=Z(D.previousMonth());b=Ae(M,S)}d=Math.floor(b);break}case"X":{const D=H(c.getUTCFullYear(),0),P=Z(D),S=Z(D.nextYear()),b=c.getTime();b<P?d=D.year-1:b>=S?d=D.year+1:d=D.year;break}case"x":{const D=H(c.getUTCFullYear(),c.getUTCMonth()),P=Z(D),S=D.nextMonth(),b=Z(S),M=c.getTime();M<P?d=D.previousMonth().month+1:M>=b?d=S.month+1:d=D.month+1;break}case"H":d=c.getUTCHours();break;case"h":d=c.getUTCHours(),d=d%12,d===0&&(d=12);break;case"P":d=c.getUTCHours()>=12?"pm":"am";break;case"m":d=c.getUTCMinutes();break;case"s":d=c.getUTCSeconds();break;case"f":d=c.getUTCMilliseconds();break;case"Z":case"z":break;case"C":d="ISO";break;case"E":d="ISO";break}return d};let we=null;function Be(c,g,d){var D=0,P=0;if(typeof d!="undefined"){const re=parseInt(d);D=Math.floor(re/100),P=re%100}var S=function(re,Y){var W=G(re,Y.component);if("YMDdFWwXxHhms".indexOf(Y.component)!==-1)if(Y.component==="Y"&&Y.n!==-1&&(W=W%Math.pow(10,Y.n)),Y.names){if(Y.component==="M"||Y.component==="x")W=ae[W-1];else if(Y.component==="F")W=L[W];else throw{code:"D3133",value:Y.component};Y.names===p.UPPER?W=W.toUpperCase():Y.names===p.LOWER&&(W=W.toLowerCase()),Y.width&&W.length>Y.width.max&&(W=W.substring(0,Y.width.max))}else W=v(W,Y.integerFormat);else if(Y.component==="f")W=v(W,Y.integerFormat);else if(Y.component==="Z"||Y.component==="z"){const ee=D*100+P;if(Y.integerFormat.regular)W=v(ee,Y.integerFormat);else{const _=Y.integerFormat.mandatoryDigits;if(_===1||_===2)W=v(D,Y.integerFormat),P!==0&&(W+=":"+h(P,"00"));else if(_===3||_===4)W=v(ee,Y.integerFormat);else throw{code:"D3134",value:_}}ee>=0&&(W="+"+W),Y.component==="z"&&(W="GMT"+W),ee===0&&Y.presentation2==="t"&&(W="Z")}return W};let b;typeof g=="undefined"?(we===null&&(we=I("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),b=we):b=I(g);const M=(60*D+P)*60*1e3,$=new Date(c+M);let ne="";return b.parts.forEach(function(re){re.type==="literal"?ne+=re.value:ne+=S($,re)}),ne}function o(c){var g={};if(c.type==="datetime")g.type="datetime",g.parts=c.parts.map(function(d){var D={};if(d.type==="literal")D.regex=d.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(d.component==="Z"||d.component==="z"){let S;Array.isArray(d.integerFormat.groupingSeparators)||(S=d.integerFormat.groupingSeparators),D.regex="",d.component==="z"&&(D.regex="GMT"),D.regex+="[-+][0-9]+",S&&(D.regex+=S.character+"[0-9]+"),D.parse=function(b){d.component==="z"&&(b=b.substring(3));let M=0,$=0;return S?(M=Number.parseInt(b.substring(0,b.indexOf(S.character))),$=Number.parseInt(b.substring(b.indexOf(S.character)+1))):b.length-1<=2?M=Number.parseInt(b):(M=Number.parseInt(b.substring(0,3)),$=Number.parseInt(b.substring(3))),M*60+$}}else if(d.integerFormat)d.integerFormat.n=d.n,D=o(d.integerFormat);else{D.regex="[a-zA-Z]+";var P={};if(d.component==="M"||d.component==="x")ae.forEach(function(S,b){d.width&&d.width.max?P[S.substring(0,d.width.max)]=b+1:P[S]=b+1});else if(d.component==="F")L.forEach(function(S,b){b>0&&(d.width&&d.width.max?P[S.substring(0,d.width.max)]=b:P[S]=b)});else if(d.component==="P")P={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:d.component};D.parse=function(S){return P[S]}}return D.component=d.component,D});else{g.type="integer";const d=c.case===p.UPPER;let D;switch(c.n&&c.n>0?c.optionalDigits===0?D=`{${c.n}}`:D=`{${c.n-c.optionalDigits},${c.n}}`:D="+",c.primary){case E.LETTERS:g.regex=d?"[A-Z]+":"[a-z]+",g.parse=function(P){return q(P,d?"A":"a")};break;case E.ROMAN:g.regex=d?"[MDCLXVI]+":"[mdclxvi]+",g.parse=function(P){return j(d?P:P.toUpperCase())};break;case E.WORDS:g.regex="(?:"+Object.keys(w).concat("and","[\\-, ]").join("|")+")+",g.parse=function(P){return N(P.toLowerCase())};break;case E.DECIMAL:g.regex=`[0-9]${D}`,c.ordinal&&(g.regex+="(?:th|st|nd|rd)"),g.parse=function(P){let S=P;return c.ordinal&&(S=P.substring(0,P.length-2)),c.regular?S=S.split(",").join(""):c.groupingSeparators.forEach(b=>{S=S.split(b.character).join("")}),c.zeroCode!==48&&(S=S.split("").map(b=>String.fromCodePoint(b.codePointAt(0)-c.zeroCode+48)).join("")),parseInt(S)};break;case E.SEQUENCE:throw{code:"D3130",value:c.token}}}return g}function f(c,g){if(typeof c=="undefined")return;const d=T(g);return o(d).parse(c)}function R(c,g){const d=I(g),D=o(d),P="^"+D.parts.map($=>"("+$.regex+")").join("")+"$";var b=new RegExp(P,"i").exec(c);if(b!==null){const _={};for(let t=1;t<b.length;t++){const i=D.parts[t-1];i.parse&&(_[i.component]=i.parse(b[t]))}if(Object.getOwnPropertyNames(_).length===0)return;let xe=0;const _e=t=>{xe<<=1,xe+=t?1:0},Ce=t=>!(~t&xe)&&!!(t&xe);"YXMxWwdD".split("").forEach(t=>_e(_[t]));const Pe=!Ce(161)&&Ce(130),He=Ce(84),Xe=!He&&Ce(72);xe=0,"PHhmsf".split("").forEach(t=>_e(_[t]));const C=!Ce(23)&&Ce(47),Ye=(Pe?"YD":He?"XxwF":Xe?"XWF":"YMD")+(C?"Phmsf":"Hmsf"),at=this.environment.timestamp;let qe=!1,Ge=!1;if(Ye.split("").forEach(t=>{if(typeof _[t]=="undefined")qe?(_[t]="MDd".indexOf(t)!==-1?1:0,Ge=!0):_[t]=G(at,t);else if(qe=!0,Ge)throw{code:"D3136"}}),_.M>0?_.M-=1:_.M=0,Pe){const t=Date.UTC(_.Y,0),i=(_.d-1)*1e3*60*60*24,s=new Date(t+i);_.M=s.getUTCMonth(),_.D=s.getUTCDate()}if(He)throw{code:"D3136"};if(Xe)throw{code:"D3136"};C&&(_.H=_.h===12?0:_.h,_.P===1&&(_.H+=12));var M=Date.UTC(_.Y,_.M,_.D,_.H,_.m,_.s,_.f);return(_.Z||_.z)&&(M-=(_.Z||_.z)*60*1e3),M}}var Q=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function de(c,g){if(typeof c!="undefined")if(typeof g=="undefined"){if(!Q.test(c))throw{stack:new Error().stack,code:"D3110",value:c};return Date.parse(c)}else return R.call(this,c,g)}function le(c,g,d){if(typeof c!="undefined")return Be.call(this,c,g,d)}return{formatInteger:h,parseInteger:f,fromMillis:le,toMillis:de}}();ve.exports=A},{"./utils":6}],2:[function(ue,ve,Te){(function(ke){(function(){var A=ue("./utils");const J=(()=>{var ye=A.isNumeric,fe=A.isArrayOfStrings,ge=A.isArrayOfNumbers,U=A.createSequence,m=A.isSequence,w=A.isFunction,N=A.isLambda,te=A.isIterable,ie=A.getFunctionArity,ce=A.isDeepEqual,j=A.stringToArray;function O(e){if(typeof e!="undefined"){var n=0;return e.forEach(function(r){n+=r}),n}}function q(e){return typeof e=="undefined"?0:e.length}function h(e){if(!(typeof e=="undefined"||e.length===0))return Math.max.apply(Math,e)}function E(e){if(!(typeof e=="undefined"||e.length===0))return Math.min.apply(Math,e)}function p(e){if(!(typeof e=="undefined"||e.length===0)){var n=0;return e.forEach(function(r){n+=r}),n/e.length}}function v(e,n=!1){if(typeof e!="undefined"){var r;if(typeof e=="string")r=e;else if(w(e))r="";else{if(typeof e=="number"&&!isFinite(e))throw{code:"D3001",value:e,stack:new Error().stack};var u=n?2:0;Array.isArray(e)&&e.outerWrapper&&(e=e[0]),r=JSON.stringify(e,function(l,y){return typeof y!="undefined"&&y!==null&&y.toPrecision&&ye(y)?Number(y.toPrecision(15)):y&&w(y)?"":y},u)}return r}}function k(e,n,r){if(typeof e!="undefined"){var u=j(e),l=u.length;if(l+n<0&&(n=0),typeof r!="undefined"){if(r<=0)return"";var y=n>=0?n+r:l+n+r;return u.slice(n,y).join("")}return u.slice(n).join("")}}function T(e,n){if(typeof e!="undefined"){var r=e.indexOf(n);return r>-1?e.substr(0,r):e}}function F(e,n){if(typeof e!="undefined"){var r=e.indexOf(n);return r>-1?e.substr(r+n.length):e}}function I(e){if(typeof e!="undefined")return e.toLowerCase()}function L(e){if(typeof e!="undefined")return e.toUpperCase()}function ae(e){if(typeof e!="undefined")return j(e).length}function De(e){if(typeof e!="undefined"){var n=e.replace(/[ \t\n\r]+/gm," ");return n.charAt(0)===" "&&(n=n.substring(1)),n.charAt(n.length-1)===" "&&(n=n.substring(0,n.length-1)),n}}function Z(e,n,r){if(typeof e!="undefined"){(typeof r=="undefined"||r.length===0)&&(r=" ");var u,l=Math.abs(n)-ae(e);if(l>0){var y=new Array(l+1).join(r);r.length>1&&(y=k(y,0,l)),n>0?u=e+y:u=y+e}else u=e;return u}}function*H(e,n){var r=e.apply(this,[n]);if(te(r)&&(r=yield*r),r&&!(typeof r.start=="number"||r.end==="number"||Array.isArray(r.groups)||w(r.next)))throw{code:"T1010",stack:new Error().stack};return r}function*Ae(e,n){if(typeof e!="undefined"){var r;if(typeof n=="string")r=e.indexOf(n)!==-1;else{var u=yield*H(n,e);r=typeof u!="undefined"}return r}}function*G(e,n,r){if(typeof e!="undefined"){if(r<0)throw{stack:new Error().stack,value:r,code:"D3040",index:3};var u=U();if(typeof r=="undefined"||r>0){var l=0,y=yield*H(n,e);if(typeof y!="undefined")for(;typeof y!="undefined"&&(typeof r=="undefined"||l<r);)u.push({match:y.match,index:y.start,groups:y.groups}),y=yield*H(y.next),l++}return u}}function*we(e,n,r,u){if(typeof e!="undefined"){var l=this;if(n==="")throw{code:"D3010",stack:new Error().stack,value:n,index:2};if(u<0)throw{code:"D3011",stack:new Error().stack,value:u,index:4};var y;typeof r=="string"?y=function(he){for(var Me="",pe=0,Ie=r.indexOf("$",pe);Ie!==-1&&pe<r.length;){Me+=r.substring(pe,Ie),pe=Ie+1;var Ve=r.charAt(pe);if(Ve==="$")Me+="$",pe++;else if(Ve==="0")Me+=he.match,pe++;else{var ze;if(he.groups.length===0?ze=1:ze=Math.floor(Math.log(he.groups.length)*Math.LOG10E)+1,Ie=parseInt(r.substring(pe,pe+ze),10),ze>1&&Ie>he.groups.length&&(Ie=parseInt(r.substring(pe,pe+ze-1),10)),isNaN(Ie))Me+="$";else{if(he.groups.length>0){var et=he.groups[Ie-1];typeof et!="undefined"&&(Me+=et)}pe+=Ie.toString().length}}Ie=r.indexOf("$",pe)}return Me+=r.substring(pe),Me}:y=r;var x="",z=0;if(typeof u=="undefined"||u>0){var V=0;if(typeof n=="string"){for(var K=e.indexOf(n,z);K!==-1&&(typeof u=="undefined"||V<u);)x+=e.substring(z,K),x+=r,z=K+n.length,V++,K=e.indexOf(n,z);x+=e.substring(z)}else{var oe=yield*H(n,e);if(typeof oe!="undefined"){for(;typeof oe!="undefined"&&(typeof u=="undefined"||V<u);){x+=e.substring(z,oe.start);var se=y.apply(l,[oe]);if(te(se)&&(se=yield*se),typeof se=="string")x+=se;else throw{code:"D3012",stack:new Error().stack,value:se};z=oe.start+oe.match.length,V++,oe=yield*H(oe.next)}x+=e.substring(z)}else x=e}}else x=e;return x}}function Be(e){if(typeof e!="undefined"){var n=typeof window!="undefined"?window.btoa:function(r){return new ke.Buffer.from(r,"binary").toString("base64")};return n(e)}}function o(e){if(typeof e!="undefined"){var n=typeof window!="undefined"?window.atob:function(r){return new ke.Buffer.from(r,"base64").toString("binary")};return n(e)}}function f(e){if(typeof e!="undefined"){var n;try{n=encodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrlComponent"}}return n}}function R(e){if(typeof e!="undefined"){var n;try{n=encodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrl"}}return n}}function Q(e){if(typeof e!="undefined"){var n;try{n=decodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrlComponent"}}return n}}function de(e){if(typeof e!="undefined"){var n;try{n=decodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrl"}}return n}}function*le(e,n,r){if(typeof e!="undefined"){if(r<0)throw{code:"D3020",stack:new Error().stack,value:r,index:3};var u=[];if(typeof r=="undefined"||r>0)if(typeof n=="string")u=e.split(n,r);else{var l=0,y=yield*H(n,e);if(typeof y!="undefined"){for(var x=0;typeof y!="undefined"&&(typeof r=="undefined"||l<r);)u.push(e.substring(x,y.start)),x=y.end,y=yield*H(y.next),l++;(typeof r=="undefined"||l<r)&&u.push(e.substring(x))}else u.push(e)}return u}}function c(e,n){if(typeof e!="undefined")return typeof n=="undefined"&&(n=""),e.join(n)}function g(e,n,r){if(typeof e!="undefined"){var u={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"\u2030","zero-digit":"0",digit:"#","pattern-separator":";"},l=u;typeof r!="undefined"&&Object.keys(r).forEach(function(B){l[B]=r[B]});for(var y=[],x=l["zero-digit"].charCodeAt(0),z=x;z<x+10;z++)y.push(String.fromCharCode(z));var V=y.concat([l["decimal-separator"],l["exponent-separator"],l["grouping-separator"],l.digit,l["pattern-separator"]]),K=n.split(l["pattern-separator"]);if(K.length>2)throw{code:"D3080",stack:new Error().stack};var oe=function(B){var me=function(){for(var Oe,$e=0;$e<B.length;$e++)if(Oe=B.charAt($e),V.indexOf(Oe)!==-1&&Oe!==l["exponent-separator"])return B.substring(0,$e)}(),Ne=function(){for(var Oe,$e=B.length-1;$e>=0;$e--)if(Oe=B.charAt($e),V.indexOf(Oe)!==-1&&Oe!==l["exponent-separator"])return B.substring($e+1)}(),be=B.substring(me.length,B.length-Ne.length),Re,Je,je,Ke,Le=B.indexOf(l["exponent-separator"],me.length);Le===-1||Le>B.length-Ne.length?(Re=be,Je=void 0):(Re=be.substring(0,Le),Je=be.substring(Le+1));var We=Re.indexOf(l["decimal-separator"]);return We===-1?(je=Re,Ke=Ne):(je=Re.substring(0,We),Ke=Re.substring(We+1)),{prefix:me,suffix:Ne,activePart:be,mantissaPart:Re,exponentPart:Je,integerPart:je,fractionalPart:Ke,subpicture:B}},se=function(B){var me,Ne,be=B.subpicture,Re=be.indexOf(l["decimal-separator"]);Re!==be.lastIndexOf(l["decimal-separator"])&&(me="D3081"),be.indexOf(l.percent)!==be.lastIndexOf(l.percent)&&(me="D3082"),be.indexOf(l["per-mille"])!==be.lastIndexOf(l["per-mille"])&&(me="D3083"),be.indexOf(l.percent)!==-1&&be.indexOf(l["per-mille"])!==-1&&(me="D3084");var Je=!1;for(Ne=0;Ne<B.mantissaPart.length;Ne++){var je=B.mantissaPart.charAt(Ne);if(y.indexOf(je)!==-1||je===l.digit){Je=!0;break}}Je||(me="D3085");var Ke=B.activePart.split("").map(function(Oe){return V.indexOf(Oe)===-1?"p":"a"}).join("");Ke.indexOf("p")!==-1&&(me="D3086"),Re!==-1?(be.charAt(Re-1)===l["grouping-separator"]||be.charAt(Re+1)===l["grouping-separator"])&&(me="D3087"):B.integerPart.charAt(B.integerPart.length-1)===l["grouping-separator"]&&(me="D3088"),be.indexOf(l["grouping-separator"]+l["grouping-separator"])!==-1&&(me="D3089");var Le=B.integerPart.indexOf(l.digit);Le!==-1&&B.integerPart.substring(0,Le).split("").filter(function(Oe){return y.indexOf(Oe)>-1}).length>0&&(me="D3090"),Le=B.fractionalPart.lastIndexOf(l.digit),Le!==-1&&B.fractionalPart.substring(Le).split("").filter(function(Oe){return y.indexOf(Oe)>-1}).length>0&&(me="D3091");var We=typeof B.exponentPart=="string";if(We&&B.exponentPart.length>0&&(be.indexOf(l.percent)!==-1||be.indexOf(l["per-mille"])!==-1)&&(me="D3092"),We&&(B.exponentPart.length===0||B.exponentPart.split("").filter(function(Oe){return y.indexOf(Oe)===-1}).length>0)&&(me="D3093"),me)throw{code:me,stack:new Error().stack}},he=function(B){var me=function(Fe,ht){for(var ut=[],Ze=Fe.indexOf(l["grouping-separator"]);Ze!==-1;){var pt=(ht?Fe.substring(0,Ze):Fe.substring(Ze)).split("").filter(function(nt){return y.indexOf(nt)!==-1||nt===l.digit}).length;ut.push(pt),Ze=B.integerPart.indexOf(l["grouping-separator"],Ze+1)}return ut},Ne=me(B.integerPart),be=function(Fe){if(Fe.length===0)return 0;for(var ht=function(pt,nt){return nt===0?pt:ht(nt,pt%nt)},ut=Fe.reduce(ht),Ze=1;Ze<=Fe.length;Ze++)if(Fe.indexOf(Ze*ut)===-1)return 0;return ut},Re=be(Ne),Je=me(B.fractionalPart,!0),je=B.integerPart.split("").filter(function(Fe){return y.indexOf(Fe)!==-1}).length,Ke=je,Le=B.fractionalPart.split(""),We=Le.filter(function(Fe){return y.indexOf(Fe)!==-1}).length,Oe=Le.filter(function(Fe){return y.indexOf(Fe)!==-1||Fe===l.digit}).length,$e=typeof B.exponentPart=="string";je===0&&Oe===0&&($e?(We=1,Oe=1):je=1),$e&&je===0&&B.integerPart.indexOf(l.digit)!==-1&&(je=1),je===0&&We===0&&(We=1);var wt=0;return $e&&(wt=B.exponentPart.split("").filter(function(Fe){return y.indexOf(Fe)!==-1}).length),{integerPartGroupingPositions:Ne,regularGrouping:Re,minimumIntegerPartSize:je,scalingFactor:Ke,prefix:B.prefix,fractionalPartGroupingPositions:Je,minimumFactionalPartSize:We,maximumFactionalPartSize:Oe,minimumExponentSize:wt,suffix:B.suffix,picture:B.subpicture}},Me=K.map(oe);Me.forEach(se);var pe=Me.map(he),Ie=l["minus-sign"],Ve=l["zero-digit"],ze=l["decimal-separator"],et=l["grouping-separator"];pe.length===1&&(pe.push(JSON.parse(JSON.stringify(pe[0]))),pe[1].prefix=Ie+pe[1].prefix);var Ee;e>=0?Ee=pe[0]:Ee=pe[1];var ot;Ee.picture.indexOf(l.percent)!==-1?ot=e*100:Ee.picture.indexOf(l["per-mille"])!==-1?ot=e*1e3:ot=e;var Qe,tt;if(Ee.minimumExponentSize===0)Qe=ot;else{var At=Math.pow(10,Ee.scalingFactor),Et=Math.pow(10,Ee.scalingFactor-1);for(Qe=ot,tt=0;Qe<Et;)Qe*=10,tt-=1;for(;Qe>At;)Qe/=10,tt+=1}var Tt=M(Qe,Ee.maximumFactionalPartSize),mt=function(B,me){var Ne=Math.abs(B).toFixed(me);return Ve!=="0"&&(Ne=Ne.split("").map(function(be){return be>="0"&&be<="9"?y[be.charCodeAt(0)-48]:be}).join("")),Ne},X=mt(Tt,Ee.maximumFactionalPartSize),Ue=X.indexOf(".");for(Ue===-1?X=X+ze:X=X.replace(".",ze);X.charAt(0)===Ve;)X=X.substring(1);for(;X.charAt(X.length-1)===Ve;)X=X.substring(0,X.length-1);Ue=X.indexOf(ze);var st=Ee.minimumIntegerPartSize-Ue,kt=Ee.minimumFactionalPartSize-(X.length-Ue-1);if(X=(st>0?new Array(st+1).join(Ve):"")+X,X=X+(kt>0?new Array(kt+1).join(Ve):""),Ue=X.indexOf(ze),Ee.regularGrouping>0)for(var Dt=Math.floor((Ue-1)/Ee.regularGrouping),lt=1;lt<=Dt;lt++)X=[X.slice(0,Ue-lt*Ee.regularGrouping),et,X.slice(Ue-lt*Ee.regularGrouping)].join("");else Ee.integerPartGroupingPositions.forEach(function(B){X=[X.slice(0,Ue-B),et,X.slice(Ue-B)].join(""),Ue++});if(Ue=X.indexOf(ze),Ee.fractionalPartGroupingPositions.forEach(function(B){X=[X.slice(0,B+Ue+1),et,X.slice(B+Ue+1)].join("")}),Ue=X.indexOf(ze),(Ee.picture.indexOf(ze)===-1||Ue===X.length-1)&&(X=X.substring(0,X.length-1)),typeof tt!="undefined"){var dt=mt(tt,0);st=Ee.minimumExponentSize-dt.length,st>0&&(dt=new Array(st+1).join(Ve)+dt),X=X+l["exponent-separator"]+(tt<0?Ie:"")+dt}return X=Ee.prefix+X+Ee.suffix,X}}function d(e,n){if(typeof e!="undefined"){if(e=M(e),typeof n=="undefined"?n=10:n=M(n),n<2||n>36)throw{code:"D3100",stack:new Error().stack,value:n};var r=e.toString(n);return r}}function D(e){var n;if(typeof e!="undefined"){if(typeof e=="number")n=e;else if(typeof e=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(e)&&!isNaN(parseFloat(e))&&isFinite(e))n=parseFloat(e);else if(e===!0)n=1;else if(e===!1)n=0;else throw{code:"D3030",value:e,stack:new Error().stack,index:1};return n}}function P(e){var n;if(typeof e!="undefined")return n=Math.abs(e),n}function S(e){var n;if(typeof e!="undefined")return n=Math.floor(e),n}function b(e){var n;if(typeof e!="undefined")return n=Math.ceil(e),n}function M(e,n){var r;if(typeof e!="undefined"){if(n){var u=e.toString().split("e");e=+(u[0]+"e"+(u[1]?+u[1]+n:n))}r=Math.round(e);var l=r-e;return Math.abs(l)===.5&&Math.abs(r%2)===1&&(r=r-1),n&&(u=r.toString().split("e"),r=+(u[0]+"e"+(u[1]?+u[1]-n:-n))),Object.is(r,-0)&&(r=0),r}}function $(e){var n;if(typeof e!="undefined"){if(e<0)throw{stack:new Error().stack,code:"D3060",index:1,value:e};return n=Math.sqrt(e),n}}function ne(e,n){var r;if(typeof e!="undefined"){if(r=Math.pow(e,n),!isFinite(r))throw{stack:new Error().stack,code:"D3061",index:1,value:e,exp:n};return r}}function re(){return Math.random()}function Y(e){if(typeof e!="undefined"){var n=!1;if(Array.isArray(e)){if(e.length===1)n=Y(e[0]);else if(e.length>1){var r=e.filter(function(u){return Y(u)});n=r.length>0}}else typeof e=="string"?e.length>0&&(n=!0):ye(e)?e!==0&&(n=!0):e!==null&&typeof e=="object"?Object.keys(e).length>0&&(n=!0):typeof e=="boolean"&&e===!0&&(n=!0);return n}}function W(e){if(typeof e!="undefined")return!Y(e)}function ee(e,n,r,u){var l=[n],y=ie(e);return y>=2&&l.push(r),y>=3&&l.push(u),l}function*_(e,n){if(typeof e!="undefined"){for(var r=U(),u=0;u<e.length;u++){var l=ee(n,e[u],u,e),y=yield*n.apply(this,l);typeof y!="undefined"&&r.push(y)}return r}}function*xe(e,n){if(typeof e!="undefined"){for(var r=U(),u=0;u<e.length;u++){var l=e[u],y=ee(n,l,u,e),x=yield*n.apply(this,y);Y(x)&&r.push(l)}return r}}function*_e(e,n){if(typeof e!="undefined"){for(var r=!1,u,l=0;l<e.length;l++){var y=e[l],x=!0;if(typeof n!="undefined"){var z=ee(n,y,l,e),V=yield*n.apply(this,z);x=Y(V)}if(x)if(!r)u=y,r=!0;else throw{stack:new Error().stack,code:"D3138",index:l}}if(!r)throw{stack:new Error().stack,code:"D3139"};return u}}function Ce(){for(var e=[],n=Array.prototype.slice.call(arguments),r=Math.min.apply(Math,n.map(function(y){return Array.isArray(y)?y.length:0})),u=0;u<r;u++){var l=n.map(y=>y[u]);e.push(l)}return e}function*Se(e,n,r){if(typeof e!="undefined"){var u,l=ie(n);if(l<2)throw{stack:new Error().stack,code:"D3050",index:1};var y;for(typeof r=="undefined"&&e.length>0?(u=e[0],y=1):(u=r,y=0);y<e.length;){var x=[u,e[y]];l>=3&&x.push(y),l>=4&&x.push(e),u=yield*n.apply(this,x),y++}return u}}function Pe(e){var n=U();if(Array.isArray(e)){var r={};e.forEach(function(u){var l=Pe(u);l.forEach(function(y){r[y]=!0})}),n=Pe(r)}else e!==null&&typeof e=="object"&&!N(e)&&Object.keys(e).forEach(u=>n.push(u));return n}function He(e,n){var r;if(Array.isArray(e)){r=U();for(var u=0;u<e.length;u++){var l=He(e[u],n);typeof l!="undefined"&&(Array.isArray(l)?l.forEach(y=>r.push(y)):r.push(l))}}else e!==null&&typeof e=="object"&&(r=e[n]);return r}function Xe(e,n){return typeof e=="undefined"?n:typeof n=="undefined"?e:(Array.isArray(e)||(e=U(e)),Array.isArray(n)||(n=[n]),e.concat(n))}function it(e){return typeof e!="undefined"}function C(e){var n=U();if(Array.isArray(e))e.forEach(function(l){n=Xe(n,C(l))});else if(e!==null&&typeof e=="object"&&!N(e))for(var r in e){var u={};u[r]=e[r],n.push(u)}else n=e;return n}function ft(e){if(typeof e!="undefined"){var n={};return e.forEach(function(r){for(var u in r)n[u]=r[u]}),n}}function ct(e){if(typeof e!="undefined"){if(e.length<=1)return e;for(var n=e.length,r=new Array(n),u=0;u<n;u++)r[n-u-1]=e[u];return r}}function*Ye(e,n){var r=U();for(var u in e){var l=ee(n,e[u],u,e),y=yield*n.apply(this,l);typeof y!="undefined"&&r.push(y)}return r}function at(e){throw{code:"D3137",stack:new Error().stack,message:e||"$error() function evaluated"}}function qe(e,n){if(!e)throw{code:"D3141",stack:new Error().stack,message:n||"$assert() statement failed"}}function Ge(e){if(e!==void 0)return e===null?"null":ye(e)?"number":typeof e=="string"?"string":typeof e=="boolean"?"boolean":Array.isArray(e)?"array":w(e)?"function":"object"}function*t(e,n){if(typeof e!="undefined"){if(e.length<=1)return e;var r;if(typeof n=="undefined"){if(!ge(e)&&!fe(e))throw{stack:new Error().stack,code:"D3070",index:1};r=function*(x,z){return x>z}}else r=n;var u=function*(x,z){var V=function*(oe,se,he){se.length===0?Array.prototype.push.apply(oe,he):he.length===0?Array.prototype.push.apply(oe,se):(yield*r(se[0],he[0]))?(oe.push(he[0]),yield*V(oe,se,he.slice(1))):(oe.push(se[0]),yield*V(oe,se.slice(1),he))},K=[];return yield*V(K,x,z),K},l=function*(x){if(!Array.isArray(x)||x.length<=1)return x;var z=Math.floor(x.length/2),V=x.slice(0,z),K=x.slice(z);return V=yield*l(V),K=yield*l(K),yield*u(V,K)},y=yield*l(e);return y}}function i(e){if(typeof e!="undefined"){if(e.length<=1)return e;for(var n=new Array(e.length),r=0;r<e.length;r++){var u=Math.floor(Math.random()*(r+1));r!==u&&(n[r]=n[u]),n[u]=e[r]}return n}}function s(e){if(typeof e!="undefined"){if(!Array.isArray(e)||e.length<=1)return e;for(var n=m(e)?U():[],r=0;r<e.length;r++){for(var u=e[r],l=!1,y=0;y<n.length;y++)if(ce(u,n[y])){l=!0;break}l||n.push(u)}return n}}function*a(e,n){var r={};for(var u in e){var l=e[u],y=ee(n,l,u,e),x=yield*n.apply(this,y);Y(x)&&(r[u]=l)}return Object.keys(r).length===0&&(r=void 0),r}return{sum:O,count:q,max:h,min:E,average:p,string:v,substring:k,substringBefore:T,substringAfter:F,lowercase:I,uppercase:L,length:ae,trim:De,pad:Z,match:G,contains:Ae,replace:we,split:le,join:c,formatNumber:g,formatBase:d,number:D,floor:S,ceil:b,round:M,abs:P,sqrt:$,power:ne,random:re,boolean:Y,not:W,map:_,zip:Ce,filter:xe,single:_e,foldLeft:Se,sift:a,keys:Pe,lookup:He,append:Xe,exists:it,spread:C,merge:ft,reverse:ct,each:Ye,error:at,assert:qe,type:Ge,sort:t,shuffle:i,distinct:s,base64encode:Be,base64decode:o,encodeUrlComponent:f,encodeUrl:R,decodeUrlComponent:Q,decodeUrl:de}})();ve.exports=J}).call(this)}).call(this,typeof gt!="undefined"?gt:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./utils":6}],3:[function(ue,ve,Te){var ke=ue("./datetime"),A=ue("./functions"),J=ue("./utils"),ye=ue("./parser"),fe=ue("./signature"),ge=function(){var U=J.isNumeric,m=J.isArrayOfStrings,w=J.isArrayOfNumbers,N=J.createSequence,te=J.isSequence,ie=J.isFunction,ce=J.isLambda,j=J.isIterable,O=J.getFunctionArity,q=J.isDeepEqual,h=Ye(null);function*E(t,i,s){var a,e=s.lookup("__evaluate_entry");switch(e&&e(t,i,s),t.type){case"path":a=yield*p(t,i,s);break;case"binary":a=yield*L(t,i,s);break;case"unary":a=yield*ae(t,i,s);break;case"name":a=De(t,i);break;case"string":case"number":case"value":a=Z(t);break;case"wildcard":a=H(t,i);break;case"descendant":a=G(t,i);break;case"parent":a=s.lookup(t.slot.label);break;case"condition":a=yield*P(t,i,s);break;case"block":a=yield*S(t,i,s);break;case"bind":a=yield*D(t,i,s);break;case"regex":a=b(t);break;case"function":a=yield*W(t,i,s);break;case"variable":a=M(t,i,s);break;case"lambda":a=xe(t,i,s);break;case"partial":a=yield*_e(t,i,s);break;case"apply":a=yield*Y(t,i,s);break;case"transform":a=ne(t,i,s);break}if(s.async&&(typeof a=="undefined"||a===null||typeof a.then!="function")&&(a=Promise.resolve(a)),s.async&&typeof a.then=="function"&&t.nextFunction&&typeof a[t.nextFunction]=="function"||(a=yield a),Object.prototype.hasOwnProperty.call(t,"predicate"))for(var n=0;n<t.predicate.length;n++)a=yield*I(t.predicate[n].expr,a,s);t.type!=="path"&&Object.prototype.hasOwnProperty.call(t,"group")&&(a=yield*c(t.group,a,s));var r=s.lookup("__evaluate_exit");return r&&r(t,i,s,a),a&&te(a)&&!a.tupleStream&&(t.keepArray&&(a.keepSingleton=!0),a.length===0?a=void 0:a.length===1&&(a=a.keepSingleton?a:a[0])),a}function*p(t,i,s){var a;Array.isArray(i)&&t.steps[0].type!=="variable"?a=i:a=N(i);for(var e,n=!1,r=void 0,u=0;u<t.steps.length;u++){var l=t.steps[u];if(l.tuple&&(n=!0),u===0&&l.consarray?e=yield*E(l,a,s):n?r=yield*F(l,a,r,s):e=yield*k(l,a,s,u===t.steps.length-1),!n&&(typeof e=="undefined"||e.length===0))break;typeof l.focus=="undefined"&&(a=e)}if(n)if(t.tuple)e=r;else for(e=N(),u=0;u<r.length;u++)e.push(r[u]["@"]);return t.keepSingletonArray&&(Array.isArray(e)&&e.cons&&!e.sequence&&(e=N(e)),e.keepSingleton=!0),t.hasOwnProperty("group")&&(e=yield*c(t.group,n?r:e,s)),e}function v(t,i){var s=Ye(t);for(const a in i)s.bind(a,i[a]);return s}function*k(t,i,s,a){var e;if(t.type==="sort")return e=yield*$(t,i,s),t.stages&&(e=yield*T(t.stages,e,s)),e;e=N();for(var n=0;n<i.length;n++){var r=yield*E(t,i[n],s);if(t.stages)for(var u=0;u<t.stages.length;u++)r=yield*I(t.stages[u].expr,r,s);typeof r!="undefined"&&e.push(r)}var l=N();return a&&e.length===1&&Array.isArray(e[0])&&!te(e[0])?l=e[0]:e.forEach(function(y){!Array.isArray(y)||y.cons?l.push(y):y.forEach(x=>l.push(x))}),l}function*T(t,i,s){for(var a=i,e=0;e<t.length;e++){var n=t[e];switch(n.type){case"filter":a=yield*I(n.expr,a,s);break;case"index":for(var r=0;r<a.length;r++){var u=a[r];u[n.value]=r}break}}return a}function*F(t,i,s,a){var e;if(t.type==="sort"){if(s)e=yield*$(t,s,a);else{var n=yield*$(t,i,a);e=N(),e.tupleStream=!0;for(var r=0;r<n.length;r++){var u={"@":n[r]};u[t.index]=r,e.push(u)}}return t.stages&&(e=yield*T(t.stages,e,a)),e}e=N(),e.tupleStream=!0;var l=a;s===void 0&&(s=i.map(V=>({"@":V})));for(var y=0;y<s.length;y++){l=v(a,s[y]);var x=yield*E(t,s[y]["@"],l);if(typeof x!="undefined"){Array.isArray(x)||(x=[x]);for(var z=0;z<x.length;z++)u={},Object.assign(u,s[y]),x.tupleStream?Object.assign(u,x[z]):(t.focus?(u[t.focus]=x[z],u["@"]=s[y]["@"]):u["@"]=x[z],t.index&&(u[t.index]=z),t.ancestor&&(u[t.ancestor.label]=s[y]["@"])),e.push(u)}}return t.stages&&(e=yield*T(t.stages,e,a)),e}function*I(t,i,s){var a=N();if(i&&i.tupleStream&&(a.tupleStream=!0),Array.isArray(i)||(i=N(i)),t.type==="number"){var e=Math.floor(t.value);e<0&&(e=i.length+e);var n=i[e];typeof n!="undefined"&&(Array.isArray(n)?a=n:a.push(n))}else for(e=0;e<i.length;e++){var n=i[e],r=n,u=s;i.tupleStream&&(r=n["@"],u=v(s,n));var l=yield*E(t,r,u);U(l)&&(l=[l]),w(l)?l.forEach(function(x){var z=Math.floor(x);z<0&&(z=i.length+z),z===e&&a.push(n)}):A.boolean(l)&&a.push(n)}return a}function*L(t,i,s){var a,e=yield*E(t.lhs,i,s),n=t.value,r=function*(){return yield*E(t.rhs,i,s)};if(n==="and"||n==="or")try{return yield*Q(e,r,n)}catch(l){throw l.position=t.position,l.token=n,l}var u=yield*r();try{switch(n){case"+":case"-":case"*":case"/":case"%":a=Be(e,u,n);break;case"=":case"!=":a=o(e,u,n);break;case"<":case"<=":case">":case">=":a=f(e,u,n);break;case"&":a=le(e,u);break;case"..":a=d(e,u);break;case"in":a=R(e,u);break}}catch(l){throw l.position=t.position,l.token=n,l}return a}function*ae(t,i,s){var a;switch(t.value){case"-":if(a=yield*E(t.expression,i,s),typeof a=="undefined")a=void 0;else if(U(a))a=-a;else throw{code:"D1002",stack:new Error().stack,position:t.position,token:t.value,value:a};break;case"[":a=[];for(var e=0;e<t.expressions.length;e++){var n=t.expressions[e],r=yield*E(n,i,s);typeof r!="undefined"&&(n.value==="["?a.push(r):a=A.append(a,r))}t.consarray&&Object.defineProperty(a,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":a=yield*c(t,i,s);break}return a}function De(t,i,s){return A.lookup(i,t.value)}function Z(t){return t.value}function H(t,i){var s=N();return Array.isArray(i)&&i.outerWrapper&&i.length>0&&(i=i[0]),i!==null&&typeof i=="object"&&Object.keys(i).forEach(function(a){var e=i[a];Array.isArray(e)?(e=Ae(e),s=A.append(s,e)):s.push(e)}),s}function Ae(t,i){return typeof i=="undefined"&&(i=[]),Array.isArray(t)?t.forEach(function(s){Ae(s,i)}):i.push(t),i}function G(t,i){var s,a=N();return typeof i!="undefined"&&(we(i,a),a.length===1?s=a[0]:s=a),s}function we(t,i){Array.isArray(t)||i.push(t),Array.isArray(t)?t.forEach(function(s){we(s,i)}):t!==null&&typeof t=="object"&&Object.keys(t).forEach(function(s){we(t[s],i)})}function Be(t,i,s){var a;if(typeof t!="undefined"&&!U(t))throw{code:"T2001",stack:new Error().stack,value:t};if(typeof i!="undefined"&&!U(i))throw{code:"T2002",stack:new Error().stack,value:i};if(typeof t=="undefined"||typeof i=="undefined")return a;switch(s){case"+":a=t+i;break;case"-":a=t-i;break;case"*":a=t*i;break;case"/":a=t/i;break;case"%":a=t%i;break}return a}function o(t,i,s){var a,e=typeof t,n=typeof i;if(e==="undefined"||n==="undefined")return!1;switch(s){case"=":a=q(t,i);break;case"!=":a=!q(t,i);break}return a}function f(t,i,s){var a,e=typeof t,n=typeof i,r=e==="undefined"||e==="string"||e==="number",u=n==="undefined"||n==="string"||n==="number";if(!r||!u)throw{code:"T2010",stack:new Error().stack,value:e==="string"||e==="number"?i:t};if(!(e==="undefined"||n==="undefined")){if(e!==n)throw{code:"T2009",stack:new Error().stack,value:t,value2:i};switch(s){case"<":a=t<i;break;case"<=":a=t<=i;break;case">":a=t>i;break;case">=":a=t>=i;break}return a}}function R(t,i){var s=!1;if(typeof t=="undefined"||typeof i=="undefined")return!1;Array.isArray(i)||(i=[i]);for(var a=0;a<i.length;a++)if(i[a]===t){s=!0;break}return s}function*Q(t,i,s){var a,e=de(t);switch(s){case"and":a=e&&de(yield*i());break;case"or":a=e||de(yield*i());break}return a}function de(t){var i=A.boolean(t);return typeof i=="undefined"?!1:i}function le(t,i){var s,a="",e="";return typeof t!="undefined"&&(a=A.string(t)),typeof i!="undefined"&&(e=A.string(i)),s=a.concat(e),s}function*c(t,i,s){var a={},e={},n=!!(i&&i.tupleStream);Array.isArray(i)||(i=N(i)),i.length===0&&i.push(void 0);for(var r=0;r<i.length;r++)for(var u=i[r],l=n?v(s,u):s,y=0;y<t.lhs.length;y++){var x=t.lhs[y],z=yield*E(x[0],n?u["@"]:u,l);if(typeof z!="string"&&z!==void 0)throw{code:"T1003",stack:new Error().stack,position:t.position,value:z};if(z!==void 0){var V={data:u,exprIndex:y};if(e.hasOwnProperty(z)){if(e[z].exprIndex!==y)throw{code:"D1009",stack:new Error().stack,position:t.position,value:z};e[z].data=A.append(e[z].data,u)}else e[z]=V}}for(z in e){V=e[z];var K=V.data,l=s;if(n){var oe=g(V.data);K=oe["@"],delete oe["@"],l=v(s,oe)}var se=yield*E(t.lhs[V.exprIndex][1],K,l);typeof se!="undefined"&&(a[z]=se)}return a}function g(t){if(!Array.isArray(t))return t;var i={};Object.assign(i,t[0]);for(var s=1;s<t.length;s++)for(const a in t[s])i[a]=A.append(i[a],t[s][a]);return i}function d(t,i){var s;if(typeof t!="undefined"&&!Number.isInteger(t))throw{code:"T2003",stack:new Error().stack,value:t};if(typeof i!="undefined"&&!Number.isInteger(i))throw{code:"T2004",stack:new Error().stack,value:i};if(typeof t=="undefined"||typeof i=="undefined"||t>i)return s;var a=i-t+1;if(a>1e7)throw{code:"D2014",stack:new Error().stack,value:a};s=new Array(a);for(var e=t,n=0;e<=i;e++,n++)s[n]=e;return s.sequence=!0,s}function*D(t,i,s){var a=yield*E(t.rhs,i,s);return s.bind(t.lhs.value,a),a}function*P(t,i,s){var a,e=yield*E(t.condition,i,s);return A.boolean(e)?a=yield*E(t.then,i,s):typeof t.else!="undefined"&&(a=yield*E(t.else,i,s)),a}function*S(t,i,s){for(var a,e=Ye(s),n=0;n<t.expressions.length;n++)a=yield*E(t.expressions[n],i,e);return a}function b(t){var i=new Ge.RegexEngine(t.value),s=function(a,e){var n;i.lastIndex=e||0;var r=i.exec(a);if(r!==null){if(n={match:r[0],start:r.index,end:r.index+r[0].length,groups:[]},r.length>1)for(var u=1;u<r.length;u++)n.groups.push(r[u]);n.next=function(){if(!(i.lastIndex>=a.length)){var l=s(a,i.lastIndex);if(l&&l.match==="")throw{code:"D1004",stack:new Error().stack,position:t.position,value:t.value.source};return l}}}return n};return s}function M(t,i,s){var a;return t.value===""?a=i&&i.outerWrapper?i[0]:i:a=s.lookup(t.value),a}function*$(t,i,s){var a,e=i,n=!!i.tupleStream,r=function*(l,y){for(var x=0,z=0;x===0&&z<t.terms.length;z++){var V=t.terms[z],K=l,oe=s;n&&(K=l["@"],oe=v(s,l));var se=yield*E(V.expression,K,oe);K=y,oe=s,n&&(K=y["@"],oe=v(s,y));var he=yield*E(V.expression,K,oe),Me=typeof se,pe=typeof he;if(Me==="undefined"){x=pe==="undefined"?0:1;continue}if(pe==="undefined"){x=-1;continue}if(!(Me==="string"||Me==="number")||!(pe==="string"||pe==="number"))throw{code:"T2008",stack:new Error().stack,position:t.position,value:Me==="string"||Me==="number"?he:se};if(Me!==pe)throw{code:"T2007",stack:new Error().stack,position:t.position,value:se,value2:he};se!==he&&(se<he?x=-1:x=1,V.descending===!0&&(x=-x))}return x===1},u={environment:s,input:i};return a=yield*A.sort.apply(u,[e,r]),a}function ne(t,i,s){var a=function*(e){if(typeof e!="undefined"){var n=s.lookup("clone");if(!ie(n))throw{code:"T2013",stack:new Error().stack,position:t.position};var r=yield*ee(n,[e],null,s),u=yield*E(t.pattern,r,s);if(typeof u!="undefined"){Array.isArray(u)||(u=[u]);for(var l=0;l<u.length;l++){var y=u[l],x=yield*E(t.update,y,s),z=typeof x;if(z!=="undefined"){if(z!=="object"||x===null||Array.isArray(x))throw{code:"T2011",stack:new Error().stack,position:t.update.position,value:x};for(var V in x)y[V]=x[V]}if(typeof t.delete!="undefined"){var K=yield*E(t.delete,y,s);if(typeof K!="undefined"){var oe=K;if(Array.isArray(K)||(K=[K]),!m(K))throw{code:"T2012",stack:new Error().stack,position:t.delete.position,value:oe};for(var se=0;se<K.length;se++)typeof y=="object"&&y!==null&&delete y[K[se]]}}}}return r}};return C(a,"<(oa):o>")}var re=ye("function($f, $g) { function($x){ $g($f($x)) } }");function*Y(t,i,s){var a,e=yield*E(t.lhs,i,s);if(t.rhs.type==="function")a=yield*W(t.rhs,i,s,{context:e});else{var n=yield*E(t.rhs,i,s);if(!ie(n))throw{code:"T2006",stack:new Error().stack,position:t.position,value:n};if(ie(e)){var r=yield*E(re,null,s);a=yield*ee(r,[e,n],null,s)}else a=yield*ee(n,[e],null,s)}return a}function*W(t,i,s,a){var e,n=yield*E(t.procedure,i,s);if(typeof n=="undefined"&&t.procedure.type==="path"&&s.lookup(t.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:t.position,token:t.procedure.steps[0].value};var r=[];typeof a!="undefined"&&r.push(a.context);for(var u=0;u<t.arguments.length;u++){const y=yield*E(t.arguments[u],i,s);if(ie(y)){const x=function*(...z){return yield*ee(y,z,null,s)};x.arity=O(y),r.push(x)}else r.push(y)}var l=t.procedure.type==="path"?t.procedure.steps[0].value:t.procedure.value;try{typeof n=="object"&&(n.token=l,n.position=t.position),e=yield*ee(n,r,i,s)}catch(y){throw y.position||(y.position=t.position),y.token||(y.token=l),y}return e}function*ee(t,i,s,a){var e;for(e=yield*_(t,i,s,a);ce(e)&&e.thunk===!0;){var n=yield*E(e.body.procedure,e.input,e.environment);e.body.procedure.type==="variable"&&(n.token=e.body.procedure.value),n.position=e.body.procedure.position;for(var r=[],u=0;u<e.body.arguments.length;u++)r.push(yield*E(e.body.arguments[u],e.input,e.environment));e=yield*_(n,r,s,a)}return e}function*_(t,i,s,a){var e;try{var n=i;if(t&&(n=Ce(t.signature,i,s)),ce(t))e=yield*Se(t,n);else if(t&&t._jsonata_function===!0){var r={environment:a,input:s};e=t.implementation.apply(r,n),j(e)&&(e=yield*e)}else if(typeof t=="function")e=t.apply(s,n),j(e)&&(e=yield*e);else throw{code:"T1006",stack:new Error().stack}}catch(u){throw t&&(typeof u.token=="undefined"&&typeof t.token!="undefined"&&(u.token=t.token),u.position=t.position),u}return e}function xe(t,i,s){var a={_jsonata_lambda:!0,input:i,environment:s,arguments:t.arguments,signature:t.signature,body:t.body};return t.thunk===!0&&(a.thunk=!0),a.apply=function*(e,n){return yield*ee(a,n,i,e.environment)},a}function*_e(t,i,s){for(var a,e=[],n=0;n<t.arguments.length;n++){var r=t.arguments[n];r.type==="operator"&&r.value==="?"?e.push(r):e.push(yield*E(r,i,s))}var u=yield*E(t.procedure,i,s);if(typeof u=="undefined"&&t.procedure.type==="path"&&s.lookup(t.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:t.position,token:t.procedure.steps[0].value};if(ce(u))a=Pe(u,e);else if(u&&u._jsonata_function===!0)a=He(u.implementation,e);else if(typeof u=="function")a=He(u,e);else throw{code:"T1008",stack:new Error().stack,position:t.position,token:t.procedure.type==="path"?t.procedure.steps[0].value:t.procedure.value};return a}function Ce(t,i,s){if(typeof t=="undefined")return i;var a=t.validate(i,s);return a}function*Se(t,i){var s,a=Ye(t.environment);return t.arguments.forEach(function(e,n){a.bind(e.value,i[n])}),typeof t.body=="function"?s=yield*Xe(t.body,a):s=yield*E(t.body,t.input,a),s}function Pe(t,i){var s=Ye(t.environment),a=[];t.arguments.forEach(function(n,r){var u=i[r];u&&u.type==="operator"&&u.value==="?"?a.push(n):s.bind(n.value,u)});var e={_jsonata_lambda:!0,input:t.input,environment:s,arguments:a,body:t.body};return e}function He(t,i){var s=it(t);s=s.map(function(r){return"$"+r.trim()});var a="function("+s.join(", ")+"){ _ }",e=ye(a);e.body=t;var n=Pe(e,i);return n}function*Xe(t,i){var s=it(t),a=s.map(function(r){return i.lookup(r.trim())}),e={environment:i},n=t.apply(e,a);return j(n)&&(n=yield*n),n}function it(t){var i=t.toString(),s=/\(([^)]*)\)/.exec(i)[1],a=s.split(",");return a}function C(t,i){var s={_jsonata_function:!0,implementation:t};return typeof i!="undefined"&&(s.signature=fe(i)),s}function*ft(t,i){if(typeof t!="undefined"){var s=this.input;typeof i!="undefined"&&(s=i,Array.isArray(s)&&!te(s)&&(s=N(s),s.outerWrapper=!0));try{var a=ye(t,!1)}catch(n){throw qe(n),{stack:new Error().stack,code:"D3120",value:n.message,error:n}}try{var e=yield*E(a,s,this.environment)}catch(n){throw qe(n),{stack:new Error().stack,code:"D3121",value:n.message,error:n}}return e}}function ct(t){if(typeof t!="undefined")return JSON.parse(A.string(t))}function Ye(t){var i={};return{bind:function(s,a){i[s]=a},lookup:function(s){var a;return i.hasOwnProperty(s)?a=i[s]:t&&(a=t.lookup(s)),a},timestamp:t?t.timestamp:null,async:t?t.async:!1,global:t?t.global:{ancestry:[null]}}}h.bind("sum",C(A.sum,"<a<n>:n>")),h.bind("count",C(A.count,"<a:n>")),h.bind("max",C(A.max,"<a<n>:n>")),h.bind("min",C(A.min,"<a<n>:n>")),h.bind("average",C(A.average,"<a<n>:n>")),h.bind("string",C(A.string,"<x-b?:s>")),h.bind("substring",C(A.substring,"<s-nn?:s>")),h.bind("substringBefore",C(A.substringBefore,"<s-s:s>")),h.bind("substringAfter",C(A.substringAfter,"<s-s:s>")),h.bind("lowercase",C(A.lowercase,"<s-:s>")),h.bind("uppercase",C(A.uppercase,"<s-:s>")),h.bind("length",C(A.length,"<s-:n>")),h.bind("trim",C(A.trim,"<s-:s>")),h.bind("pad",C(A.pad,"<s-ns?:s>")),h.bind("match",C(A.match,"<s-f<s:o>n?:a<o>>")),h.bind("contains",C(A.contains,"<s-(sf):b>")),h.bind("replace",C(A.replace,"<s-(sf)(sf)n?:s>")),h.bind("split",C(A.split,"<s-(sf)n?:a<s>>")),h.bind("join",C(A.join,"<a<s>s?:s>")),h.bind("formatNumber",C(A.formatNumber,"<n-so?:s>")),h.bind("formatBase",C(A.formatBase,"<n-n?:s>")),h.bind("formatInteger",C(ke.formatInteger,"<n-s:s>")),h.bind("parseInteger",C(ke.parseInteger,"<s-s:n>")),h.bind("number",C(A.number,"<(nsb)-:n>")),h.bind("floor",C(A.floor,"<n-:n>")),h.bind("ceil",C(A.ceil,"<n-:n>")),h.bind("round",C(A.round,"<n-n?:n>")),h.bind("abs",C(A.abs,"<n-:n>")),h.bind("sqrt",C(A.sqrt,"<n-:n>")),h.bind("power",C(A.power,"<n-n:n>")),h.bind("random",C(A.random,"<:n>")),h.bind("boolean",C(A.boolean,"<x-:b>")),h.bind("not",C(A.not,"<x-:b>")),h.bind("map",C(A.map,"<af>")),h.bind("zip",C(A.zip,"<a+>")),h.bind("filter",C(A.filter,"<af>")),h.bind("single",C(A.single,"<af?>")),h.bind("reduce",C(A.foldLeft,"<afj?:j>")),h.bind("sift",C(A.sift,"<o-f?:o>")),h.bind("keys",C(A.keys,"<x-:a<s>>")),h.bind("lookup",C(A.lookup,"<x-s:x>")),h.bind("append",C(A.append,"<xx:a>")),h.bind("exists",C(A.exists,"<x:b>")),h.bind("spread",C(A.spread,"<x-:a<o>>")),h.bind("merge",C(A.merge,"<a<o>:o>")),h.bind("reverse",C(A.reverse,"<a:a>")),h.bind("each",C(A.each,"<o-f:a>")),h.bind("error",C(A.error,"<s?:x>")),h.bind("assert",C(A.assert,"<bs?:x>")),h.bind("type",C(A.type,"<x:s>")),h.bind("sort",C(A.sort,"<af?:a>")),h.bind("shuffle",C(A.shuffle,"<a:a>")),h.bind("distinct",C(A.distinct,"<x:x>")),h.bind("base64encode",C(A.base64encode,"<s-:s>")),h.bind("base64decode",C(A.base64decode,"<s-:s>")),h.bind("encodeUrlComponent",C(A.encodeUrlComponent,"<s-:s>")),h.bind("encodeUrl",C(A.encodeUrl,"<s-:s>")),h.bind("decodeUrlComponent",C(A.decodeUrlComponent,"<s-:s>")),h.bind("decodeUrl",C(A.decodeUrl,"<s-:s>")),h.bind("eval",C(ft,"<sx?:x>")),h.bind("toMillis",C(ke.toMillis,"<s-s?:n>")),h.bind("fromMillis",C(ke.fromMillis,"<n-s?s?:s>")),h.bind("clone",C(ct,"<(oa)-:o>"));var at={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function qe(t){var i=at[t.code];if(typeof i!="undefined"){var s=i.replace(/\{\{\{([^}]+)}}}/g,function(){return t[arguments[1]]});s=s.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(t[arguments[1]])}),t.message=s}}function Ge(t,i){var s,a;try{s=ye(t,i&&i.recover),a=s.errors,delete s.errors}catch(r){throw qe(r),r}var e=Ye(h),n=new Date;return e.bind("now",C(function(r,u){return ke.fromMillis(n.getTime(),r,u)},"<s?s?:s>")),e.bind("millis",C(function(){return n.getTime()},"<:n>")),i&&i.RegexEngine?Ge.RegexEngine=i.RegexEngine:Ge.RegexEngine=RegExp,{evaluate:function(r,u,l){if(typeof a!="undefined"){var y={code:"S0500",position:0};throw qe(y),y}if(typeof u!="undefined"){var x;x=Ye(e);for(var z in u)x.bind(z,u[z])}else x=e;x.bind("$",r),n=new Date,x.timestamp=n,Array.isArray(r)&&!te(r)&&(r=N(r),r.outerWrapper=!0);var V,K;if(typeof l=="function"){x.async=!0;var oe=function(he){qe(he),l(he,null)},se=function(he){V=K.next(he),V.done?l(null,V.value):V.value.then(se).catch(oe)};K=E(s,r,x),V=K.next(),V.value.then(se).catch(oe)}else try{for(K=E(s,r,x),V=K.next();!V.done;)V=K.next(V.value);return V.value}catch(he){throw qe(he),he}},assign:function(r,u){e.bind(r,u)},registerFunction:function(r,u,l){var y=C(u,l);e.bind(r,y)},ast:function(){return s},errors:function(){return a}}}return Ge.parser=ye,Ge}();ve.exports=ge},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(ue,ve,Te){var ke=ue("./signature");const A=(()=>{var J={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},ye={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},fe=function(U){var m=0,w=U.length,N=function(ce,j){var O={type:ce,value:j,position:m};return O},te=function(){for(var ce=m,j=0,O,q;m<w;){var h=U.charAt(m);if(h==="/"&&U.charAt(m-1)!=="\\"&&j===0){if(O=U.substring(ce,m),O==="")throw{code:"S0301",stack:new Error().stack,position:m};for(m++,h=U.charAt(m),ce=m;h==="i"||h==="m";)m++,h=U.charAt(m);return q=U.substring(ce,m)+"g",new RegExp(O,q)}(h==="("||h==="["||h==="{")&&U.charAt(m-1)!=="\\"&&j++,(h===")"||h==="]"||h==="}")&&U.charAt(m-1)!=="\\"&&j--,m++}throw{code:"S0302",stack:new Error().stack,position:m}},ie=function(ce){if(m>=w)return null;for(var j=U.charAt(m);m<w&&` 	
\r\v`.indexOf(j)>-1;)m++,j=U.charAt(m);if(j==="/"&&U.charAt(m+1)==="*"){var O=m;for(m+=2,j=U.charAt(m);!(j==="*"&&U.charAt(m+1)==="/");)if(j=U.charAt(++m),m>=w)throw{code:"S0106",stack:new Error().stack,position:O};return m+=2,j=U.charAt(m),ie(ce)}if(ce!==!0&&j==="/")return m++,N("regex",te());if(j==="."&&U.charAt(m+1)===".")return m+=2,N("operator","..");if(j===":"&&U.charAt(m+1)==="=")return m+=2,N("operator",":=");if(j==="!"&&U.charAt(m+1)==="=")return m+=2,N("operator","!=");if(j===">"&&U.charAt(m+1)==="=")return m+=2,N("operator",">=");if(j==="<"&&U.charAt(m+1)==="=")return m+=2,N("operator","<=");if(j==="*"&&U.charAt(m+1)==="*")return m+=2,N("operator","**");if(j==="~"&&U.charAt(m+1)===">")return m+=2,N("operator","~>");if(Object.prototype.hasOwnProperty.call(J,j))return m++,N("operator",j);if(j==='"'||j==="'"){var q=j;m++;for(var h="";m<w;){if(j=U.charAt(m),j==="\\")if(m++,j=U.charAt(m),Object.prototype.hasOwnProperty.call(ye,j))h+=ye[j];else if(j==="u"){var E=U.substr(m+1,4);if(/^[0-9a-fA-F]+$/.test(E)){var p=parseInt(E,16);h+=String.fromCharCode(p),m+=4}else throw{code:"S0104",stack:new Error().stack,position:m}}else throw{code:"S0103",stack:new Error().stack,position:m,token:j};else{if(j===q)return m++,N("string",h);h+=j}m++}throw{code:"S0101",stack:new Error().stack,position:m}}var v=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,k=v.exec(U.substring(m));if(k!==null){var T=parseFloat(k[0]);if(!isNaN(T)&&isFinite(T))return m+=k[0].length,N("number",T);throw{code:"S0102",stack:new Error().stack,position:m,token:k[0]}}var F;if(j==="`"){m++;var I=U.indexOf("`",m);if(I!==-1)return F=U.substring(m,I),m=I+1,N("name",F);throw m=w,{code:"S0105",stack:new Error().stack,position:m}}for(var L=m,ae;;)if(ae=U.charAt(L),L===w||` 	
\r\v`.indexOf(ae)>-1||Object.prototype.hasOwnProperty.call(J,ae)){if(U.charAt(m)==="$")return F=U.substring(m+1,L),m=L,N("variable",F);switch(F=U.substring(m,L),m=L,F){case"or":case"in":case"and":return N("operator",F);case"true":return N("value",!0);case"false":return N("value",!1);case"null":return N("value",null);default:return m===w&&F===""?null:N("name",F)}}else L++};return ie},ge=function(U,m){var w,N,te={},ie=[],ce=function(){var o=[];w.id!=="(end)"&&o.push({type:w.type,value:w.value,position:w.position});for(var f=N();f!==null;)o.push(f),f=N();return o},j={nud:function(){var o={code:"S0211",token:this.value,position:this.position};if(m)return o.remaining=ce(),o.type="error",ie.push(o),o;throw o.stack=new Error().stack,o}},O=function(o,f){var R=te[o];return f=f||0,R?f>=R.lbp&&(R.lbp=f):(R=Object.create(j),R.id=R.value=o,R.lbp=f,te[o]=R),R},q=function(o){if(m){o.remaining=ce(),ie.push(o);var f=te["(error)"];return w=Object.create(f),w.error=o,w.type="(error)",w}else throw o.stack=new Error().stack,o},h=function(o,f){if(o&&w.id!==o){var R;w.id==="(end)"?R="S0203":R="S0202";var Q={code:R,position:w.position,token:w.value,value:o};return q(Q)}var de=N(f);if(de===null)return w=te["(end)"],w.position=U.length,w;var le=de.value,c=de.type,g;switch(c){case"name":case"variable":g=te["(name)"];break;case"operator":if(g=te[le],!g)return q({code:"S0204",stack:new Error().stack,position:de.position,token:le});break;case"string":case"number":case"value":g=te["(literal)"];break;case"regex":c="regex",g=te["(regex)"];break;default:return q({code:"S0205",stack:new Error().stack,position:de.position,token:le})}return w=Object.create(g),w.value=le,w.type=c,w.position=de.position,w},E=function(o){var f,R=w;for(h(null,!0),f=R.nud();o<w.lbp;)R=w,h(),f=R.led(f);return f},p=function(o){var f=O(o,0);f.nud=function(){return this}},v=function(o,f,R){var Q=f||J[o],de=O(o,Q);return de.led=R||function(le){return this.lhs=le,this.rhs=E(Q),this.type="binary",this},de},k=function(o,f,R){var Q=O(o,f);return Q.led=R,Q},T=function(o,f){var R=O(o);return R.nud=f||function(){return this.expression=E(70),this.type="unary",this},R};p("(end)"),p("(name)"),p("(literal)"),p("(regex)"),O(":"),O(";"),O(","),O(")"),O("]"),O("}"),O(".."),v("."),v("+"),v("-"),v("*"),v("/"),v("%"),v("="),v("<"),v(">"),v("!="),v("<="),v(">="),v("&"),v("and"),v("or"),v("in"),p("and"),p("or"),p("in"),T("-"),v("~>"),k("(error)",10,function(o){return this.lhs=o,this.error=w.error,this.remaining=ce(),this.type="error",this}),T("*",function(){return this.type="wildcard",this}),T("**",function(){return this.type="descendant",this}),T("%",function(){return this.type="parent",this}),v("(",J["("],function(o){if(this.procedure=o,this.type="function",this.arguments=[],w.id!==")")for(;w.type==="operator"&&w.id==="?"?(this.type="partial",this.arguments.push(w),h("?")):this.arguments.push(E(0)),w.id===",";)h(",");if(h(")",!0),o.type==="name"&&(o.value==="function"||o.value==="\u03BB")){if(this.arguments.forEach(function(le,c){if(le.type!=="variable")return q({code:"S0208",stack:new Error().stack,position:le.position,token:le.value,value:c+1})}),this.type="lambda",w.id==="<"){for(var f=w.position,R=1,Q="<";R>0&&w.id!=="{"&&w.id!=="(end)";){var de=h();de.id===">"?R--:de.id==="<"&&R++,Q+=de.value}h(">");try{this.signature=ke(Q)}catch(le){return le.position=f+le.offset,q(le)}}h("{"),this.body=E(0),h("}")}return this}),T("(",function(){for(var o=[];w.id!==")"&&(o.push(E(0)),w.id===";");)h(";");return h(")",!0),this.type="block",this.expressions=o,this}),T("[",function(){var o=[];if(w.id!=="]")for(;;){var f=E(0);if(w.id===".."){var R={type:"binary",value:"..",position:w.position,lhs:f};h(".."),R.rhs=E(0),f=R}if(o.push(f),w.id!==",")break;h(",")}return h("]",!0),this.expressions=o,this.type="unary",this}),v("[",J["["],function(o){if(w.id==="]"){for(var f=o;f&&f.type==="binary"&&f.value==="[";)f=f.lhs;return f.keepArray=!0,h("]"),o}else return this.lhs=o,this.rhs=E(J["]"]),this.type="binary",h("]",!0),this}),v("^",J["^"],function(o){h("(");for(var f=[];;){var R={descending:!1};if(w.id==="<"?h("<"):w.id===">"&&(R.descending=!0,h(">")),R.expression=E(0),f.push(R),w.id!==",")break;h(",")}return h(")"),this.lhs=o,this.rhs=f,this.type="binary",this});var F=function(o){var f=[];if(w.id!=="}")for(;;){var R=E(0);h(":");var Q=E(0);if(f.push([R,Q]),w.id!==",")break;h(",")}return h("}",!0),typeof o=="undefined"?(this.lhs=f,this.type="unary"):(this.lhs=o,this.rhs=f,this.type="binary"),this};T("{",F),v("{",J["{"],F),k(":=",J[":="],function(o){return o.type!=="variable"?q({code:"S0212",stack:new Error().stack,position:o.position,token:o.value}):(this.lhs=o,this.rhs=E(J[":="]-1),this.type="binary",this)}),v("@",J["@"],function(o){return this.lhs=o,this.rhs=E(J["@"]),this.rhs.type!=="variable"?q({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),v("#",J["#"],function(o){return this.lhs=o,this.rhs=E(J["#"]),this.rhs.type!=="variable"?q({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),v("?",J["?"],function(o){return this.type="condition",this.condition=o,this.then=E(0),w.id===":"&&(h(":"),this.else=E(0)),this}),T("|",function(){return this.type="transform",this.pattern=E(0),h("|"),this.update=E(0),w.id===","&&(h(","),this.delete=E(0)),h("|"),this});var I=function(o){var f;if(o.type==="function"&&!o.predicate){var R={type:"lambda",thunk:!0,arguments:[],position:o.position};R.body=o,f=R}else if(o.type==="condition")o.then=I(o.then),typeof o.else!="undefined"&&(o.else=I(o.else)),f=o;else if(o.type==="block"){var Q=o.expressions.length;Q>0&&(o.expressions[Q-1]=I(o.expressions[Q-1])),f=o}else f=o;return f},L=0,ae=0,De=[],Z=function(o,f){switch(o.type){case"name":case"wildcard":f.level--,f.level===0&&(typeof o.ancestor=="undefined"||(De[f.index].slot.label=o.ancestor.label),o.ancestor=f,o.tuple=!0);break;case"parent":f.level++;break;case"block":o.expressions.length>0&&(o.tuple=!0,f=Z(o.expressions[o.expressions.length-1],f));break;case"path":o.tuple=!0;var R=o.steps.length-1;for(f=Z(o.steps[R--],f);f.level>0&&R>=0;)f=Z(o.steps[R--],f);break;default:throw{code:"S0217",token:o.type,position:o.position}}return f},H=function(o,f){if(typeof f.seekingParent!="undefined"||f.type==="parent"){var R=typeof f.seekingParent!="undefined"?f.seekingParent:[];f.type==="parent"&&R.push(f.slot),typeof o.seekingParent=="undefined"?o.seekingParent=R:Array.prototype.push.apply(o.seekingParent,R)}},Ae=function(o){var f=o.steps.length-1,R=o.steps[f],Q=typeof R.seekingParent!="undefined"?R.seekingParent:[];R.type==="parent"&&Q.push(R.slot);for(var de=0;de<Q.length;de++){var le=Q[de];for(f=o.steps.length-2;le.level>0;){if(f<0){typeof o.seekingParent=="undefined"?o.seekingParent=[le]:o.seekingParent.push(le);break}for(var c=o.steps[f--];f>=0&&c.focus&&o.steps[f].focus;)c=o.steps[f--];le=Z(c,le)}}},G=function(o){var f;switch(o.type){case"binary":switch(o.value){case".":var R=G(o.lhs);R.type==="path"?f=R:f={type:"path",steps:[R]},R.type==="parent"&&(f.seekingParent=[R.slot]);var Q=G(o.rhs);Q.type==="function"&&Q.procedure.type==="path"&&Q.procedure.steps.length===1&&Q.procedure.steps[0].type==="name"&&f.steps[f.steps.length-1].type==="function"&&(f.steps[f.steps.length-1].nextFunction=Q.procedure.steps[0].value),Q.type==="path"?Array.prototype.push.apply(f.steps,Q.steps):(typeof Q.predicate!="undefined"&&(Q.stages=Q.predicate,delete Q.predicate),f.steps.push(Q)),f.steps.filter(function(M){if(M.type==="number"||M.type==="value")throw{code:"S0213",stack:new Error().stack,position:M.position,value:M.value};return M.type==="string"}).forEach(function(M){M.type="name"}),f.steps.filter(function(M){return M.keepArray===!0}).length>0&&(f.keepSingletonArray=!0);var de=f.steps[0];de.type==="unary"&&de.value==="["&&(de.consarray=!0);var le=f.steps[f.steps.length-1];le.type==="unary"&&le.value==="["&&(le.consarray=!0),Ae(f);break;case"[":f=G(o.lhs);var c=f,g="predicate";if(f.type==="path"&&(c=f.steps[f.steps.length-1],g="stages"),typeof c.group!="undefined")throw{code:"S0209",stack:new Error().stack,position:o.position};typeof c[g]=="undefined"&&(c[g]=[]);var d=G(o.rhs);typeof d.seekingParent!="undefined"&&(d.seekingParent.forEach(M=>{M.level===1?Z(c,M):M.level--}),H(c,d)),c[g].push({type:"filter",expr:d,position:o.position});break;case"{":if(f=G(o.lhs),typeof f.group!="undefined")throw{code:"S0210",stack:new Error().stack,position:o.position};f.group={lhs:o.rhs.map(function(M){return[G(M[0]),G(M[1])]}),position:o.position};break;case"^":f=G(o.lhs),f.type!=="path"&&(f={type:"path",steps:[f]});var D={type:"sort",position:o.position};D.terms=o.rhs.map(function(M){var $=G(M.expression);return H(D,$),{descending:M.descending,expression:$}}),f.steps.push(D),Ae(f);break;case":=":f={type:"bind",value:o.value,position:o.position},f.lhs=G(o.lhs),f.rhs=G(o.rhs),H(f,f.rhs);break;case"@":if(f=G(o.lhs),c=f,f.type==="path"&&(c=f.steps[f.steps.length-1]),typeof c.stages!="undefined"||typeof c.predicate!="undefined")throw{code:"S0215",stack:new Error().stack,position:o.position};if(c.type==="sort")throw{code:"S0216",stack:new Error().stack,position:o.position};o.keepArray&&(c.keepArray=!0),c.focus=o.rhs.value,c.tuple=!0;break;case"#":f=G(o.lhs),c=f,f.type==="path"?c=f.steps[f.steps.length-1]:(f={type:"path",steps:[f]},typeof c.predicate!="undefined"&&(c.stages=c.predicate,delete c.predicate)),typeof c.stages=="undefined"?c.index=o.rhs.value:c.stages.push({type:"index",value:o.rhs.value,position:o.position}),c.tuple=!0;break;case"~>":f={type:"apply",value:o.value,position:o.position},f.lhs=G(o.lhs),f.rhs=G(o.rhs);break;default:f={type:o.type,value:o.value,position:o.position},f.lhs=G(o.lhs),f.rhs=G(o.rhs),H(f,f.lhs),H(f,f.rhs)}break;case"unary":f={type:o.type,value:o.value,position:o.position},o.value==="["?f.expressions=o.expressions.map(function(M){var $=G(M);return H(f,$),$}):o.value==="{"?f.lhs=o.lhs.map(function(M){var $=G(M[0]);H(f,$);var ne=G(M[1]);return H(f,ne),[$,ne]}):(f.expression=G(o.expression),o.value==="-"&&f.expression.type==="number"?(f=f.expression,f.value=-f.value):H(f,f.expression));break;case"function":case"partial":f={type:o.type,name:o.name,value:o.value,position:o.position},f.arguments=o.arguments.map(function(M){var $=G(M);return H(f,$),$}),f.procedure=G(o.procedure);break;case"lambda":f={type:o.type,arguments:o.arguments,signature:o.signature,position:o.position};var P=G(o.body);f.body=I(P);break;case"condition":f={type:o.type,position:o.position},f.condition=G(o.condition),H(f,f.condition),f.then=G(o.then),H(f,f.then),typeof o.else!="undefined"&&(f.else=G(o.else),H(f,f.else));break;case"transform":f={type:o.type,position:o.position},f.pattern=G(o.pattern),f.update=G(o.update),typeof o.delete!="undefined"&&(f.delete=G(o.delete));break;case"block":f={type:o.type,position:o.position},f.expressions=o.expressions.map(function(M){var $=G(M);return H(f,$),($.consarray||$.type==="path"&&$.steps[0].consarray)&&(f.consarray=!0),$});break;case"name":f={type:"path",steps:[o]},o.keepArray&&(f.keepSingletonArray=!0);break;case"parent":f={type:"parent",slot:{label:"!"+L++,level:1,index:ae++}},De.push(f);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":f=o;break;case"operator":if(o.value==="and"||o.value==="or"||o.value==="in")o.type="name",f=G(o);else if(o.value==="?")f=o;else throw{code:"S0201",stack:new Error().stack,position:o.position,token:o.value};break;case"error":f=o,o.lhs&&(f=G(o.lhs));break;default:var S="S0206";o.id==="(end)"&&(S="S0207");var b={code:S,position:o.position,token:o.value};if(m)return ie.push(b),{type:"error",error:b};throw b.stack=new Error().stack,b}return o.keepArray&&(f.keepArray=!0),f};N=fe(U),h();var we=E(0);if(w.id!=="(end)"){var Be={code:"S0201",position:w.position,token:w.value};q(Be)}if(we=G(we),we.type==="parent"||typeof we.seekingParent!="undefined")throw{code:"S0217",token:we.type,position:we.position};return ie.length>0&&(we.errors=ie),we};return ge})();ve.exports=A},{"./signature":5}],5:[function(ue,ve,Te){var ke=ue("./utils");const A=(()=>{var J={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function ye(fe){for(var ge=1,U=[],m={},w=m;ge<fe.length;){var N=fe.charAt(ge);if(N===":")break;var te=function(){U.push(m),w=m,m={}},ie=function(v,k,T,F){for(var I=1,L=k;L<v.length;)if(L++,N=v.charAt(L),N===F){if(I--,I===0)break}else N===T&&I++;return L};switch(N){case"s":case"n":case"b":case"l":case"o":m.regex="["+N+"m]",m.type=N,te();break;case"a":m.regex="[asnblfom]",m.type=N,m.array=!0,te();break;case"f":m.regex="f",m.type=N,te();break;case"j":m.regex="[asnblom]",m.type=N,te();break;case"x":m.regex="[asnblfom]",m.type=N,te();break;case"-":w.context=!0,w.contextRegex=new RegExp(w.regex),w.regex+="?";break;case"?":case"+":w.regex+=N;break;case"(":var ce=ie(fe,ge,"(",")"),j=fe.substring(ge+1,ce);if(j.indexOf("<")===-1)m.regex="["+j+"m]";else throw{code:"S0402",stack:new Error().stack,value:j,offset:ge};m.type="("+j+")",ge=ce,te();break;case"<":if(w.type==="a"||w.type==="f"){var O=ie(fe,ge,"<",">");w.subtype=fe.substring(ge+1,O),ge=O}else throw{code:"S0401",stack:new Error().stack,value:w.type,offset:ge};break}ge++}var q="^"+U.map(function(v){return"("+v.regex+")"}).join("")+"$",h=new RegExp(q),E=function(v){var k;if(ke.isFunction(v))k="f";else{var T=typeof v;switch(T){case"string":k="s";break;case"number":k="n";break;case"boolean":k="b";break;case"object":v===null?k="l":Array.isArray(v)?k="a":k="o";break;case"undefined":default:k="m"}}return k},p=function(v,k){for(var T="^",F=0,I=0;I<U.length;I++){T+=U[I].regex;var L=k.match(T);if(L===null)throw{code:"T0410",stack:new Error().stack,value:v[F],index:F+1};F=L[0].length}throw{code:"T0410",stack:new Error().stack,value:v[F],index:F+1}};return{definition:fe,validate:function(v,k){var T="";v.forEach(function(ae){T+=E(ae)});var F=h.exec(T);if(F){var I=[],L=0;return U.forEach(function(ae,De){var Z=v[L],H=F[De+1];if(H==="")if(ae.context&&ae.contextRegex){var Ae=E(k);if(ae.contextRegex.test(Ae))I.push(k);else throw{code:"T0411",stack:new Error().stack,value:k,index:L+1}}else I.push(Z),L++;else H.split("").forEach(function(G){if(ae.type==="a"){if(G==="m")Z=void 0;else{Z=v[L];var we=!0;if(typeof ae.subtype!="undefined"){if(G!=="a"&&H!==ae.subtype)we=!1;else if(G==="a"&&Z.length>0){var Be=E(Z[0]);if(Be!==ae.subtype.charAt(0))we=!1;else{var o=Z.filter(function(f){return E(f)!==Be});we=o.length===0}}}if(!we)throw{code:"T0412",stack:new Error().stack,value:Z,index:L+1,type:J[ae.subtype]};G!=="a"&&(Z=[Z])}I.push(Z),L++}else I.push(Z),L++})}),I}p(v,T)}}}return ye})();ve.exports=A},{"./utils":6}],6:[function(ue,ve,Te){const ke=(()=>{function A(O){var q=!1;if(typeof O=="number"&&(q=!isNaN(O),q&&!isFinite(O)))throw{code:"D1001",value:O,stack:new Error().stack};return q}function J(O){var q=!1;return Array.isArray(O)&&(q=O.filter(function(h){return typeof h!="string"}).length===0),q}function ye(O){var q=!1;return Array.isArray(O)&&(q=O.filter(function(h){return!A(h)}).length===0),q}function fe(){var O=[];return O.sequence=!0,arguments.length===1&&O.push(arguments[0]),O}function ge(O){return O.sequence===!0&&Array.isArray(O)}function U(O){return O&&(O._jsonata_function===!0||O._jsonata_lambda===!0)||typeof O=="function"}function m(O){var q=typeof O.arity=="number"?O.arity:typeof O.implementation=="function"?O.implementation.length:typeof O.length=="number"?O.length:O.arguments.length;return q}function w(O){return O&&O._jsonata_lambda===!0}var N=typeof Symbol=="function"?Symbol:{},te=N.iterator||"@@iterator";function ie(O){return typeof O=="object"&&O!==null&&te in O&&"next"in O&&typeof O.next=="function"}function ce(O,q){if(O===q)return!0;if(typeof O=="object"&&typeof q=="object"&&O!==null&&q!==null){if(Array.isArray(O)&&Array.isArray(q)){if(O.length!==q.length)return!1;for(var h=0;h<O.length;h++)if(!ce(O[h],q[h]))return!1;return!0}var E=Object.getOwnPropertyNames(O),p=Object.getOwnPropertyNames(q);if(E.length!==p.length)return!1;for(E=E.sort(),p=p.sort(),h=0;h<E.length;h++)if(E[h]!==p[h])return!1;for(h=0;h<E.length;h++){var v=E[h];if(!ce(O[v],q[v]))return!1}return!0}return!1}function j(O){var q=[];for(let h of O)q.push(h);return q}return{isNumeric:A,isArrayOfStrings:J,isArrayOfNumbers:ye,createSequence:fe,isSequence:ge,isFunction:U,isLambda:w,isIterable:ie,getFunctionArity:m,isDeepEqual:ce,stringToArray:j}})();ve.exports=ke},{}]},{},[3])(3)})})(St);var bt={exports:{}};(function(rt,yt){(function(ue,ve){{var Te=ve();rt&&rt.exports&&(yt=rt.exports=Te),yt.randomColor=Te}})(gt,function(){var ue=null,ve={};ce();var Te=[],ke=function(p){if(p=p||{},p.seed!==void 0&&p.seed!==null&&p.seed===parseInt(p.seed,10))ue=p.seed;else if(typeof p.seed=="string")ue=h(p.seed);else{if(p.seed!==void 0&&p.seed!==null)throw new TypeError("The seed value must be an integer or string");ue=null}var v,k,T;if(p.count!==null&&p.count!==void 0){for(var F=p.count,I=[],L=0;L<p.count;L++)Te.push(!1);for(p.count=null;F>I.length;){var ae=ke(p);ue!==null&&(p.seed=ue),I.push(ae)}return p.count=F,I}return v=A(p),k=J(v,p),T=ye(v,k,p),fe([v,k,T],p)};function A(p){if(Te.length>0){var v=E(p.hue),k=N(v),T=(v[1]-v[0])/Te.length,F=parseInt((k-v[0])/T);Te[F]===!0?F=(F+2)%Te.length:Te[F]=!0;var I=(v[0]+F*T)%359,L=(v[0]+(F+1)*T)%359;return v=[I,L],k=N(v),k<0&&(k=360+k),k}else{var v=U(p.hue);return k=N(v),k<0&&(k=360+k),k}}function J(p,v){if(v.hue==="monochrome")return 0;if(v.luminosity==="random")return N([0,100]);var k=m(p),T=k[0],F=k[1];switch(v.luminosity){case"bright":T=55;break;case"dark":T=F-10;break;case"light":F=55;break}return N([T,F])}function ye(p,v,k){var T=ge(p,v),F=100;switch(k.luminosity){case"dark":F=T+20;break;case"light":T=(F+T)/2;break;case"random":T=0,F=100;break}return N([T,F])}function fe(p,v){switch(v.format){case"hsvArray":return p;case"hslArray":return q(p);case"hsl":var k=q(p);return"hsl("+k[0]+", "+k[1]+"%, "+k[2]+"%)";case"hsla":var T=q(p),L=v.alpha||Math.random();return"hsla("+T[0]+", "+T[1]+"%, "+T[2]+"%, "+L+")";case"rgbArray":return j(p);case"rgb":var F=j(p);return"rgb("+F.join(", ")+")";case"rgba":var I=j(p),L=v.alpha||Math.random();return"rgba("+I.join(", ")+", "+L+")";default:return te(p)}}function ge(p,v){for(var k=w(p).lowerBounds,T=0;T<k.length-1;T++){var F=k[T][0],I=k[T][1],L=k[T+1][0],ae=k[T+1][1];if(v>=F&&v<=L){var De=(ae-I)/(L-F),Z=I-De*F;return De*v+Z}}return 0}function U(p){if(typeof parseInt(p)=="number"){var v=parseInt(p);if(v<360&&v>0)return[v,v]}if(typeof p=="string"){if(ve[p]){var k=ve[p];if(k.hueRange)return k.hueRange}else if(p.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var T=O(p)[0];return[T,T]}}return[0,360]}function m(p){return w(p).saturationRange}function w(p){p>=334&&p<=360&&(p-=360);for(var v in ve){var k=ve[v];if(k.hueRange&&p>=k.hueRange[0]&&p<=k.hueRange[1])return ve[v]}return"Color not found"}function N(p){if(ue===null){var v=.618033988749895,k=Math.random();return k+=v,k%=1,Math.floor(p[0]+k*(p[1]+1-p[0]))}else{var T=p[1]||1,F=p[0]||0;ue=(ue*9301+49297)%233280;var I=ue/233280;return Math.floor(F+I*(T-F))}}function te(p){var v=j(p);function k(F){var I=F.toString(16);return I.length==1?"0"+I:I}var T="#"+k(v[0])+k(v[1])+k(v[2]);return T}function ie(p,v,k){var T=k[0][0],F=k[k.length-1][0],I=k[k.length-1][1],L=k[0][1];ve[p]={hueRange:v,lowerBounds:k,saturationRange:[T,F],brightnessRange:[I,L]}}function ce(){ie("monochrome",null,[[0,0],[100,0]]),ie("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50]]),ie("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70]]),ie("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75]]),ie("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40]]),ie("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35]]),ie("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42]]),ie("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73]])}function j(p){var v=p[0];v===0&&(v=1),v===360&&(v=359),v=v/360;var k=p[1]/100,T=p[2]/100,F=Math.floor(v*6),I=v*6-F,L=T*(1-k),ae=T*(1-I*k),De=T*(1-(1-I)*k),Z=256,H=256,Ae=256;switch(F){case 0:Z=T,H=De,Ae=L;break;case 1:Z=ae,H=T,Ae=L;break;case 2:Z=L,H=T,Ae=De;break;case 3:Z=L,H=ae,Ae=T;break;case 4:Z=De,H=L,Ae=T;break;case 5:Z=T,H=L,Ae=ae;break}var G=[Math.floor(Z*255),Math.floor(H*255),Math.floor(Ae*255)];return G}function O(p){p=p.replace(/^#/,""),p=p.length===3?p.replace(/(.)/g,"$1$1"):p;var v=parseInt(p.substr(0,2),16)/255,k=parseInt(p.substr(2,2),16)/255,T=parseInt(p.substr(4,2),16)/255,F=Math.max(v,k,T),I=F-Math.min(v,k,T),L=F?I/F:0;switch(F){case v:return[60*((k-T)/I%6)||0,L,F];case k:return[60*((T-v)/I+2)||0,L,F];case T:return[60*((v-k)/I+4)||0,L,F]}}function q(p){var v=p[0],k=p[1]/100,T=p[2]/100,F=(2-k)*T;return[v,Math.round(k*T/(F<1?F:2-F)*1e4)/100,F/2*100]}function h(p){for(var v=0,k=0;k!==p.length&&!(v>=Number.MAX_SAFE_INTEGER);k++)v+=p.charCodeAt(k);return v}function E(p){if(isNaN(p)){if(typeof p=="string"){if(ve[p]){var k=ve[p];if(k.hueRange)return k.hueRange}else if(p.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var T=O(p)[0];return w(T).hueRange}}}else{var v=parseInt(p);if(v<360&&v>0)return w(p).hueRange}return[0,360]}return ke})})(bt,bt.exports);var xt=bt.exports;export{xt as r};

import{S as Z,i as x,s as ee,N as te,l as G,g as j,O as ne,q as L,o as N,d as h,R as ae,Y as le,e as g,t as w,c as E,a as T,h as y,f as K,M as m,E as F,k as S,m as Q,b as C,_ as X,P as Y,j as W,G as oe,X as se,a0 as re,w as A,x as B,y as P,a1 as ie,B as U}from"../../../../chunks/index-bed072e4.js";import{p as ce}from"../../../../chunks/stores-0b62df75.js";import ue from"../../../TopNav.svelte-34dab812.js";import{l as me,s as fe}from"../../../../chunks/utils-c922859c.js";import pe from"../Tabs.svelte-c2d49e21.js";import de from"../Toolbar.svelte-a8726096.js";import _e from"../Table.svelte-6527ee69.js";import{M as be}from"../../../../chunks/Modal-e470a048.js";import he from"../SideBar.svelte-992465c0.js";import"../../../../chunks/Dropdown-c142f7f6.js";import"../../../../chunks/themes-fa5ad8e6.js";import"../../../../chunks/lodash-8a03b776.js";import"../../../../chunks/randomColor-af782e7b.js";import"../../../../chunks/v4-bf0bf616.js";import"../../../../chunks/iconMap-7a0cdc3f.js";import"../Column.svelte-5aecc7f6.js";import"../Cell.svelte-b38f3a3f.js";function $e(l){let t,o=l[17].message+"",n;return{c(){t=g("p"),n=w(o),this.h()},l(a){t=E(a,"P",{style:!0});var u=T(t);n=y(u,o),u.forEach(h),this.h()},h(){K(t,"color","red")},m(a,u){j(a,t,u),m(t,n)},p:F,i:F,o:F,d(a){a&&h(t)}}}function ve(l){let t,o,n,a,u,i,f,d,r,b,_,c,D,$,I,V;t=new ue({props:{schema:l[2]}}),a=new he({props:{schema:l[2]}}),a.$on("openObject",l[7]),f=new pe({}),r=new de({props:{table:l[3]}}),r.$on("openQuery",l[8]),r.$on("openView",l[9]);let p=l[0]&&H(l);c=new _e({props:{table:l[3]}}),c.$on("editCell",l[11]);function M(e){l[12](e)}let R={title:"SQL Query",$$slots:{body:[ge]},$$scope:{ctx:l}};return l[1]!==void 0&&(R.open=l[1]),$=new be({props:R}),se.push(()=>re($,"open",M)),{c(){A(t.$$.fragment),o=S(),n=g("div"),A(a.$$.fragment),u=S(),i=g("div"),A(f.$$.fragment),d=S(),A(r.$$.fragment),b=S(),p&&p.c(),_=S(),A(c.$$.fragment),D=S(),A($.$$.fragment),this.h()},l(e){B(t.$$.fragment,e),o=Q(e),n=E(e,"DIV",{class:!0});var s=T(n);B(a.$$.fragment,s),u=Q(s),i=E(s,"DIV",{class:!0,style:!0});var v=T(i);B(f.$$.fragment,v),d=Q(v),B(r.$$.fragment,v),b=Q(v),p&&p.l(v),_=Q(v),B(c.$$.fragment,v),v.forEach(h),s.forEach(h),D=Q(e),B($.$$.fragment,e),this.h()},h(){C(i,"class","flex overflow-hidden flex-col h-full flex-grow"),K(i,"height","calc(100vh - 52px)"),C(n,"class","w-screen flex bg-zinc-100 bg-opacity-10")},m(e,s){P(t,e,s),j(e,o,s),j(e,n,s),P(a,n,null),m(n,u),m(n,i),P(f,i,null),m(i,d),P(r,i,null),m(i,b),p&&p.m(i,null),m(i,_),P(c,i,null),j(e,D,s),P($,e,s),V=!0},p(e,s){const v={};s&4&&(v.schema=e[2]),t.$set(v);const O={};s&4&&(O.schema=e[2]),a.$set(O);const q={};s&8&&(q.table=e[3]),r.$set(q),e[0]?p?p.p(e,s):(p=H(e),p.c(),p.m(i,_)):p&&(p.d(1),p=null);const z={};s&8&&(z.table=e[3]),c.$set(z);const k={};s&262152&&(k.$$scope={dirty:s,ctx:e}),!I&&s&2&&(I=!0,k.open=e[1],ie(()=>I=!1)),$.$set(k)},i(e){V||(L(t.$$.fragment,e),L(a.$$.fragment,e),L(f.$$.fragment,e),L(r.$$.fragment,e),L(c.$$.fragment,e),L($.$$.fragment,e),V=!0)},o(e){N(t.$$.fragment,e),N(a.$$.fragment,e),N(f.$$.fragment,e),N(r.$$.fragment,e),N(c.$$.fragment,e),N($.$$.fragment,e),V=!1},d(e){U(t,e),e&&h(o),e&&h(n),U(a),U(f),U(r),p&&p.d(),U(c),e&&h(D),U($,e)}}}function H(l){let t,o=l[0].column.source.table.name+"",n,a,u=l[0].column.name+"",i,f,d,r,b;return{c(){t=g("div"),n=w(o),a=S(),i=w(u),f=S(),d=g("input"),this.h()},l(_){t=E(_,"DIV",{class:!0});var c=T(t);n=y(c,o),a=Q(c),i=y(c,u),f=Q(c),d=E(c,"INPUT",{class:!0,type:!0}),c.forEach(h),this.h()},h(){C(d,"class","border rounded p-2"),C(d,"type","text"),C(t,"class","p-2")},m(_,c){j(_,t,c),m(t,n),m(t,a),m(t,i),m(t,f),m(t,d),X(d,l[0].cell),r||(b=[Y(d,"keyup",l[6]),Y(d,"input",l[10])],r=!0)},p(_,c){c&1&&o!==(o=_[0].column.source.table.name+"")&&W(n,o),c&1&&u!==(u=_[0].column.name+"")&&W(i,u),c&1&&d.value!==_[0].cell&&X(d,_[0].cell)},d(_){_&&h(t),r=!1,oe(b)}}}function ge(l){let t,o,n,a,u,i,f,d,r,b,_=l[3].name+"",c,D,$=l[3].columns.map(J).join(",")+"",I,V,p=l[3].baseTable.name+"",M,R;return{c(){t=g("div"),o=g("div"),n=g("button"),a=g("i"),u=w(" Copy Query"),i=S(),f=g("div"),d=g("pre"),r=g("code"),b=w("CREATE VIEW '"),c=w(_),D=w(`' AS
SELECT
`),I=w($),V=w(`
FROM '`),M=w(p),R=w(`'         
`),this.h()},l(e){t=E(e,"DIV",{slot:!0,class:!0});var s=T(t);o=E(s,"DIV",{class:!0});var v=T(o);n=E(v,"BUTTON",{class:!0});var O=T(n);a=E(O,"I",{class:!0}),T(a).forEach(h),u=y(O," Copy Query"),O.forEach(h),v.forEach(h),i=Q(s),f=E(s,"DIV",{class:!0});var q=T(f);d=E(q,"PRE",{});var z=T(d);r=E(z,"CODE",{});var k=T(r);b=y(k,"CREATE VIEW '"),c=y(k,_),D=y(k,`' AS
SELECT
`),I=y(k,$),V=y(k,`
FROM '`),M=y(k,p),R=y(k,`'         
`),k.forEach(h),z.forEach(h),q.forEach(h),s.forEach(h),this.h()},h(){C(a,"class","ri-clipboard-line align-bottom"),C(n,"class","border rounded p-2"),C(o,"class","flex items-center"),C(f,"class","border p-4 rounded bg-zinc-800 text-white"),C(t,"slot","body"),C(t,"class","space-y-2")},m(e,s){j(e,t,s),m(t,o),m(o,n),m(n,a),m(n,u),m(t,i),m(t,f),m(f,d),m(d,r),m(r,b),m(r,c),m(r,D),m(r,I),m(r,V),m(r,M),m(r,R)},p(e,s){s&8&&_!==(_=e[3].name+"")&&W(c,_),s&8&&$!==($=e[3].columns.map(J).join(",")+"")&&W(I,$),s&8&&p!==(p=e[3].baseTable.name+"")&&W(M,p)},d(e){e&&h(t)}}}function Ee(l){let t,o;return{c(){t=g("div"),o=w("Loading (can be removed)")},l(n){t=E(n,"DIV",{});var a=T(t);o=y(a,"Loading (can be removed)"),a.forEach(h)},m(n,a){j(n,t,a),m(t,o)},p:F,i:F,o:F,d(n){n&&h(t)}}}function ke(l){let t,o,n={ctx:l,current:null,token:null,hasCatch:!0,pending:Ee,then:ve,catch:$e,value:14,error:17,blocks:[,,,]};return te(l[4](),n),{c(){t=G(),n.block.c()},l(a){t=G(),n.block.l(a)},m(a,u){j(a,t,u),n.block.m(a,n.anchor=u),n.mount=()=>t.parentNode,n.anchor=t,o=!0},p(a,[u]){l=a,ne(n,l,u)},i(a){o||(L(n.block),o=!0)},o(a){for(let u=0;u<3;u+=1){const i=n.blocks[u];N(i)}o=!1},d(a){a&&h(t),n.block.d(a),n.token=null,n=null}}}function we(l){setTimeout(function(){window.location=`/schema/${l.schema.id}/${l.id}`},200)}const J=l=>l.name;function ye(l,t,o){let n;ae(l,ce,e=>o(13,n=e));const{schemaId:a}=n.params,{viewId:u}=n.params;let i,f,d={},r={},b;async function _(){if(b=await me(),o(2,d=b.schemas.find(e=>e.id==a)),o(3,r=b.views.find(e=>e.id==u)),!(!b||!b.schemas||!b.tables))return b}le(()=>{fe(b)});function c(e,s){o(0,i={column:r.columns[e],table:r.columns[e].source.link.table,sourceColumn:r.columns[e].source.link.column,cell:r.records[s][e],recordIdx:s,columnIdx:e})}function D(e){let s=b.tables.find(O=>O.id==i.column.source.link.table.id),v=s.columns.find(O=>O.id==i.column.source.link.column.id);s.columns.indexOf(v),b.tables.indexOf(s)}const $=e=>window.location=`/schema/0/${e.detail.type}/${e.detail.id}`,I=()=>o(1,f=!f),V=e=>we(e.detail);function p(){i.cell=this.value,o(0,i)}const M=e=>c(e.detail.columnIdx,e.detail.recordIdx);function R(e){f=e,o(1,f)}return[i,f,d,r,_,c,D,$,I,V,p,M,R]}class Fe extends Z{constructor(t){super();x(this,t,ye,ke,ee,{})}}export{Fe as default};

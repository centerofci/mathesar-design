var yt=Object.defineProperty,Vt=Object.defineProperties;var Et=Object.getOwnPropertyDescriptors;var Je=Object.getOwnPropertySymbols;var Tt=Object.prototype.hasOwnProperty,St=Object.prototype.propertyIsEnumerable;var Ze=(l,e,t)=>e in l?yt(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,Me=(l,e)=>{for(var t in e||(e={}))Tt.call(e,t)&&Ze(l,t,e[t]);if(Je)for(var t of Je(e))St.call(e,t)&&Ze(l,t,e[t]);return l},We=(l,e)=>Vt(l,Et(e));import{H as It,S as _t,i as bt,s as ht,e as V,t as j,k as z,c as E,a as T,h as H,d as p,m as F,b as y,g as R,M as _,j as gt,a2 as xe,a3 as Ct,a4 as Dt,a5 as Qt,U as zt,a6 as et,n as Le,a7 as Ft,p as Ue,q as X,o as Z,R as vt,E as x,a8 as Ot,N as qt,l as tt,O as Rt,Y as Nt,f as wt,X as me,a0 as pe,a9 as Te,_ as st,P as Se,w as be,x as he,y as ge,a1 as _e,B as ve,aa as lt,G as kt}from"../../../../chunks/index-bed072e4.js";import{l as Bt,s as $t,t as nt,p as Pt,a as Mt,b as At,c as Xe,d as Lt}from"../../../../chunks/utils-c922859c.js";import Ut from"./ColumnEditor.svelte-2246dba3.js";import{t as we}from"../../../../chunks/themes-fa5ad8e6.js";import{p as jt}from"../../../../chunks/stores-0b62df75.js";import Ht from"./FormulaSettings.svelte-ffdd2178.js";import Gt from"./ColumnSelector.svelte-046b3d09.js";import Kt from"../../../TopNav.svelte-34dab812.js";import{_ as qe}from"../../../../chunks/lodash-8a03b776.js";import Wt from"./SelectedColumns.svelte-177f73d9.js";import Xt from"./TablePreview.svelte-3a08337b.js";import Yt from"./Transformations.svelte-72377f27.js";import{d as Jt,w as Zt}from"../../../../chunks/index-e0a8e33b.js";import{c as xt,f as rt}from"../../../../chunks/Dropdown-c142f7f6.js";import es from"./BaseTableSelector.svelte-53839613.js";import{v as ot}from"../../../../chunks/v4-bf0bf616.js";import"../../../../chunks/randomColor-af782e7b.js";import"./Source.svelte-be44ecdf.js";import"../../../../chunks/iconMap-7a0cdc3f.js";import"../../../../chunks/Modal-e470a048.js";import"./Column.svelte-4e7a61f9.js";import"./Step.svelte-7de45d71.js";function ts(l){const e=Zt([]);function t(r,c="default",a){e.update(u=>[...u,{id:ss(),type:c,message:r,timeout:a}])}const n=Jt(e,(r,c)=>{if(c(r),r.length>0){const a=setTimeout(()=>{e.update(u=>(u.shift(),u))},r[0].timeout);return()=>{clearTimeout(a)}}}),{subscribe:i}=n;return{subscribe:i,send:t,default:(r,c)=>t(r,"default",c),danger:(r,c)=>t(r,"danger",c),warning:(r,c)=>t(r,"warning",c),info:(r,c)=>t(r,"info",c),success:(r,c)=>t(r,"success",c)}}function ss(){return"_"+Math.random().toString(36).substr(2,9)}const je=ts();function ls(l,{from:e,to:t},n={}){const i=getComputedStyle(l),r=i.transform==="none"?"":i.transform,[c,a]=i.transformOrigin.split(" ").map(parseFloat),u=e.left+e.width*c/t.width-(t.left+c),d=e.top+e.height*a/t.height-(t.top+a),{delay:s=0,duration:I=b=>Math.sqrt(b)*120,easing:g=xt}=n;return{delay:s,duration:It(I)?I(Math.sqrt(u*u+d*d)):I,easing:g,css:(b,v)=>{const m=v*u,w=v*d,P=b+v*e.width/t.width,O=b+v*e.height/t.height;return`transform: ${r} translate(${m}px, ${w}px) scale(${P}, ${O});`}}}function it(l,e,t){const n=l.slice();return n[2]=e[t],n}function at(l){let e,t;return{c(){e=V("i"),this.h()},l(n){e=E(n,"I",{class:!0}),T(e).forEach(p),this.h()},h(){y(e,"class",t=xe(l[2].icon)+" svelte-1ykrt2d")},m(n,i){R(n,e,i)},p(n,i){i&2&&t!==(t=xe(n[2].icon)+" svelte-1ykrt2d")&&y(e,"class",t)},d(n){n&&p(e)}}}function ut(l,e){let t,n,i=e[2].message+"",r,c,a,u,d,s,I=x,g,b=e[2].icon&&at(e);return{key:l,first:null,c(){t=V("div"),n=V("div"),r=j(i),c=z(),b&&b.c(),a=z(),this.h()},l(v){t=E(v,"DIV",{class:!0});var m=T(t);n=E(m,"DIV",{class:!0});var w=T(n);r=H(w,i),w.forEach(p),c=F(m),b&&b.l(m),a=F(m),m.forEach(p),this.h()},h(){y(n,"class","content svelte-1ykrt2d"),y(t,"class",u="toast "+e[0][e[2].type]+" rounded shadow-lg svelte-1ykrt2d"),this.first=t},m(v,m){R(v,t,m),_(t,n),_(n,r),_(t,c),b&&b.m(t,null),_(t,a),g=!0},p(v,m){e=v,(!g||m&2)&&i!==(i=e[2].message+"")&&gt(r,i),e[2].icon?b?b.p(e,m):(b=at(e),b.c(),b.m(t,a)):b&&(b.d(1),b=null),(!g||m&3&&u!==(u="toast "+e[0][e[2].type]+" rounded shadow-lg svelte-1ykrt2d"))&&y(t,"class",u)},r(){s=t.getBoundingClientRect()},f(){Ct(t),I(),Dt(t,s)},a(){I(),I=Qt(t,s,ls,{})},i(v){g||(zt(()=>{d||(d=et(t,rt,{y:30},!0)),d.run(1)}),g=!0)},o(v){d||(d=et(t,rt,{y:30},!1)),d.run(0),g=!1},d(v){v&&p(t),b&&b.d(),v&&d&&d.end()}}}function ns(l){let e,t=[],n=new Map,i,r=l[1];const c=a=>a[2].id;for(let a=0;a<r.length;a+=1){let u=it(l,r,a),d=c(u);n.set(d,t[a]=ut(d,u))}return{c(){e=V("div");for(let a=0;a<t.length;a+=1)t[a].c();this.h()},l(a){e=E(a,"DIV",{class:!0});var u=T(e);for(let d=0;d<t.length;d+=1)t[d].l(u);u.forEach(p),this.h()},h(){y(e,"class","notifications svelte-1ykrt2d")},m(a,u){R(a,e,u);for(let d=0;d<t.length;d+=1)t[d].m(e,null);i=!0},p(a,[u]){if(u&3){r=a[1],Le();for(let d=0;d<t.length;d+=1)t[d].r();t=Ft(t,u,c,1,a,r,n,e,Ot,ut,null,it);for(let d=0;d<t.length;d+=1)t[d].a();Ue()}},i(a){if(!i){for(let u=0;u<r.length;u+=1)X(t[u]);i=!0}},o(a){for(let u=0;u<t.length;u+=1)Z(t[u]);i=!1},d(a){a&&p(e);for(let u=0;u<t.length;u+=1)t[u].d()}}}function rs(l,e,t){let n;vt(l,je,r=>t(1,n=r));let{themes:i={danger:"bg-red-500",success:"bg-green-500",warning:"bg-yellow-500",info:"bg-purple-500",default:"bg-purple-500"}}=e;return l.$$set=r=>{"themes"in r&&t(0,i=r.themes)},[i,n]}class os extends _t{constructor(e){super();bt(this,e,rs,ns,ht,{themes:0})}}function is(l){let e,t=l[59].message+"",n;return{c(){e=V("p"),n=j(t),this.h()},l(i){e=E(i,"P",{style:!0});var r=T(e);n=H(r,t),r.forEach(p),this.h()},h(){wt(e,"color","red")},m(i,r){R(i,e,r),_(e,n)},p:x,i:x,o:x,d(i){i&&p(e)}}}function as(l){let e,t,n,i,r,c,a,u,d,s,I,g,b,v,m,w,P,O,G,ie,Y,M,ae,A,$,ee,te=l[5].action+"",ue,ke,ce,se,K,Q,N,D,le,ne,de,Ie;e=new Kt({props:{schema:l[0]}});function ye(f){l[24](f)}let Ce={entities:l[6]};l[2]!==void 0&&(Ce.selectedView=l[2]),n=new es({props:Ce}),me.push(()=>pe(n,"selectedView",ye)),n.$on("tableSelected",l[25]);function Fe(f){l[26](f)}function Oe(f){l[27](f)}let Re={};l[2]!==void 0&&(Re.selectedView=l[2]),l[5]!==void 0&&(Re.inspector=l[5]),d=new Wt({props:Re}),me.push(()=>pe(d,"selectedView",Fe)),me.push(()=>pe(d,"inspector",Oe));function He(f){l[28](f)}let Ne={};l[2]!==void 0&&(Ne.selectedView=l[2]),b=new Yt({props:Ne}),me.push(()=>pe(b,"selectedView",He)),b.$on("previewStep",l[29]),b.$on("AddStep",l[30]),b.$on("deleteStep",l[31]);const Be=[fs,ds,cs,us],fe=[];function $e(f,C){return C[0]&12&&(ie=null),ie==null&&(ie=!!(f[3]&&!!f[6].queries.find(f[23]))),ie?0:f[2].columns.length>0?1:f[2].baseTable?3:2}Y=$e(l,[-1,-1]),M=fe[Y]=Be[Y](l);let J=l[5].action=="Query Details"&&ct(l),L=l[5].action=="Add Column"&&ft(l),U=l[5].action=="Column"&&mt(l);function Ge(f){l[47](f)}let Pe={activeFormula:Lt(l[8]),view:l[4],columns:l[7]};return l[1]!==void 0&&(Pe.showFormulaModal=l[1]),Q=new Ht({props:Pe}),me.push(()=>pe(Q,"showFormulaModal",Ge)),Q.$on("updateFormula",l[10]),le=new os({}),{c(){be(e.$$.fragment),t=z(),be(n.$$.fragment),r=z(),c=V("div"),a=V("div"),u=V("div"),be(d.$$.fragment),g=z(),be(b.$$.fragment),m=z(),w=V("div"),P=z(),O=V("div"),G=V("div"),M.c(),ae=z(),A=V("div"),$=V("div"),ee=V("h4"),ue=j(te),ke=z(),J&&J.c(),ce=z(),L&&L.c(),se=z(),U&&U.c(),K=z(),be(Q.$$.fragment),D=z(),be(le.$$.fragment),this.h()},l(f){he(e.$$.fragment,f),t=F(f),he(n.$$.fragment,f),r=F(f),c=E(f,"DIV",{class:!0,style:!0});var C=T(c);a=E(C,"DIV",{class:!0});var re=T(a);u=E(re,"DIV",{});var De=T(u);he(d.$$.fragment,De),De.forEach(p),g=F(re),he(b.$$.fragment,re),m=F(re),w=E(re,"DIV",{}),T(w).forEach(p),re.forEach(p),P=F(C),O=E(C,"DIV",{class:!0});var Ve=T(O);G=E(Ve,"DIV",{class:!0});var Qe=T(G);M.l(Qe),Qe.forEach(p),Ve.forEach(p),ae=F(C),A=E(C,"DIV",{class:!0});var o=T(A);$=E(o,"DIV",{class:!0});var h=T($);ee=E(h,"H4",{class:!0});var S=T(ee);ue=H(S,te),S.forEach(p),h.forEach(p),ke=F(o),J&&J.l(o),ce=F(o),L&&L.l(o),se=F(o),U&&U.l(o),o.forEach(p),C.forEach(p),K=F(f),he(Q.$$.fragment,f),D=F(f),he(le.$$.fragment,f),this.h()},h(){y(a,"class","flex-grow h-full flex flex-col shrink-0 "+we.darkBackgroundColor),y(G,"class","border overflow-hidden rounded border-zinc-200 flex flex-col h-full"),y(O,"class","w-7/12 p-4 border-r border-l"),y(ee,"class","leading-6"),y($,"class","text-sm font-semibold border-b border-zinc-200 p-2"),y(A,"class","flex flex-col h-full overflow-y-scroll w-80 "+we.darkBackgroundColor),y(c,"class","flex-grow flex text-zinc-800 max-w-full overflow-hidden"),wt(c,"height","calc(100vh - 120px)")},m(f,C){ge(e,f,C),R(f,t,C),ge(n,f,C),R(f,r,C),R(f,c,C),_(c,a),_(a,u),ge(d,u,null),_(a,g),ge(b,a,null),_(a,m),_(a,w),_(c,P),_(c,O),_(O,G),fe[Y].m(G,null),_(c,ae),_(c,A),_(A,$),_($,ee),_(ee,ue),_(A,ke),J&&J.m(A,null),_(A,ce),L&&L.m(A,null),_(A,se),U&&U.m(A,null),R(f,K,C),ge(Q,f,C),R(f,D,C),ge(le,f,C),ne=!0,de||(Ie=[Se(a,"click",lt(l[32])),Se(G,"click",lt(l[37]))],de=!0)},p(f,C){const re={};C[0]&1&&(re.schema=f[0]),e.$set(re);const De={};!i&&C[0]&4&&(i=!0,De.selectedView=f[2],_e(()=>i=!1)),n.$set(De);const Ve={};!s&&C[0]&4&&(s=!0,Ve.selectedView=f[2],_e(()=>s=!1)),!I&&C[0]&32&&(I=!0,Ve.inspector=f[5],_e(()=>I=!1)),d.$set(Ve);const Qe={};!v&&C[0]&4&&(v=!0,Qe.selectedView=f[2],_e(()=>v=!1)),b.$set(Qe);let o=Y;Y=$e(f,C),Y===o?fe[Y].p(f,C):(Le(),Z(fe[o],1,1,()=>{fe[o]=null}),Ue(),M=fe[Y],M?M.p(f,C):(M=fe[Y]=Be[Y](f),M.c()),X(M,1),M.m(G,null)),(!ne||C[0]&32)&&te!==(te=f[5].action+"")&&gt(ue,te),f[5].action=="Query Details"?J?J.p(f,C):(J=ct(f),J.c(),J.m(A,ce)):J&&(J.d(1),J=null),f[5].action=="Add Column"?L?(L.p(f,C),C[0]&32&&X(L,1)):(L=ft(f),L.c(),X(L,1),L.m(A,se)):L&&(Le(),Z(L,1,1,()=>{L=null}),Ue()),f[5].action=="Column"?U?(U.p(f,C),C[0]&32&&X(U,1)):(U=mt(f),U.c(),X(U,1),U.m(A,null)):U&&(Le(),Z(U,1,1,()=>{U=null}),Ue());const h={};C[0]&16&&(h.view=f[4]),!N&&C[0]&2&&(N=!0,h.showFormulaModal=f[1],_e(()=>N=!1)),Q.$set(h)},i(f){ne||(X(e.$$.fragment,f),X(n.$$.fragment,f),X(d.$$.fragment,f),X(b.$$.fragment,f),X(M),X(L),X(U),X(Q.$$.fragment,f),X(le.$$.fragment,f),ne=!0)},o(f){Z(e.$$.fragment,f),Z(n.$$.fragment,f),Z(d.$$.fragment,f),Z(b.$$.fragment,f),Z(M),Z(L),Z(U),Z(Q.$$.fragment,f),Z(le.$$.fragment,f),ne=!1},d(f){ve(e,f),f&&p(t),ve(n,f),f&&p(r),f&&p(c),ve(d),ve(b),fe[Y].d(),J&&J.d(),L&&L.d(),U&&U.d(),f&&p(K),ve(Q,f),f&&p(D),ve(le,f),de=!1,kt(Ie)}}}function us(l){let e,t,n;return{c(){e=V("div"),t=V("span"),n=j("Select or drop columns"),this.h()},l(i){e=E(i,"DIV",{class:!0});var r=T(e);t=E(r,"SPAN",{class:!0});var c=T(t);n=H(c,"Select or drop columns"),c.forEach(p),r.forEach(p),this.h()},h(){y(t,"class","text-xl"),y(e,"class","border-t "+we.darkBackgroundColor+" opacity-40 text-center text-zinc-500 border-zinc-200 p-10 flex-grow")},m(i,r){R(i,e,r),_(e,t),_(t,n)},p:x,i:x,o:x,d(i){i&&p(e)}}}function cs(l){let e,t,n;return{c(){e=V("div"),t=V("span"),n=j("Select a base table to get started"),this.h()},l(i){e=E(i,"DIV",{class:!0});var r=T(e);t=E(r,"SPAN",{class:!0});var c=T(t);n=H(c,"Select a base table to get started"),c.forEach(p),r.forEach(p),this.h()},h(){y(t,"class","text-xl"),y(e,"class","border-t "+we.darkBackgroundColor+" opacity-40 text-center text-zinc-500 border-zinc-200 p-10 flex-grow")},m(i,r){R(i,e,r),_(e,t),_(t,n)},p:x,i:x,o:x,d(i){i&&p(e)}}}function ds(l){let e,t,n,i,r,c,a,u,d,s,I;function g(m){l[35](m)}function b(m){l[36](m)}let v={records:l[14](l[2].records,l[2].steps)};return l[5]!==void 0&&(v.inspector=l[5]),l[2]!==void 0&&(v.selectedView=l[2]),u=new Xt({props:v}),me.push(()=>pe(u,"inspector",g)),me.push(()=>pe(u,"selectedView",b)),{c(){e=V("div"),t=V("h3"),n=j("Result"),i=z(),r=V("p"),c=j("Query Run Succesfully"),a=z(),be(u.$$.fragment),this.h()},l(m){e=E(m,"DIV",{class:!0});var w=T(e);t=E(w,"H3",{class:!0});var P=T(t);n=H(P,"Result"),P.forEach(p),i=F(w),r=E(w,"P",{class:!0});var O=T(r);c=H(O,"Query Run Succesfully"),O.forEach(p),w.forEach(p),a=F(m),he(u.$$.fragment,m),this.h()},h(){y(t,"class","font-semibold"),y(r,"class","text-sm text-zinc-500"),y(e,"class","p-2 flex items-center space-x-4")},m(m,w){R(m,e,w),_(e,t),_(t,n),_(e,i),_(e,r),_(r,c),R(m,a,w),ge(u,m,w),I=!0},p(m,w){const P={};w[0]&4&&(P.records=m[14](m[2].records,m[2].steps)),!d&&w[0]&32&&(d=!0,P.inspector=m[5],_e(()=>d=!1)),!s&&w[0]&4&&(s=!0,P.selectedView=m[2],_e(()=>s=!1)),u.$set(P)},i(m){I||(X(u.$$.fragment,m),I=!0)},o(m){Z(u.$$.fragment,m),I=!1},d(m){m&&p(e),m&&p(a),ve(u,m)}}}function fs(l){let e,t,n,i,r,c,a,u,d,s,I;return{c(){e=V("div"),t=V("div"),n=j("Run query or preview to list results"),i=z(),r=V("button"),c=j("Run Query"),a=z(),u=V("button"),d=j("Preview"),this.h()},l(g){e=E(g,"DIV",{class:!0});var b=T(e);t=E(b,"DIV",{class:!0});var v=T(t);n=H(v,"Run query or preview to list results"),v.forEach(p),i=F(b),r=E(b,"BUTTON",{class:!0});var m=T(r);c=H(m,"Run Query"),m.forEach(p),a=F(b),u=E(b,"BUTTON",{class:!0});var w=T(u);d=H(w,"Preview"),w.forEach(p),b.forEach(p),this.h()},h(){y(t,"class","text-xl text-zinc-500"),y(r,"class","border p-2 rounded "+we.mediumBorderColor),y(u,"class","border p-2 rounded bg-zinc-50"),y(e,"class","h-full w-full p-8 text-center space-y-2")},m(g,b){R(g,e,b),_(e,t),_(t,n),_(e,i),_(e,r),_(r,c),_(e,a),_(e,u),_(u,d),s||(I=[Se(r,"click",l[33]),Se(u,"click",l[34])],s=!0)},p:x,i:x,o:x,d(g){g&&p(e),s=!1,kt(I)}}}function ct(l){let e,t,n,i,r,c,a,u,d,s,I,g,b,v=l[6].queries.find(l[21]),m,w,P,O,G,ie,Y,M,ae,A,$,ee,te,ue,ke;function ce(N,D){return D[0]&4&&(g=null),g==null&&(g=!!N[6].queries.find(N[22])),g?ps:ms}let se=ce(l,[-1,-1]),K=se(l),Q=v&&dt(l);return{c(){e=V("div"),t=V("h4"),n=j("Save Options"),i=z(),r=V("div"),c=V("div"),a=V("label"),u=j("Query Name"),d=z(),s=V("input"),I=z(),K.c(),b=z(),Q&&Q.c(),m=z(),w=V("div"),P=z(),O=V("div"),G=V("h4"),ie=j("SQL Query"),Y=z(),M=V("p"),ae=j(`This view is a virtual table based on a SQL statement's result
              set. The SQL below can be used to recreate this view.`),A=z(),$=V("button"),ee=j("View SQL Query"),this.h()},l(N){e=E(N,"DIV",{class:!0});var D=T(e);t=E(D,"H4",{class:!0});var le=T(t);n=H(le,"Save Options"),le.forEach(p),i=F(D),r=E(D,"DIV",{class:!0});var ne=T(r);c=E(ne,"DIV",{class:!0});var de=T(c);a=E(de,"LABEL",{class:!0,for:!0});var Ie=T(a);u=H(Ie,"Query Name"),Ie.forEach(p),d=F(de),s=E(de,"INPUT",{type:!0,class:!0}),de.forEach(p),I=F(ne),K.l(ne),ne.forEach(p),b=F(D),Q&&Q.l(D),m=F(D),w=E(D,"DIV",{class:!0}),T(w).forEach(p),P=F(D),O=E(D,"DIV",{class:!0});var ye=T(O);G=E(ye,"H4",{class:!0});var Ce=T(G);ie=H(Ce,"SQL Query"),Ce.forEach(p),Y=F(ye),M=E(ye,"P",{class:!0});var Fe=T(M);ae=H(Fe,`This view is a virtual table based on a SQL statement's result
              set. The SQL below can be used to recreate this view.`),Fe.forEach(p),ye.forEach(p),A=F(D),$=E(D,"BUTTON",{class:!0});var Oe=T($);ee=H(Oe,"View SQL Query"),Oe.forEach(p),D.forEach(p),this.h()},h(){y(t,"class","font-semibold text-sm"),y(a,"class","text-sm font-semibold"),y(a,"for","viewName"),y(s,"type","text"),y(s,"class","p-2 rounded bg-zinc-100 border border-zinc-300"),y(c,"class","grid space-y-1"),y(r,"class","grid space-y-2"),y(w,"class","border-b border-zinc-200"),y(G,"class","text-sm font-semibold"),y(M,"class","text-xs text-zinc-500"),y(O,"class","space-y-1"),$.disabled=te=!l[2].baseTable,y($,"class","w-full bg-zinc-50 text-zinc-800 p-1 text-sm rounded"),Te($,"opacity-60",!l[2].baseTable),y(e,"class","p-2 space-y-4")},m(N,D){R(N,e,D),_(e,t),_(t,n),_(e,i),_(e,r),_(r,c),_(c,a),_(a,u),_(c,d),_(c,s),st(s,l[2].name),_(r,I),K.m(r,null),_(e,b),Q&&Q.m(e,null),_(e,m),_(e,w),_(e,P),_(e,O),_(O,G),_(G,ie),_(O,Y),_(O,M),_(M,ae),_(e,A),_(e,$),_($,ee),ue||(ke=Se(s,"input",l[38]),ue=!0)},p(N,D){D[0]&4&&s.value!==N[2].name&&st(s,N[2].name),se===(se=ce(N,D))&&K?K.p(N,D):(K.d(1),K=se(N),K&&(K.c(),K.m(r,null))),D[0]&4&&(v=N[6].queries.find(N[21])),v?Q?Q.p(N,D):(Q=dt(N),Q.c(),Q.m(e,m)):Q&&(Q.d(1),Q=null),D[0]&4&&te!==(te=!N[2].baseTable)&&($.disabled=te),D[0]&4&&Te($,"opacity-60",!N[2].baseTable)},d(N){N&&p(e),K.d(),Q&&Q.d(),ue=!1,ke()}}}function ms(l){let e,t,n,i,r,c,a,u;return{c(){e=V("button"),t=j("Save Query"),i=z(),r=V("a"),c=j("Close without Saving"),this.h()},l(d){e=E(d,"BUTTON",{class:!0});var s=T(e);t=H(s,"Save Query"),s.forEach(p),i=F(d),r=E(d,"A",{href:!0,class:!0});var I=T(r);c=H(I,"Close without Saving"),I.forEach(p),this.h()},h(){e.disabled=n=!l[2].baseTable,y(e,"class","w-full border "+we.mediumBorderColor+" text-zinc-800 p-1 text-sm rounded"),Te(e,"opacity-60",!l[2].baseTable),y(r,"href","./"),y(r,"class","w-full block text-center border "+we.mediumBorderColor+" bg-zinc-50 text-zinc-800 p-1 text-sm rounded")},m(d,s){R(d,e,s),_(e,t),R(d,i,s),R(d,r,s),_(r,c),a||(u=Se(e,"click",l[15]),a=!0)},p(d,s){s[0]&4&&n!==(n=!d[2].baseTable)&&(e.disabled=n),s[0]&4&&Te(e,"opacity-60",!d[2].baseTable)},d(d){d&&p(e),d&&p(i),d&&p(r),a=!1,u()}}}function ps(l){let e,t,n,i,r;return{c(){e=V("button"),t=j("Save Changes to Query"),this.h()},l(c){e=E(c,"BUTTON",{class:!0});var a=T(e);t=H(a,"Save Changes to Query"),a.forEach(p),this.h()},h(){e.disabled=n=!l[2].baseTable,y(e,"class","w-full border "+we.mediumBorderColor+" text-zinc-800 p-1 text-sm rounded"),Te(e,"opacity-60",!l[2].baseTable)},m(c,a){R(c,e,a),_(e,t),i||(r=Se(e,"click",l[15]),i=!0)},p(c,a){a[0]&4&&n!==(n=!c[2].baseTable)&&(e.disabled=n),a[0]&4&&Te(e,"opacity-60",!c[2].baseTable)},d(c){c&&p(e),i=!1,r()}}}function dt(l){let e,t,n,i,r,c,a,u,d,s,I,g,b,v;return{c(){e=V("div"),t=z(),n=V("div"),i=V("h4"),r=j("Publish as View"),c=z(),a=V("p"),u=j(`Views differ from saved queries in that they don't include the Data
                Explorer configuration\u2014transformation steps, and filters\u2014along with the query.`),d=z(),s=V("button"),I=j("Publish View"),this.h()},l(m){e=E(m,"DIV",{class:!0}),T(e).forEach(p),t=F(m),n=E(m,"DIV",{class:!0});var w=T(n);i=E(w,"H4",{class:!0});var P=T(i);r=H(P,"Publish as View"),P.forEach(p),c=F(w),a=E(w,"P",{class:!0});var O=T(a);u=H(O,`Views differ from saved queries in that they don't include the Data
                Explorer configuration\u2014transformation steps, and filters\u2014along with the query.`),O.forEach(p),w.forEach(p),d=F(m),s=E(m,"BUTTON",{class:!0});var G=T(s);I=H(G,"Publish View"),G.forEach(p),this.h()},h(){y(e,"class","border-b border-zinc-200"),y(i,"class","font-semibold text-sm"),y(a,"class","text-xs text-zinc-500"),y(n,"class","space-y-1"),s.disabled=g=!l[2].baseTable,y(s,"class","w-full border "+we.mediumBorderColor+" text-zinc-800 p-1 text-sm rounded"),Te(s,"opacity-60",!l[2].baseTable)},m(m,w){R(m,e,w),R(m,t,w),R(m,n,w),_(n,i),_(i,r),_(n,c),_(n,a),_(a,u),R(m,d,w),R(m,s,w),_(s,I),b||(v=Se(s,"click",l[16]),b=!0)},p(m,w){w[0]&4&&g!==(g=!m[2].baseTable)&&(s.disabled=g),w[0]&4&&Te(s,"opacity-60",!m[2].baseTable)},d(m){m&&p(e),m&&p(t),m&&p(n),m&&p(d),m&&p(s),b=!1,v()}}}function ft(l){let e,t,n,i;function r(a){l[39](a)}let c={tables:l[6].tables};return l[2]!==void 0&&(c.selectedView=l[2]),t=new Gt({props:c}),me.push(()=>pe(t,"selectedView",r)),t.$on("addColumn",l[40]),{c(){e=V("div"),be(t.$$.fragment)},l(a){e=E(a,"DIV",{});var u=T(e);he(t.$$.fragment,u),u.forEach(p)},m(a,u){R(a,e,u),ge(t,e,null),i=!0},p(a,u){const d={};!n&&u[0]&4&&(n=!0,d.selectedView=a[2],_e(()=>n=!1)),t.$set(d)},i(a){i||(X(t.$$.fragment,a),i=!0)},o(a){Z(t.$$.fragment,a),i=!1},d(a){a&&p(e),ve(t)}}}function mt(l){let e,t,n,i;function r(u){l[41](u)}function c(u){l[42](u)}let a={};return l[2]!==void 0&&(a.selectedView=l[2]),l[5].column!==void 0&&(a.column=l[5].column),e=new Ut({props:a}),me.push(()=>pe(e,"selectedView",r)),me.push(()=>pe(e,"column",c)),e.$on("deleteFilter",l[43]),e.$on("addFilter",l[44]),e.$on("updateAggregation",l[45]),e.$on("deleteColumn",l[46]),{c(){be(e.$$.fragment)},l(u){he(e.$$.fragment,u)},m(u,d){ge(e,u,d),i=!0},p(u,d){const s={};!t&&d[0]&4&&(t=!0,s.selectedView=u[2],_e(()=>t=!1)),!n&&d[0]&32&&(n=!0,s.column=u[5].column,_e(()=>n=!1)),e.$set(s)},i(u){i||(X(e.$$.fragment,u),i=!0)},o(u){Z(e.$$.fragment,u),i=!1},d(u){ve(e,u)}}}function _s(l){let e,t;return{c(){e=V("div"),t=j("Loading (can be removed)")},l(n){e=E(n,"DIV",{});var i=T(e);t=H(i,"Loading (can be removed)"),i.forEach(p)},m(n,i){R(n,e,i),_(e,t)},p:x,i:x,o:x,d(n){n&&p(e)}}}function bs(l){let e,t,n={ctx:l,current:null,token:null,hasCatch:!0,pending:_s,then:as,catch:is,value:6,error:59,blocks:[,,,]};return qt(l[9](),n),{c(){e=tt(),n.block.c()},l(i){e=tt(),n.block.l(i)},m(i,r){R(i,e,r),n.block.m(i,n.anchor=r),n.mount=()=>e.parentNode,n.anchor=e,t=!0},p(i,r){l=i,Rt(n,l,r)},i(i){t||(X(n.block),t=!0)},o(i){for(let r=0;r<3;r+=1){const c=n.blocks[r];Z(c)}t=!1},d(i){i&&p(e),n.block.d(i),n.token=null,n=null}}}function hs(l,e){return l.constraints.find(t=>t.type=="Foreign Key"&&t.column==e.name).referenceTable}function Ae(l,e){return l.columns.indexOf(l.columns.find(t=>t.name==e.name))}function pt(l,e){return l.constraints.find(t=>t.referenceTable&&t.referenceTable.id==e.id)}function gs(l,e){return l.reduce(function(n,i){return n.map(function(r,c){return r==i[c]?r:[r,i[c]]})})}function vs(l,e,t){let n;vt(l,jt,o=>t(49,n=o));const{schemaId:i}=n.params,{queryId:r}=n.params;let c=[],a={},u=!1,d={},s,I,g,b={id:ot(),type:"query",name:"New Query",columns:[]},v={action:"Query Details"};async function m(){t(6,g=await Bt()),t(0,a=g.schemas.find(h=>h.id==i)),g.schemas.find(h=>h.id==i).tables,t(2,s=g.queries.find(h=>h.id==r));let o=g.queries.filter(h=>h.name.startsWith("New Query")).length;if(s||(t(2,s={id:r,schemaId:qe.toNumber(i),type:"query",name:`New Query (${o})`,columns:[],steps:{}}),t(3,I=!1)),s&&t(3,I=!0),O(s.columns),!(!g||!g.schemas||!g.tables))return g}Nt(()=>{$t(g)});function w(o){let h=o.detail,S=b.columns.indexOf(d);S>=0?b.columns.splice(S,1,h):b.columns.push(h),t(4,b)}function P(o,h,S){let q;h!==S?q=hs(o,h):q=o;let k=We(Me({},S),{alias:`${S.name}`,source:{table:Me({},q)}});!o.id==s.baseTable.id&&(k.aggregation=nt[k.type].aggregations[0]),h!==S&&(k.alias=`${q.name}_${S.name}_${h.name.replace("Id","")}`),k.source.link={column:h,table:o},s.columns.push(k),t(5,v={action:"Column",column:k}),t(2,s.records=O(s.columns),s),t(2,s),$(s.records)}function O(o){let h=o.map(k=>{let B=Ae(k.source.table,k);if(k.source.link.column.name==k.name)if(pt(k.source.link.table,s.baseTable)){let W=k.source.table.columns.indexOf(k.source.table.columns.find(oe=>oe.name==pt(k.source.link.table,s.baseTable).column)),ze=k.source.table.records.map(oe=>[oe[W],oe[B]]);return k.source.table.records.map(oe=>oe[0]).reduce((oe,Ye)=>(oe[Ye]=ze.filter(Ke=>Ke[0]==Ye).map(Ke=>Ke[1]),oe),[])}else return k.source.table.records.map(W=>W[B]);else{B=Ae(k.source.link.table,k.source.link.column);let ze=k.source.link.table.records.map(Ee=>Ee[B]).map(Ee=>k.source.table.records.find(oe=>oe[0]==Ee)).map(Ee=>Ee[Ae(k.source.table,k)]);return console.log(ze,"MERGED 2"),ze}}),S=h.reduce((k,B)=>(B.forEach((W,ze)=>{k[ze]=h.map(Ee=>Ee[ze])}),k),[]),q=S.filter(k=>S.some(B=>B.length>1)?!k.some(B=>B==null):!k.some(B=>B==null||B==""));return o.forEach((k,B)=>{k.aggregation&&k.aggregation=="Count"&&q.forEach(W=>{W[B]=qe.flattenDeep(W[B]).length})}),console.log(q,"FILTER 2"),q}function G(o){s.columns.splice(Ae(s,o),1),t(2,s.records=O(s.columns),s),t(2,s)}function ie(o,h,S){let q=s.columns.indexOf(o),k=h.condition;Xe[o.type].includes(k)||(h.condition=Xe[o.type][0]);let B=h.value;return k=="contains"||k=="includes"?S.filter(W=>W[q]&&qe.toString(W).includes(B)):(console.log(S,"FILTERED"),S)}function Y(o,h,S){let q=s.columns.indexOf(o),k=qe.groupBy(S,function(W){return W[q]}),B=Object.keys(k).map(W=>gs(k[W]));return s.steps[h].aggregations.splice(0,s.steps[h].aggregations.length,s.columns.map(W=>nt[W.type].aggregations[0])),ue(s,q,h),A(B)}function M(o){let h=Object.keys(s.steps).indexOf(o);Object.keys(s.steps).forEach((S,q)=>{q>h&&t(2,s.steps[S].hidden=!s.steps[S].hidden,s)}),$(s.records)}function ae(){Object.keys(s.steps).forEach(o=>{t(2,s.steps[o].hidden=!1,s)})}function A(o){return o.map(h=>h.map(S=>Array.isArray(S)?qe.concat(qe.flattenDeep(S)):S))}function $(o,h){let S=Pt(Mt(o));return S=A(S),ke(s.columns),Object.keys(s.steps).forEach(q=>{let k=s.steps[q].column;s.steps[q].type=="filter"&&!s.steps[q].hidden&&(S=ie(k,s.steps[q],S)),s.steps[q].type=="summarize"&&!s.steps[q].hidden&&(S=Y(k,q,S))}),S}function ee(){ae(),t(2,s.records=$(s.records,s.steps),s),g.queries.find(o=>o.id==r)?je.info("Changes Saved",3e3):(g.queries.push(s),je.info("New Query Saved",3e3)),t(3,I=!1),t(2,s),t(6,g)}function te(){ae(),t(4,b=We(Me({},s),{id:ot(),name:`View of ${s.name}`,querieId:r,type:"view"})),g.views.push(b),je.info(`New View '${b.name}' Saved`,3e3),t(6,g)}function ue(o,h,S){o.columns.forEach((k,B)=>{B!==h&&!k.source.table.id==s.baseTable.id,B!==h&&(k.aggregation=o.steps[S].aggregations.map(W=>W[B])),B==h&&(k.aggregation=null)})}function ke(o){o.forEach((h,S)=>{!h.source.table.id==s.baseTable.id?h.aggregation=h.aggregation:h.aggregation=null})}function ce(o,h,S){let q=h;q.aggregation=o,q.type=At[o].type,s.columns.splice(S,1,q),t(2,s.records=O(s.columns),s),t(2,s)}function se(o){let h=s.columns.indexOf(o);o.source.filter={column:o,condition:Xe[o.type][0],value:""},t(2,s.columns[h]=o,s)}function K(o){let h=s.columns.indexOf(o);o.source.filter={},t(2,s.columns[h]=o,s)}function Q(o){t(2,s.baseTable=o,s),t(5,v.action="Add Column",v),console.log(o)}const N=o=>o.id==s.id,D=o=>o.id==s.id,le=o=>o.id==s.id;function ne(o){s=o,t(2,s)}const de=o=>{Q(o.detail)};function Ie(o){s=o,t(2,s)}function ye(o){v=o,t(5,v)}function Ce(o){s=o,t(2,s)}const Fe=o=>M(o.detail),Oe=o=>$(o.detail),Re=o=>{$(s.records)},He=()=>t(5,v={action:"Query Details"}),Ne=()=>t(3,I=!I),Be=()=>t(3,I=!I);function fe(o){v=o,t(5,v)}function $e(o){s=o,t(2,s)}const J=()=>t(5,v={action:"Query Details"});function L(){s.name=this.value,t(2,s)}function U(o){s=o,t(2,s)}const Ge=o=>P(o.detail.sourceTable,o.detail.sourceColumn,o.detail.column);function Pe(o){s=o,t(2,s)}function f(o){l.$$.not_equal(v.column,o)&&(v.column=o,t(5,v))}const C=o=>K(o.detail),re=o=>se(o.detail),De=o=>ce(o.detail.aggregation,o.detail.column,o.detail.columnIdx),Ve=o=>G(o.detail);function Qe(o){u=o,t(1,u)}return[a,u,s,I,b,v,g,c,d,m,w,P,G,M,$,ee,te,ce,se,K,Q,N,D,le,ne,de,Ie,ye,Ce,Fe,Oe,Re,He,Ne,Be,fe,$e,J,L,U,Ge,Pe,f,C,re,De,Ve,Qe]}class Us extends _t{constructor(e){super();bt(this,e,vs,bs,ht,{},null,[-1,-1])}}export{Us as default};

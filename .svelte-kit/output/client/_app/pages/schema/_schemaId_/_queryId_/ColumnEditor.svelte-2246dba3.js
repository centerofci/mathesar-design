import{S as be,i as Ee,s as ke,e as p,k as $,t as B,w as W,l as ne,c as v,a as b,d as n,m as D,h as O,x as X,b as m,g as N,M as a,y as x,o as R,p as le,q,B as ee,_ as K,P as G,H as we,G as Ie,Z as $e,Y as De,n as se,j as J,Q as oe,E as te}from"../../../../chunks/index-bed072e4.js";import{D as re}from"../../../../chunks/Dropdown-c142f7f6.js";import Ve from"./Source.svelte-be44ecdf.js";import{t as ae,c as ce}from"../../../../chunks/utils-c922859c.js";import{i as M}from"../../../../chunks/iconMap-7a0cdc3f.js";import"../../../../chunks/themes-fa5ad8e6.js";import"../../../../chunks/randomColor-af782e7b.js";import"../../../../chunks/lodash-8a03b776.js";import"../../../../chunks/v4-bf0bf616.js";function ue(i,e,o){const t=i.slice();return t[15]=e[o],t}function fe(i,e,o){const t=i.slice();return t[18]=e[o],t}function de(i,e,o){const t=i.slice();return t[21]=e[o],t}function he(i){let e,o,t,s,r,l,c,g,_,E,d,f,w,A,L,k,V,h,I,F,S,C,U,Q;E=new re({props:{$$slots:{menu:[Ae],toggle:[ze]},$$scope:{ctx:i}}});const y=[Ne,ye],P=[];function T(u,z){var H;return(H=u[1].source.filter)!=null&&H.column?1:0}return S=T(i),C=P[S]=y[S](i),{c(){e=p("div"),o=$(),t=p("div"),s=p("h4"),r=B("Aggregation Formula"),l=$(),c=p("p"),g=B("Columns containing multiple records are aggregated to be displayed in a single row."),_=$(),W(E.$$.fragment),d=$(),f=p("div"),w=$(),A=p("div"),L=p("h4"),k=B("Filter Linked Records"),V=$(),h=p("p"),I=B("Add a filter to narrow down the linked records that will be included in this column."),F=$(),C.c(),U=ne(),this.h()},l(u){e=v(u,"DIV",{class:!0}),b(e).forEach(n),o=D(u),t=v(u,"DIV",{class:!0});var z=b(t);s=v(z,"H4",{});var H=b(s);r=O(H,"Aggregation Formula"),H.forEach(n),l=D(z),c=v(z,"P",{class:!0});var j=b(c);g=O(j,"Columns containing multiple records are aggregated to be displayed in a single row."),j.forEach(n),z.forEach(n),_=D(u),X(E.$$.fragment,u),d=D(u),f=v(u,"DIV",{class:!0}),b(f).forEach(n),w=D(u),A=v(u,"DIV",{});var Y=b(A);L=v(Y,"H4",{});var Z=b(L);k=O(Z,"Filter Linked Records"),Z.forEach(n),V=D(Y),h=v(Y,"P",{class:!0});var ie=b(h);I=O(ie,"Add a filter to narrow down the linked records that will be included in this column."),ie.forEach(n),Y.forEach(n),F=D(u),C.l(u),U=ne(),this.h()},h(){m(e,"class","border-t border-zinc-200"),m(c,"class","text-sm text-zinc-500"),m(t,"class",""),m(f,"class","border-t border-zinc-200"),m(h,"class","text-sm text-zinc-500")},m(u,z){N(u,e,z),N(u,o,z),N(u,t,z),a(t,s),a(s,r),a(t,l),a(t,c),a(c,g),N(u,_,z),x(E,u,z),N(u,d,z),N(u,f,z),N(u,w,z),N(u,A,z),a(A,L),a(L,k),a(A,V),a(A,h),a(h,I),N(u,F,z),P[S].m(u,z),N(u,U,z),Q=!0},p(u,z){const H={};z&16777218&&(H.$$scope={dirty:z,ctx:u}),E.$set(H);let j=S;S=T(u),S===j?P[S].p(u,z):(se(),R(P[j],1,1,()=>{P[j]=null}),le(),C=P[S],C?C.p(u,z):(C=P[S]=y[S](u),C.c()),q(C,1),C.m(U.parentNode,U))},i(u){Q||(q(E.$$.fragment,u),q(C),Q=!0)},o(u){R(E.$$.fragment,u),R(C),Q=!1},d(u){u&&n(e),u&&n(o),u&&n(t),u&&n(_),ee(E,u),u&&n(d),u&&n(f),u&&n(w),u&&n(A),u&&n(F),P[S].d(u),u&&n(U)}}}function ze(i){let e,o,t,s,r,l=i[1].aggregation+"",c,g,_;return{c(){e=p("div"),o=p("div"),t=p("i"),r=$(),c=B(l),g=$(),_=p("i"),this.h()},l(E){e=v(E,"DIV",{slot:!0,class:!0});var d=b(e);o=v(d,"DIV",{class:!0});var f=b(o);t=v(f,"I",{class:!0}),b(t).forEach(n),r=D(f),c=O(f,l),f.forEach(n),g=D(d),_=v(d,"I",{class:!0}),b(_).forEach(n),d.forEach(n),this.h()},h(){m(t,"class",s=M[i[1].aggregation]+" align-bottom"),m(o,"class","flex-grow"),m(_,"class","ri-arrow-drop-down-line align-bottom"),m(e,"slot","toggle"),m(e,"class","cursor-pointer bg-zinc-50 py-1 px-2 rounded flex items-center")},m(E,d){N(E,e,d),a(e,o),a(o,t),a(o,r),a(o,c),a(e,g),a(e,_)},p(E,d){d&2&&s!==(s=M[E[1].aggregation]+" align-bottom")&&m(t,"class",s),d&2&&l!==(l=E[1].aggregation+"")&&J(c,l)},d(E){E&&n(e)}}}function _e(i){let e,o,t,s,r=i[21]+"",l,c,g,_;function E(){return i[8](i[21])}return{c(){e=p("div"),o=p("i"),s=$(),l=B(r),c=$(),this.h()},l(d){e=v(d,"DIV",{class:!0});var f=b(e);o=v(f,"I",{class:!0}),b(o).forEach(n),s=D(f),l=O(f,r),c=D(f),f.forEach(n),this.h()},h(){m(o,"class",t=M[i[21]]+" align-bottom"),m(e,"class","p-2 cursor-pointer hover:bg-zinc-200")},m(d,f){N(d,e,f),a(e,o),a(e,s),a(e,l),a(e,c),g||(_=G(e,"click",E),g=!0)},p(d,f){i=d,f&2&&t!==(t=M[i[21]]+" align-bottom")&&m(o,"class",t),f&2&&r!==(r=i[21]+"")&&J(l,r)},d(d){d&&n(e),g=!1,_()}}}function Ae(i){let e,o=ae[i[1].source.link.column.type].aggregations,t=[];for(let s=0;s<o.length;s+=1)t[s]=_e(de(i,o,s));return{c(){e=p("div");for(let s=0;s<t.length;s+=1)t[s].c();this.h()},l(s){e=v(s,"DIV",{slot:!0});var r=b(e);for(let l=0;l<t.length;l+=1)t[l].l(r);r.forEach(n),this.h()},h(){m(e,"slot","menu")},m(s,r){N(s,e,r);for(let l=0;l<t.length;l+=1)t[l].m(e,null)},p(s,r){if(r&34){o=ae[s[1].source.link.column.type].aggregations;let l;for(l=0;l<o.length;l+=1){const c=de(s,o,l);t[l]?t[l].p(c,r):(t[l]=_e(c),t[l].c(),t[l].m(e,null))}for(;l<t.length;l+=1)t[l].d(1);t.length=o.length}},d(s){s&&n(e),oe(t,s)}}}function ye(i){let e,o,t,s,r,l,c,g,_,E,d,f,w,A,L;_=new re({props:{$$slots:{menu:[Ce],toggle:[Te]},$$scope:{ctx:i}}});let k=i[1].source.filter.condition&&pe(i),V=i[1].source.filter.value!==void 0&&ge(i);return{c(){e=p("div"),o=p("div"),t=p("div"),s=B("Column"),r=$(),l=p("button"),c=p("i"),g=$(),W(_.$$.fragment),E=$(),d=p("div"),k&&k.c(),f=$(),V&&V.c(),this.h()},l(h){e=v(h,"DIV",{class:!0});var I=b(e);o=v(I,"DIV",{class:!0});var F=b(o);t=v(F,"DIV",{class:!0});var S=b(t);s=O(S,"Column"),S.forEach(n),r=D(F),l=v(F,"BUTTON",{});var C=b(l);c=v(C,"I",{class:!0}),b(c).forEach(n),C.forEach(n),F.forEach(n),g=D(I),X(_.$$.fragment,I),E=D(I),d=v(I,"DIV",{class:!0});var U=b(d);k&&k.l(U),f=D(U),V&&V.l(U),U.forEach(n),I.forEach(n),this.h()},h(){m(t,"class","font-semibold flex-grow"),m(c,"class","ri-delete-bin-line align-bottom"),m(o,"class","flex items-center"),m(d,"class","flex items-center space-x-2"),m(e,"class","rounded bg-zinc-200 p-2 text-sm space-y-2")},m(h,I){N(h,e,I),a(e,o),a(o,t),a(t,s),a(o,r),a(o,l),a(l,c),a(e,g),x(_,e,null),a(e,E),a(e,d),k&&k.m(d,null),a(d,f),V&&V.m(d,null),w=!0,A||(L=G(l,"click",i[10]),A=!0)},p(h,I){const F={};I&16777219&&(F.$$scope={dirty:I,ctx:h}),_.$set(F),h[1].source.filter.condition?k?(k.p(h,I),I&2&&q(k,1)):(k=pe(h),k.c(),q(k,1),k.m(d,f)):k&&(se(),R(k,1,1,()=>{k=null}),le()),h[1].source.filter.value!==void 0?V?V.p(h,I):(V=ge(h),V.c(),V.m(d,null)):V&&(V.d(1),V=null)},i(h){w||(q(_.$$.fragment,h),q(k),w=!0)},o(h){R(_.$$.fragment,h),R(k),w=!1},d(h){h&&n(e),ee(_),k&&k.d(),V&&V.d(),A=!1,L()}}}function Ne(i){let e,o,t,s,r;return{c(){e=p("button"),o=p("i"),t=B(" Add Filter"),this.h()},l(l){e=v(l,"BUTTON",{class:!0});var c=b(e);o=v(c,"I",{class:!0}),b(o).forEach(n),t=O(c," Add Filter"),c.forEach(n),this.h()},h(){m(o,"class","ri-add-line align-bottom"),m(e,"class","p-1 bg-zinc-50 w-full rounded")},m(l,c){N(l,e,c),a(e,o),a(e,t),s||(r=G(e,"click",i[9]),s=!0)},p:te,i:te,o:te,d(l){l&&n(e),s=!1,r()}}}function Te(i){let e,o,t,s,r,l,c=i[1].source.filter.column.name+"",g,_,E;return{c(){e=p("div"),o=p("div"),t=p("i"),r=$(),l=p("span"),g=B(c),_=$(),E=p("i"),this.h()},l(d){e=v(d,"DIV",{slot:!0,class:!0});var f=b(e);o=v(f,"DIV",{class:!0});var w=b(o);t=v(w,"I",{class:!0}),b(t).forEach(n),r=D(w),l=v(w,"SPAN",{});var A=b(l);g=O(A,c),A.forEach(n),w.forEach(n),_=D(f),E=v(f,"I",{class:!0}),b(E).forEach(n),f.forEach(n),this.h()},h(){m(t,"class",s="align-bottom border text-center "+M[i[1].source.filter.column.type]+" rounded"),m(o,"class","flex-grow space-x-1"),m(E,"class","ri-arrow-drop-down-line align-bottom"),m(e,"slot","toggle"),m(e,"class","cursor-pointer bg-zinc-100 border border-zinc-300 p-2 rounded flex items-center")},m(d,f){N(d,e,f),a(e,o),a(o,t),a(o,r),a(o,l),a(l,g),a(e,_),a(e,E)},p(d,f){f&2&&s!==(s="align-bottom border text-center "+M[d[1].source.filter.column.type]+" rounded")&&m(t,"class",s),f&2&&c!==(c=d[1].source.filter.column.name+"")&&J(g,c)},d(d){d&&n(e)}}}function me(i){let e,o,t,s,r,l=i[18].alias+"",c,g,_,E;function d(){return i[11](i[18])}return{c(){e=p("div"),o=p("i"),s=$(),r=p("span"),c=B(l),g=$(),this.h()},l(f){e=v(f,"DIV",{class:!0});var w=b(e);o=v(w,"I",{class:!0}),b(o).forEach(n),s=D(w),r=v(w,"SPAN",{});var A=b(r);c=O(A,l),A.forEach(n),g=D(w),w.forEach(n),this.h()},h(){m(o,"class",t=M[i[18].type]+" align-bottom border rounded"),m(e,"class","hover:bg-zinc-50 space-x-1 p-2 cursor-pointer")},m(f,w){N(f,e,w),a(e,o),a(e,s),a(e,r),a(r,c),a(e,g),_||(E=G(e,"click",d),_=!0)},p(f,w){i=f,w&1&&t!==(t=M[i[18].type]+" align-bottom border rounded")&&m(o,"class",t),w&1&&l!==(l=i[18].alias+"")&&J(c,l)},d(f){f&&n(e),_=!1,E()}}}function Ce(i){let e,o=i[0].columns,t=[];for(let s=0;s<o.length;s+=1)t[s]=me(fe(i,o,s));return{c(){e=p("div");for(let s=0;s<t.length;s+=1)t[s].c();this.h()},l(s){e=v(s,"DIV",{slot:!0});var r=b(e);for(let l=0;l<t.length;l+=1)t[l].l(r);r.forEach(n),this.h()},h(){m(e,"slot","menu")},m(s,r){N(s,e,r);for(let l=0;l<t.length;l+=1)t[l].m(e,null)},p(s,r){if(r&3){o=s[0].columns;let l;for(l=0;l<o.length;l+=1){const c=fe(s,o,l);t[l]?t[l].p(c,r):(t[l]=me(c),t[l].c(),t[l].m(e,null))}for(;l<t.length;l+=1)t[l].d(1);t.length=o.length}},d(s){s&&n(e),oe(t,s)}}}function pe(i){let e,o;return e=new re({props:{$$slots:{menu:[Se],toggle:[Pe]},$$scope:{ctx:i}}}),{c(){W(e.$$.fragment)},l(t){X(e.$$.fragment,t)},m(t,s){x(e,t,s),o=!0},p(t,s){const r={};s&16777218&&(r.$$scope={dirty:s,ctx:t}),e.$set(r)},i(t){o||(q(e.$$.fragment,t),o=!0)},o(t){R(e.$$.fragment,t),o=!1},d(t){ee(e,t)}}}function Pe(i){let e,o,t=i[1].source.filter.condition+"",s,r,l;return{c(){e=p("div"),o=p("span"),s=B(t),r=$(),l=p("i"),this.h()},l(c){e=v(c,"DIV",{slot:!0,class:!0});var g=b(e);o=v(g,"SPAN",{});var _=b(o);s=O(_,t),_.forEach(n),r=D(g),l=v(g,"I",{class:!0}),b(l).forEach(n),g.forEach(n),this.h()},h(){m(l,"class","ri-arrow-drop-down-line align-bottom"),m(e,"slot","toggle"),m(e,"class","cursor-pointer border bg-zinc-100 border-zinc-300 space-x-1 p-2 flex items-center whitespace-nowrap rounded")},m(c,g){N(c,e,g),a(e,o),a(o,s),a(e,r),a(e,l)},p(c,g){g&2&&t!==(t=c[1].source.filter.condition+"")&&J(s,t)},d(c){c&&n(e)}}}function ve(i){let e,o,t=i[15]+"",s,r,l,c;function g(){return i[12](i[15])}return{c(){e=p("div"),o=p("span"),s=B(t),r=$(),this.h()},l(_){e=v(_,"DIV",{class:!0});var E=b(e);o=v(E,"SPAN",{});var d=b(o);s=O(d,t),d.forEach(n),r=D(E),E.forEach(n),this.h()},h(){m(e,"class","hover:bg-zinc-50 space-x-1 p-2")},m(_,E){N(_,e,E),a(e,o),a(o,s),a(e,r),l||(c=G(e,"click",g),l=!0)},p(_,E){i=_,E&2&&t!==(t=i[15]+"")&&J(s,t)},d(_){_&&n(e),l=!1,c()}}}function Se(i){let e,o=ce[i[1].source.filter.column.type],t=[];for(let s=0;s<o.length;s+=1)t[s]=ve(ue(i,o,s));return{c(){e=p("div");for(let s=0;s<t.length;s+=1)t[s].c();this.h()},l(s){e=v(s,"DIV",{slot:!0});var r=b(e);for(let l=0;l<t.length;l+=1)t[l].l(r);r.forEach(n),this.h()},h(){m(e,"slot","menu")},m(s,r){N(s,e,r);for(let l=0;l<t.length;l+=1)t[l].m(e,null)},p(s,r){if(r&2){o=ce[s[1].source.filter.column.type];let l;for(l=0;l<o.length;l+=1){const c=ue(s,o,l);t[l]?t[l].p(c,r):(t[l]=ve(c),t[l].c(),t[l].m(e,null))}for(;l<t.length;l+=1)t[l].d(1);t.length=o.length}},d(s){s&&n(e),oe(t,s)}}}function ge(i){let e,o,t;return{c(){e=p("input"),this.h()},l(s){e=v(s,"INPUT",{class:!0,type:!0}),this.h()},h(){m(e,"class","bg-zinc-100 p-2 rounded w-full"),m(e,"type","text")},m(s,r){N(s,e,r),K(e,i[1].source.filter.value),o||(t=G(e,"input",i[13]),o=!0)},p(s,r){r&2&&e.value!==s[1].source.filter.value&&K(e,s[1].source.filter.value)},d(s){s&&n(e),o=!1,t()}}}function Fe(i){let e,o,t,s,r,l,c,g,_,E,d,f,w,A=i[3].some(i[6])||i[1].aggregation,L,k,V,h,I,F,S,C,U,Q;f=new Ve({props:{column:i[1],externalLink:i[2]}});let y=A&&he(i);return{c(){e=p("div"),o=p("div"),t=p("label"),s=B("Name"),r=$(),l=p("input"),c=$(),g=p("div"),_=p("h4"),E=B("Source"),d=$(),W(f.$$.fragment),w=$(),y&&y.c(),L=$(),k=p("div"),V=$(),h=p("div"),I=p("button"),F=p("i"),S=B(" Delete Column"),this.h()},l(P){e=v(P,"DIV",{class:!0});var T=b(e);o=v(T,"DIV",{class:!0});var u=b(o);t=v(u,"LABEL",{for:!0});var z=b(t);s=O(z,"Name"),z.forEach(n),r=D(u),l=v(u,"INPUT",{id:!0,class:!0,type:!0}),u.forEach(n),c=D(T),g=v(T,"DIV",{class:!0});var H=b(g);_=v(H,"H4",{});var j=b(_);E=O(j,"Source"),j.forEach(n),d=D(H),X(f.$$.fragment,H),H.forEach(n),w=D(T),y&&y.l(T),L=D(T),k=v(T,"DIV",{class:!0}),b(k).forEach(n),V=D(T),h=v(T,"DIV",{class:!0});var Y=b(h);I=v(Y,"BUTTON",{class:!0});var Z=b(I);F=v(Z,"I",{class:!0}),b(F).forEach(n),S=O(Z," Delete Column"),Z.forEach(n),Y.forEach(n),T.forEach(n),this.h()},h(){m(t,"for","columnName"),m(l,"id","columnName"),m(l,"class","p-2 rounded bg-zinc-100 border border-zinc-300 bg-opacity-80"),m(l,"type","text"),m(o,"class","space-y-1 grid"),m(g,"class","space-y-1 grid"),m(k,"class","border-b flex-grow border-zinc-200"),m(F,"class","ri-delete-bin-line align-bottom"),m(I,"class","bg-zinc-50 p-1 rounded"),m(h,"class","space-y-2 grid"),m(e,"class","p-4 space-y-2 flex flex-col h-full")},m(P,T){N(P,e,T),a(e,o),a(o,t),a(t,s),a(o,r),a(o,l),K(l,i[1].alias),a(e,c),a(e,g),a(g,_),a(_,E),a(g,d),x(f,g,null),a(e,w),y&&y.m(e,null),a(e,L),a(e,k),a(e,V),a(e,h),a(h,I),a(I,F),a(I,S),C=!0,U||(Q=[G(l,"input",i[7]),G(I,"click",function(){we(i[4]("deleteColumn",i[1]))&&i[4]("deleteColumn",i[1]).apply(this,arguments)})],U=!0)},p(P,[T]){i=P,T&2&&l.value!==i[1].alias&&K(l,i[1].alias);const u={};T&2&&(u.column=i[1]),T&4&&(u.externalLink=i[2]),f.$set(u),T&10&&(A=i[3].some(i[6])||i[1].aggregation),A?y?(y.p(i,T),T&10&&q(y,1)):(y=he(i),y.c(),q(y,1),y.m(e,L)):y&&(se(),R(y,1,1,()=>{y=null}),le())},i(P){C||(q(f.$$.fragment,P),q(y),C=!0)},o(P){R(f.$$.fragment,P),R(y),C=!1},d(P){P&&n(e),ee(f),y&&y.d(),U=!1,Ie(Q)}}}function Le(i,e,o){const t=$e();let{selectedView:s}=e,{column:r}=e,l,c,g=[];De(()=>{c=s.columns.indexOf(r),o(3,g=s.records.map(h=>h[c])),o(2,l=r.source.table.constraints.find(h=>h.referenceTable&&h.referenceTable.id==s.baseTable.id)),o(0,s)});function _(h){t("updateAggregation",{aggregation:h,column:r,columnIdx:c,records:g}),o(1,r)}const E=h=>Array.isArray(h);function d(){r.alias=this.value,o(1,r)}const f=h=>_(h),w=()=>t("addFilter",r),A=()=>t("deleteFilter",r),L=h=>o(1,r.source.filter.column=h,r),k=h=>o(1,r.source.filter.condition=h,r);function V(){r.source.filter.value=this.value,o(1,r)}return i.$$set=h=>{"selectedView"in h&&o(0,s=h.selectedView),"column"in h&&o(1,r=h.column)},[s,r,l,g,t,_,E,d,f,w,A,L,k,V]}class Qe extends be{constructor(e){super();Ee(this,e,Le,Fe,ke,{selectedView:0,column:1})}}export{Qe as default};
